<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ang Silakbo - Articles</title>
    <link rel="icon" href="SILAKBO (1).png">
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700;900&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #E65100;
            --primary-light: #FF8A50;
            --primary-dark: #B23C00;
            --secondary: #FFF3E0;
            --accent: #2196F3;
            --text-primary: #212121;
            --text-secondary: #757575;
            --background: #FFFFFF;
            --background-alt: #F9F9F9;
            --border: #E0E0E0;
            --shadow: rgba(0, 0, 0, 0.1);
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body, html {
            font-family: 'Merriweather', serif;
            background-color: var(--background-alt);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
            line-height: 1.6;
        }

        .content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            margin: 0 auto;
            background-color: var(--background);
            box-shadow: var(--card-shadow);
            max-width: 1400px;
            position: relative;
            overflow: hidden;
        }

        /* Header Styles */
        .header {
            background-image: linear-gradient(135deg, rgba(230, 81, 0, 0.9), rgba(178, 60, 0, 0.85)), url('articles.jpg');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 40px 20px;  /* Reduced from 80px to 50px */
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent 0%, rgba(0, 0, 0, 0.3) 100%);
            z-index: 1;
        }

        .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .header img {
            height: 80px;
            margin-right: 40px;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
            transition: var(--transition);
            animation: pulse 3s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .header img:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .header-text {
            text-align: left;
        }

        .header h1 {
            font-size: 3em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
            font-weight: 900;
            line-height: 1.2;
            font-family: 'Poppins', sans-serif;
        }

        .header-description {
            font-size: 1.3em;
            max-width: 600px;
            margin: 15px 0 0;
            opacity: 0.9;
            font-weight: 300;
            letter-spacing: 0.5px;
            font-family: 'Poppins', sans-serif;
        }

        /* Navigation */
        .nav-container {
            background-color: var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-family: 'Poppins', sans-serif;
        }

        .nav-links {
            display: flex;
            justify-content: center;
            padding: 0;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 18px 25px;
            display: inline-block;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            letter-spacing: 0.5px;
        }

        .nav-links a:after {
            content: '';
            position: absolute;
            width: 0;
            height: 3px;
            bottom: 0;
            left: 50%;
            background-color: white;
            transition: var(--transition);
            transform: translateX(-50%);
        }

        .nav-links a:hover:after {
            width: 70%;
        }

        .nav-links a:hover {
            background-color: var(--primary-dark);
        }

        .nav-links a i {
            margin-right: 8px;
            font-size: 1.1em;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 15px;
            z-index: 10;
        }

        /* User Profile */
        .user-profile {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--background);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            color: white;
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-family: 'Poppins', sans-serif;
        }

        .login-btn {
            background-color: transparent;
            border: 2px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            transition: var(--transition);
        }

        .login-btn:hover {
            background-color: white;
            color: var(--primary);
        }

        /* Search and Filters */
        .search-container {
            padding: 30px 20px;
            background-color: var(--background);
            border-bottom: 1px solid var(--border);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        .search-wrapper {
            position: relative;
            max-width: 700px;
            margin: 0 auto;
            transition: var(--transition);
        }

        .search-wrapper:focus-within {
            transform: scale(1.02);
        }

        #search-input {
            width: 100%;
            padding: 15px 25px;
            font-size: 16px;
            border: 2px solid var(--border);
            border-radius: 50px;
            box-sizing: border-box;
            transition: var(--transition);
            font-family: 'Merriweather', serif;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        #search-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(230, 81, 0, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 18px;
        }

        .category-filter {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 30px auto 20px;
            flex-wrap: wrap;
            max-width: 1200px;
            padding: 0 20px;
        }

        .category-filter button {
            background-color: var(--background);
            border: 2px solid var(--border);
            padding: 10px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .category-filter button:hover {
            border-color: var(--primary-light);
            color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .category-filter button.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 10px rgba(230, 81, 0, 0.3);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            width: 100%;
        }

        /* Latest Post */
        .latest-post {
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 60px;
            background-color: var(--background);
            box-shadow: var(--card-shadow);
            position: relative;
            transition: var(--transition);
        }

        .latest-post:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .latest-post-header {
            position: relative;
            height: 400px;
            overflow: hidden;
        }

        .latest-post-header img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.7s ease;
        }

        .latest-post:hover .latest-post-header img {
            transform: scale(1.05);
        }

        .latest-post-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.8));
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 40px;
            color: white;
        }

        .photo-credit {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            font-size: 0.9em;
            font-weight: 500;
            border-top-left-radius: 8px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .featured-label {
            background-color: var(--primary);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 0.8em;
            display: inline-block;
            margin-bottom: 15px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-family: 'Poppins', sans-serif;
        }

        .latest-post-content {
            padding: 40px;
        }

        .latest-post .post-title {
            font-size: 32px;
            margin-bottom: 20px;
            color: var(--primary);
            line-height: 1.3;
            font-weight: 900;
        }

        .latest-post-overlay .post-title {
            font-size: 36px;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }

        .latest-post .post-content {
            margin-top: 25px;
            line-height: 1.8;
            color: var(--text-secondary);
            font-size: 1.1em;
            font-family: 'Georgia', serif;
        }

        /* Posts Grid */
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .post {
            border-radius: 16px;
            overflow: hidden;
            background-color: var(--background);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .post:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .post-header {
            position: relative;
            height: 220px;
            overflow: hidden;
        }

        .post-header img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.7s ease;
        }

        .post:hover .post-header img {
            transform: scale(1.05);
        }

        .post-body {
            padding: 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .post-title {
            font-size: 22px;
            color: var(--primary);
            margin-bottom: 15px;
            line-height: 1.4;
            transition: color 0.3s ease;
            font-weight: 700;
        }

        .post:hover .post-title {
            color: var(--primary-dark);
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 0.85em;
            color: var(--text-secondary);
            align-items: center;
        }

        .post-date, .post-author, .post-reading-time, .post-category, .view-count {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .post-meta i {
            color: var(--primary);
        }

        .post-tags {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            background-color: var(--secondary);
            color: var(--primary);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 500;
            transition: var(--transition);
        }

        .tag:hover {
            background-color: var(--primary-light);
            color: white;
            transform: translateY(-2px);
        }

        .post-content {
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 25px;
            flex: 1;
            font-size: 0.95em;
            font-family: 'Georgia', serif;
        }

        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .read-more {
            color: var(--primary);
            text-decoration: none;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            padding: 8px 0;
        }

        .read-more:hover {
            color: var(--primary-dark);
            transform: translateX(5px);
        }

        .read-more i {
            transition: transform 0.3s ease;
        }

        .read-more:hover i {
            transform: translateX(5px);
        }

        .reaction-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
            font-size: 0.9em;
            padding: 8px;
            border-radius: 20px;
        }

        .reaction-btn:hover {
            color: #e91e63;
            background-color: rgba(233, 30, 99, 0.1);
        }

        .reaction-btn.active {
            color: #e91e63;
        }

        .reaction-btn i {
            font-size: 1.3em;
        }

        .reaction-count {
            font-weight: bold;
        }

        /* Post Menu */
        .post-menu {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 5;
        }

        .post-menu-btn {
            background-color: rgba(255, 255, 255, 0.9);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .post-menu-btn:hover {
            background-color: white;
            transform: rotate(90deg);
        }

        .post-menu-content {
            display: none;
            position: absolute;
            right: 0;
            top: 50px;
            background-color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            z-index: 10;
            min-width: 180px;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
        }

        .post-menu-content a {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            text-decoration: none;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .post-menu-content a:hover {
            background-color: var(--background-alt);
            color: var(--primary);
        }

        .post-menu-content a i {
            margin-right: 12px;
            color: var(--primary);
            width: 20px;
            text-align: center;
            font-size: 1.1em;
        }

        /* Social Share */
        .social-share {
            margin-top: 30px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .social-share button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .social-share button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .social-share button.facebook {
            background-color: #3b5998;
        }

        .social-share button.twitter {
            background-color: #1da1f2;
        }

        .social-share button.whatsapp {
            background-color: #25d366;
        }

        /* Load More */
        .load-more-container {
            text-align: center;
            margin: 40px 0;
        }

        .load-more-button {
            background-color: var(--primary);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(230, 81, 0, 0.3);
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .load-more-button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(230, 81, 0, 0.4);
        }

        /* Fullscreen View */
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.98);
            z-index: 1000;
            overflow-y: auto;
            padding: 0;
            box-sizing: border-box;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }

        .fullscreen.active {
            opacity: 1;
            visibility: visible;
        }

        .fullscreen-header {
            position: relative;
            height: 50vh;
            min-height: 400px;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: flex-end;
            padding: 40px;
            color: white;
            background-color: #333;
        }

        .fullscreen-header-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.8));
            z-index: 1;
        }

        .fullscreen-header-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .fullscreen-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            background-color: white;
        }

        .fullscreen .post-title {
            font-size: 36px;
            margin-bottom: 20px;
            line-height: 1.3;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .fullscreen .post-content {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 30px;
            color: var(--text-primary);
            font-family: 'Georgia', serif;
        }

        .fullscreen .post-content p {
            margin-bottom: 20px;
        }

        .fullscreen .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 30px 0;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .close-fullscreen {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1001;
            background-color: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .close-fullscreen:hover {
            background-color: var(--primary-dark);
            transform: rotate(90deg);
        }

        .fullscreen-reactions {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid var(--border);
        }

        .fullscreen-reaction-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
            font-size: 1.1em;
            padding: 12px 20px;
            border-radius: 30px;
            font-family: 'Poppins', sans-serif;
        }

        .fullscreen-reaction-btn:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }

        .fullscreen-reaction-btn.love:hover, .fullscreen-reaction-btn.love.active {
            color: #e91e63;
            background-color: rgba(233, 30, 99, 0.1);
        }

        .fullscreen-reaction-btn.bookmark:hover, .fullscreen-reaction-btn.bookmark.active {
            color: var(--primary);
            background-color: var(--secondary);
        }

        .fullscreen-reaction-btn i {
            font-size: 1.3em;
        }

        /* Comments Section */
        .comments-section {
            margin-top: 50px;
            padding-top: 40px;
            border-top: 1px solid var(--border);
        }

        .comments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .comments-header h3 {
            font-size: 24px;
            color: var(--text-primary);
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
        }

        .comments-count {
            background-color: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
        }

        .comment-form {
            margin-bottom: 40px;
            position: relative;
        }

        .comment-input {
            width: 100%;
            padding: 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            resize: none;
            font-family: 'Georgia', serif;
            margin-bottom: 20px;
            transition: var(--transition);
            font-size: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .comment-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .comment-submit {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(230, 81, 0, 0.3);
        }

        .comment-submit:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(230, 81, 0, 0.4);
        }

        .comment-submit:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .comments-container {
            margin-top: 30px;
        }

        .comment {
            padding: 25px;
            border-radius: 12px;
            background-color: var(--background-alt);
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            animation: fadeIn 0.5s ease-out;
        }

        .comment:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .comment-author {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1em;
        }

        .comment-date {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .comment-body {
            line-height: 1.7;
            color: var(--text-primary);
            font-family: 'Georgia', serif;
        }

        .comments-loading {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
        }

        .no-comments {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            background-color: var(--background-alt);
            border-radius: 12px;
            margin-top: 20px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 16px;
            overflow: hidden;
        }

        .comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .comment-user-info {
            display: flex;
            align-items: center;
        }

        /* Login Modal */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .login-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .login-modal-content {
            background-color: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            transform: translateY(30px);
            opacity: 0;
            transition: transform 0.4s ease, opacity 0.4s ease;
        }

        .login-modal.active .login-modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .login-modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .login-modal-title {
            font-size: 24px;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }

        .login-modal-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
        }

        .login-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }

        .login-option-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            font-size: 16px;
            border: none;
        }

        .login-option-btn.google {
            background-color: white;
            color: #333;
            border: 1px solid #ddd;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .login-option-btn.google:hover {
            background-color: #f8f8f8;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .login-option-btn.anonymous {
            background-color: var(--background-alt);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .login-option-btn.anonymous:hover {
            background-color: var(--border);
        }

        .login-option-btn i {
            font-size: 20px;
        }

        .login-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .login-modal-close:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }

        .login-modal-divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--text-secondary);
            font-family: 'Poppins', sans-serif;
        }

        .login-modal-divider::before,
        .login-modal-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background-color: var(--border);
        }

        .login-modal-divider span {
            padding: 0 15px;
            font-size: 14px;
        }

        /* Footer */
        .footer {
            background-color: var(--primary);
            color: white;
            padding: 60px 20px 40px;
            position: relative;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, var(--primary-light), var(--primary-dark));
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: wrap;
            gap: 40px;
        }

        .footer-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .footer-logo {
            height: 60px;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
        }

        .footer-text p {
            margin: 8px 0;
            line-height: 1.6;
            opacity: 0.9;
        }

        .footer-nav {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .footer-nav h4 {
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 700;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-nav h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background-color: var(--secondary);
        }

        .footer-nav a {
            color: white;
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-nav a:hover {
            color: var(--secondary);
            transform: translateX(5px);
        }

        .footer-nav a i {
            font-size: 0.8em;
        }

        .social-icons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .social-icons a {
            color: white;
            font-size: 20px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 30px;
        }

        .social-icons a:hover {
            color: var(--secondary);
            transform: translateY(-5px);
            background-color: rgba(255, 255, 255, 0.2);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 40px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Loading and Error States */
        .loading, .error, .no-posts {
            text-align: center;
            padding: 80px 20px;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid var(--secondary);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            color: #d32f2f;
            background-color: #ffebee;
            border-radius: 12px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .retry-button {
            background-color: var(--primary);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 25px;
            font-size: 16px;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }

        .retry-button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        .delay-5 { animation-delay: 0.5s; }

        /* Love Animation */
        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }

        .heart-beat {
            animation: heartBeat 1s;
        }

        /* Floating Hearts Animation */
        .floating-hearts {
            position: absolute;
            pointer-events: none;
            z-index: 1000;
        }

        .floating-heart {
            position: absolute;
            font-size: 20px;
            color: #e91e63;
            opacity: 0;
            animation: floatHeart 2s ease-out forwards;
        }

        @keyframes floatHeart {
            0% {
                transform: translate(0, 0) scale(0.5);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), -120px) scale(1.5);
                opacity: 0;
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.4s ease, opacity 0.4s ease;
            font-weight: 500;
            font-family: 'Poppins', sans-serif;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 99;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background-color: var(--primary-dark);
            transform: translateY(-5px);
        }

        /* Responsive Styles */
        @media (max-width: 1200px) {
            .main-content {
                padding: 30px 20px;
            }
            
            .posts-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }

        @media (max-width: 992px) {
            .posts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
                gap: 30px;
            }
            
            .footer-left {
                align-items: center;
            }
            
            .footer-nav {
                align-items: center;
            }
            
            .footer-nav h4::after {
                left: 50%;
                transform: translateX(-50%);
            }
            
            .social-icons {
                justify-content: center;
            }
            
            .latest-post-header {
                height: 300px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 50px 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .header-description {
                font-size: 1em;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .header img {
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            .header-text {
                text-align: center;
            }
            
            .nav-links {
                display: none;
                flex-direction: column;
                padding: 0;
            }
            
            .nav-links.active {
                display: flex;
            }
            
            .nav-links a {
                padding: 15px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .mobile-menu-btn {
                display: block;
                position: absolute;
                right: 20px;
                top: 20px;
            }
            
            .posts-grid {
                grid-template-columns: 1fr;
            }
            
            .latest-post-header {
                height: 250px;
            }
            
            .latest-post-overlay {
                padding: 20px;
            }
            
            .latest-post-overlay .post-title {
                font-size: 24px;
            }
            
            .latest-post-content {
                padding: 25px;
            }
            
            .fullscreen-header {
                height: 40vh;
                min-height: 300px;
                padding: 20px;
            }
            
            .fullscreen-content {
                padding: 25px;
            }
            
            .fullscreen .post-title {
                font-size: 28px;
            }
            
            .fullscreen .post-content {
                font-size: 16px;
            }
            
            .close-fullscreen {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .category-filter {
                gap: 8px;
            }
            
            .category-filter button {
                padding: 8px 15px;
                font-size: 12px;
            }
            
            .post-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .social-share {
                flex-wrap: wrap;
            }
            
            .fullscreen .post-title {
                font-size: 22px;
            }
            
            .fullscreen-reactions {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .latest-post-header {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <header class="header fade-in">
            <div class="header-content">
                <img src="SILAKBO.png" alt="SILAKBO Logo">
                <div class="header-text">
                    <h1>Ang Silakbo Articles</h1>
                    <p class="header-description">Pagpapahayag ng Makatotohanang Balita Na May Makabuluhang Damdamin.</p>
                </div>
            </div>
            <div class="user-profile">
                <div id="user-info">
                    <button class="login-btn" id="login-button">Sign In</button>
                </div>
            </div>
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </header>

        <div class="nav-container">
            <nav class="nav-links fade-in">
                <a href="index.html"><i class="fas fa-home"></i> Home</a>
                <a href="#"><i class="fas fa-newspaper"></i> Articles</a>
                <a href="#"><i class="fas fa-info-circle"></i> About</a>
                <a href="#"><i class="fas fa-envelope"></i> Contact</a>
            </nav>
        </div>

        <div class="search-container fade-in delay-1">
            <div class="search-wrapper">
                <input type="text" id="search-input" placeholder="Search articles...">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>

        <div class="category-filter fade-in delay-2">
            <button class="active" data-category="all">All Categories</button>
            <button data-category="news">News</button>
            <button data-category="opinion">Opinion</button>
            <button data-category="feature">Feature</button>
            <button data-category="culture">Culture</button>
        </div>

        <div class="main-content">
            <div id="latest-post-container" class="latest-post fade-in delay-3"></div>

            <div id="posts-container" class="posts-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading articles...</p>
                </div>
            </div>

            <div class="load-more-container fade-in delay-5">
                <button id="load-more" class="load-more-button">Load More Articles</button>
            </div>
        </div>

        <footer class="footer fade-in">
            <div class="footer-content">
                <div class="footer-left">
                    <img src="SILAKBO.png" alt="SILAKBO Logo" class="footer-logo">
                    <div class="footer-text">
                        <p>&copy; 2025 Ang Silakbo Articles</p>
                        <p>Pagpapahayag ng Makatotohanang Balita Na May Makabuluhang Damdamin.</p>
                    </div>
                </div>
                <div class="footer-nav">
                    <h4>Quick Links</h4>
                    <a href="#"><i class="fas fa-chevron-right"></i> Home</a>
                    <a href="#"><i class="fas fa-chevron-right"></i> Articles</a>
                    <a href="#"><i class="fas fa-chevron-right"></i> About</a>
                    <a href="#"><i class="fas fa-chevron-right"></i> Contact</a>
                </div>
                <div class="footer-nav">
                    <h4>Categories</h4>
                    <a href="#"><i class="fas fa-chevron-right"></i> News</a>
                    <a href="#"><i class="fas fa-chevron-right"></i> Opinion</a>
                    <a href="#"><i class="fas fa-chevron-right"></i> Feature</a>
                    <a href="#"><i class="fas fa-chevron-right"></i> Culture</a>
                </div>
                <div class="social-icons">
                    <a href="https://www.facebook.com/AngSilakboUCLM" aria-label="Facebook">
                        <i class="fab fa-facebook"></i> Ang Silakbo
                    </a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>2025 Ang Silakbo. All Rights Reserved.</p>
            </div>
        </footer>
    </div>

    <div class="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <div class="toast" id="toast-notification"></div>

    <!-- Login Modal -->
    <div class="login-modal" id="login-modal">
        <div class="login-modal-content">
            <button class="login-modal-close">&times;</button>
            <div class="login-modal-header">
                <h3 class="login-modal-title">Comment as...</h3>
                <p class="login-modal-subtitle">Choose how you want to post your comment</p>
            </div>
            <div class="login-options">
                <button class="login-option-btn google" id="google-login-btn">
                    <i class="fab fa-google"></i> Continue with Google
                </button>
                <div class="login-modal-divider">
                    <span>or</span>
                </div>
                <button class="login-option-btn anonymous" id="anonymous-login-btn">
                    <i class="fas fa-user-secret"></i> Continue as Anonymous
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDSe2c9-8xqShoHEW-D7BXXAyD5N9uXWEs",
            authDomain: "ang-silakbo.firebaseapp.com",
            databaseURL: "https://ang-silakbo-default-rtdb.firebaseio.com",
            projectId: "ang-silakbo",
            storageBucket: "ang-silakbo.appspot.com",
            messagingSenderId: "1006400633782",
            appId: "1:1006400633782:web:ef4a93c1d445cb825b9f17",
            measurementId: "G-TSDTG2YJ94"
        };

        // Initialize Firebase with error handling
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            if (error.code !== 'app/duplicate-app') {
                showError('Firebase initialization failed. Please refresh the page.');
                console.error('Firebase initialization error:', error);
            }
        }

        const db = firebase.firestore();
        const rtdb = firebase.database();
        const storage = firebase.storage();
        const auth = firebase.auth();
        let allPosts = [];
        let lastVisible = null;
        const postsPerPage = 6;
        let currentCategory = 'all';
        let currentUser = null;
        
        // DOM Elements
        const postsContainer = document.getElementById('posts-container');
        const latestPostContainer = document.getElementById('latest-post-container');
        const loadMoreBtn = document.getElementById('load-more');
        const searchInput = document.getElementById('search-input');
        const categoryButtons = document.querySelectorAll('.category-filter button');
        const backToTopBtn = document.querySelector('.back-to-top');
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navLinks = document.querySelector('.nav-links');
        const toastNotification = document.getElementById('toast-notification');
        const loginModal = document.getElementById('login-modal');
        const loginButton = document.getElementById('login-button');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const anonymousLoginBtn = document.getElementById('anonymous-login-btn');
        const loginModalClose = document.querySelector('.login-modal-close');
        const userInfo = document.getElementById('user-info');
        
        // Show error message
        function showError(message) {
            postsContainer.innerHTML = `
                <div class="error">
                    <p><i class="fas fa-exclamation-triangle"></i> ${message}</p>
                    <button class="retry-button" onclick="loadPosts()">Retry</button>
                </div>
            `;
        }

        // Show loading state
        function showLoading() {
            postsContainer.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading articles...</p>
                </div>
            `;
        }

        // Show toast notification
        function showToast(message, duration = 3000) {
            toastNotification.textContent = message;
            toastNotification.classList.add('show');
            
            setTimeout(() => {
                toastNotification.classList.remove('show');
            }, duration);
        }

        // Get image URL from Firebase Storage
        async function getImageUrl(imagePath) {
            if (!imagePath) return null;
            
            try {
                // Check if it's already a full URL
                if (imagePath.startsWith('http')) {
                    return imagePath;
                }
                
                // Check if it's a placeholder
                if (imagePath.includes('placeholder')) {
                    return '/placeholder.svg?height=400&width=800';
                }
                
                // Get from Firebase Storage
                const storageRef = storage.ref(imagePath);
                return await storageRef.getDownloadURL();
            } catch (error) {
                console.error('Error getting image URL:', error);
                return '/placeholder.svg?height=400&width=800';
            }
        }

        // Extract first image from content
        function extractFirstImage(content) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            const imgElement = tempDiv.querySelector('img');
            
            if (imgElement) {
                const imgSrc = imgElement.getAttribute('src');
                // Remove the image from the content
                imgElement.parentNode.removeChild(imgElement);
                return {
                    imageUrl: imgSrc,
                    updatedContent: tempDiv.innerHTML
                };
            }
            
            return {
                imageUrl: null,
                updatedContent: content
            };
        }

        // Load posts from Firestore
        async function loadPosts(loadMore = false) {
            if (!loadMore) {
                showLoading();
            }
            
            try {
                let query = db.collection('articles').orderBy('timestamp', 'desc');

                if (currentCategory !== 'all') {
                    query = query.where('category', '==', currentCategory);
                }

                if (lastVisible && loadMore) {
                    query = query.startAfter(lastVisible);
                }

                query = query.limit(postsPerPage);

                const snapshot = await query.get();

                if (snapshot.empty && !loadMore) {
                    postsContainer.innerHTML = `
                        <div class="no-posts fade-in">
                            <h2>No articles found</h2>
                            <p>Try a different category or check back                            <h2>No articles found</h2>
                            <p>Try a different category or check back later.</p>
                        </div>
                    `;
                    loadMoreBtn.style.display = 'none';
                    return;
                }

                // Process posts with image URLs
                const newPostsPromises = snapshot.docs.map(async doc => {
                    const data = doc.data();
                    const date = data.timestamp ? new Date(data.timestamp.seconds * 1000) : new Date();
                    
                    // Check if there's an image in the content
                    const { imageUrl: contentImageUrl, updatedContent } = extractFirstImage(data.content || '');
                    
                    // Use the image from content if available, otherwise use the provided image
                    let imageUrl;
                    let finalContent = data.content || '';
                    
                    if (contentImageUrl) {
                        imageUrl = contentImageUrl;
                        finalContent = updatedContent;
                    } else {
                        imageUrl = await getImageUrl(data.image);
                    }
                    
                    // Make sure category is never undefined
                    const category = data.category || 'News';
                    
                    return {
                        id: doc.id,
                        title: data.title || 'Untitled',
                        date: date,
                        content: finalContent,
                        image: imageUrl,
                        author: data.author || 'Anonymous',
                        tags: data.tags || [],
                        views: data.views || 0,
                        category: category,
                        reactions: data.reactions || { love: 0 },
                        photojournalist: data.photojournalist || '' // Add photojournalist field
                    };
                });
                
                const newPosts = await Promise.all(newPostsPromises);

                if (loadMore) {
                    allPosts = [...allPosts, ...newPosts];
                } else {
                    allPosts = newPosts;
                    if (newPosts.length > 0) {
                        displayLatestPost(newPosts[0]);
                    }
                }

                displayPosts(newPosts.slice(loadMore ? 0 : 1), loadMore);

                lastVisible = snapshot.docs[snapshot.docs.length - 1];
                
                loadMoreBtn.style.display = snapshot.docs.length < postsPerPage ? 'none' : 'block';

            } catch (error) {
                console.error('Error loading posts:', error);
                showError('Failed to load articles. Please try again.');
            }
        }

        // Display latest post
        function displayLatestPost(post) {
            if (!post) return;
            
            latestPostContainer.innerHTML = `
                <div class="latest-post-header">
                    <img src="${post.image || '/placeholder.svg?height=400&width=800'}" alt="${post.title}">
                    ${post.photojournalist ? `<div class="photo-credit">Photos via ${post.photojournalist}</div>` : ''}
                    <div class="latest-post-overlay">
                        <div class="featured-label">Latest Article</div>
                        <h2 class="post-title">${post.title}</h2>
                    </div>
                    <div class="post-menu">
                        <button class="post-menu-btn">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div class="post-menu-content">
                            <a href="#" class="share-link" data-id="${post.id}"><i class="fas fa-share-alt"></i> Share</a>
                            <a href="#" class="bookmark-link" data-id="${post.id}"><i class="fas fa-bookmark"></i> Bookmark</a>
                            <a href="#" class="report-link" data-id="${post.id}"><i class="fas fa-flag"></i> Report</a>
                        </div>
                    </div>
                </div>
                <div class="latest-post-content">
                    <div class="post-meta">
                        <span class="post-date"><i class="far fa-calendar-alt"></i> ${post.date.toLocaleDateString()}</span>
                        <span class="post-author"><i class="far fa-user"></i> ${post.author || 'Anonymous'}</span>
                        <span class="post-reading-time"><i class="far fa-clock"></i> ${estimateReadingTime(post.content)} min read</span>
                        <span class="view-count"><i class="fas fa-eye"></i> ${post.views}</span>
                        <span class="post-category"><i class="fas fa-tag"></i> ${post.category}</span>
                    </div>
                    <div class="post-tags">${generateTags(post.tags)}</div>
                    <div class="post-content">${truncateContent(post.content, 300)}</div>
                    <div class="post-footer">
                        <a href="#" class="read-more" data-id="${post.id}">Read full article <i class="fas fa-arrow-right"></i></a>
                        <button class="reaction-btn" data-id="${post.id}" data-type="love">
                            <i class="far fa-heart"></i>
                            <span class="reaction-count">${post.reactions?.love || 0}</span>
                        </button>
                    </div>
                    <div class="social-share">
                        <button class="facebook" onclick="shareOnFacebook('${post.id}')"><i class="fab fa-facebook-f"></i> Share</button>
                        <button class="twitter" onclick="shareOnTwitter('${post.id}')"><i class="fab fa-twitter"></i> Tweet</button>
                        <button class="whatsapp" onclick="shareOnWhatsApp('${post.id}')"><i class="fab fa-whatsapp"></i> WhatsApp</button>
                    </div>
                </div>
            `;

            // Add event listeners for the latest post
            setupPostEventListeners(latestPostContainer, post);
            
            // Increment view count for the latest post
            incrementViewCount(post.id);
        }

        // Display posts in grid
        function displayPosts(posts, append = false) {
            if (!append) {
                postsContainer.innerHTML = '';
            }

            if (posts.length === 0 && !append) {
                postsContainer.innerHTML = `
                    <div class="no-posts fade-in">
                        <h2>No articles found</h2>
                        <p>Try a different category or check back later.</p>
                    </div>
                `;
                return;
            }

            posts.forEach((post, index) => {
                const postElement = document.createElement('article');
                postElement.className = 'post fade-in';
                postElement.style.animationDelay = `${(index * 0.1) + 0.3}s`;
           
                postElement.innerHTML = `
                    <div class="post-header">
                        <img src="${post.image || '/placeholder.svg?height=300&width=500'}" alt="${post.title}">
                        ${post.photojournalist ? `<div class="photo-credit">Photos via ${post.photojournalist}</div>` : ''}
                        <div class="post-menu">
                            <button class="post-menu-btn">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <div class="post-menu-content">
                                <a href="#" class="share-link" data-id="${post.id}"><i class="fas fa-share-alt"></i> Share</a>
                                <a href="#" class="bookmark-link" data-id="${post.id}"><i class="fas fa-bookmark"></i> Bookmark</a>
                                <a href="#" class="report-link" data-id="${post.id}"><i class="fas fa-flag"></i> Report</a>
                            </div>
                        </div>
                    </div>
                    <div class="post-body">
                        <h2 class="post-title">${post.title}</h2>
                        <div class="post-meta">
                            <span class="post-date"><i class="far fa-calendar-alt"></i> ${post.date.toLocaleDateString()}</span>
                            <span class="post-author"><i class="far fa-user"></i> ${post.author || 'Anonymous'}</span>
                        </div>
                        <div class="post-tags">${generateTags(post.tags)}</div>
                        <div class="post-content">${truncateContent(post.content, 150)}</div>
                        <div class="post-footer">
                            <a href="#" class="read-more" data-id="${post.id}">Read more <i class="fas fa-arrow-right"></i></a>
                            <button class="reaction-btn" data-id="${post.id}" data-type="love">
                                <i class="far fa-heart"></i>
                                <span class="reaction-count">${post.reactions?.love || 0}</span>
                            </button>
                        </div>
                    </div>
                `;
                
                postsContainer.appendChild(postElement);
                
                // Add event listeners for this post
                setupPostEventListeners(postElement, post);
            });
        }

        // Setup event listeners for post elements
        function setupPostEventListeners(element, post) {
            // Read more button
            const readMoreLink = element.querySelector('.read-more');
            if (readMoreLink) {
                readMoreLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    openFullscreen(post);
                });
            }
            
            // Post menu toggle
            const menuBtn = element.querySelector('.post-menu-btn');
            const menuContent = element.querySelector('.post-menu-content');
            if (menuBtn && menuContent) {
                menuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    menuContent.style.display = menuContent.style.display === 'block' ? 'none' : 'block';
                });
            }
            
            // Share link
            const shareLink = element.querySelector('.share-link');
            if (shareLink) {
                shareLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    sharePost(post);
                    menuContent.style.display = 'none';
                });
            }
            
            // Bookmark link
            const bookmarkLink = element.querySelector('.bookmark-link');
            if (bookmarkLink) {
                bookmarkLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    bookmarkPost(post);
                    menuContent.style.display = 'none';
                });
            }
            
            // Report link
            const reportLink = element.querySelector('.report-link');
            if (reportLink) {
                reportLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    reportPost(post);
                    menuContent.style.display = 'none';
                });
            }
            
            // Love reaction button
            const reactionBtn = element.querySelector('.reaction-btn');
            if (reactionBtn) {
                reactionBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleReaction(post.id, this);
                });
            }
        }

        // Truncate content for preview
        function truncateContent(content, maxLength) {
            let processedContent = content.replace(/<[^>]*>/g, '');
            if (processedContent.length <= maxLength) return processedContent;
            return processedContent.slice(0, maxLength) + '...';
        }

        // Load comments for a post
        async function loadComments(postId, container) {
            const commentsContainer = container.querySelector('.comments-container');
            const commentsCount = container.querySelector('.comments-count');
            
            if (!commentsContainer) return;
            
            commentsContainer.innerHTML = `
                <div class="comments-loading">
                    <div class="loading-spinner" style="width: 30px; height: 30px;"></div>
                    <p>Loading comments...</p>
                </div>
            `;
            
            try {
                const snapshot = await db.collection('comments')
                    .where('postId', '==', postId)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                if (snapshot.empty) {
                    commentsContainer.innerHTML = `
                        <div class="no-comments">
                            <p>No comments yet. Be the first to comment!</p>
                        </div>
                    `;
                    commentsCount.textContent = '0';
                    return;
                }
                
                const comments = snapshot.docs.map(doc => {
                    const data = doc.data();
                    return {
                        id: doc.id,
                        text: data.text,
                        author: data.author || 'Anonymous',
                        photoURL: data.photoURL || null,
                        timestamp: data.timestamp ? new Date(data.timestamp.seconds * 1000) : new Date()
                    };
                });
                
                commentsContainer.innerHTML = '';
                
                comments.forEach(comment => {
                    const commentElement = document.createElement('div');
                    commentElement.className = 'comment';
                    
                    // Get initials for avatar if no photo
                    const initials = comment.author.charAt(0).toUpperCase();
                    
                    commentElement.innerHTML = `
                        <div class="comment-header">
                            <div class="comment-user-info">
                                <div class="comment-avatar">
                                    ${comment.photoURL ? `<img src="${comment.photoURL}" alt="${comment.author}">` : initials}
                                </div>
                                <div class="comment-author">${comment.author}</div>
                            </div>
                            <div class="comment-date">${formatCommentDate(comment.timestamp)}</div>
                        </div>
                        <div class="comment-body">${comment.text}</div>
                    `;
                    
                    commentsContainer.appendChild(commentElement);
                });
                
                commentsCount.textContent = comments.length.toString();
                
            } catch (error) {
                console.error('Error loading comments:', error);
                commentsContainer.innerHTML = `
                    <div class="error" style="padding: 20px;">
                        <p>Failed to load comments. Please try again.</p>
                    </div>
                `;
            }
        }
        
        // Format comment date
        function formatCommentDate(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSecs = Math.floor(diffMs / 1000);
            const diffMins = Math.floor(diffSecs / 60);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffSecs < 60) {
                return 'Just now';
            } else if (diffMins < 60) {
                return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
            } else if (diffHours < 24) {
                return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            } else if (diffDays < 7) {
                return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            } else {
                return date.toLocaleDateString();
            }
        }
        
        // Add a comment
        async function addComment(postId, text, form) {
            if (!text.trim()) {
                showToast('Please enter a comment');
                return;
            }
            
            // Show login modal if not logged in
            if (!currentUser) {
                showLoginModal(() => {
                    // This will be called after login
                    if (currentUser) {
                        addComment(postId, text, form);
                    }
                });
                return;
            }
            
            const submitButton = form.querySelector('.comment-submit');
            const commentInput = form.querySelector('.comment-input');
            
            // Disable the submit button and show loading state
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Posting...';
            
            try {
                // Create a new comment document
                const commentData = {
                    postId: postId,
                    text: text.trim(),
                    author: currentUser.displayName || 'Anonymous',
                    photoURL: currentUser.photoURL || null,
                    userId: currentUser.uid || null,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('comments').add(commentData);
                
                // Clear the input and re-enable the button
                commentInput.value = '';
                submitButton.disabled = false;
                submitButton.innerHTML = 'Post Comment';
                
                // Show success message
                showToast('Comment posted successfully!');
                
                // Reload comments to show the new one
                const fullscreenElement = document.querySelector('.fullscreen');
                if (fullscreenElement) {
                    loadComments(postId, fullscreenElement);
                }
                
            } catch (error) {
                console.error('Error adding comment:', error);
                submitButton.disabled = false;
                submitButton.innerHTML = 'Post Comment';
                showToast('Failed to post comment. Please try again.');
            }
        }

        // Open fullscreen article view
        async function openFullscreen(post) {
            const fullscreenElement = document.createElement('div');
            fullscreenElement.className = 'fullscreen';
            
            // Check if post has reactions
            const reactions = post.reactions || { love: 0 };
            const isLoved = await checkIfUserLoved(post.id);
            
            fullscreenElement.innerHTML = `
                <div class="close-fullscreen">&times;</div>
                <div class="fullscreen-header" style="background-image: url('${post.image || '/placeholder.svg?height=800&width=1200'}')">
                    <div class="fullscreen-header-overlay"></div>
                    ${post.photojournalist ? `<div class="photo-credit">Photos via ${post.photojournalist}</div>` : ''}
                    <div class="fullscreen-header-content">
                        <h1 class="post-title">${post.title}</h1>
                        <div class="post-meta">
                            <span class="post-date"><i class="far fa-calendar-alt"></i> ${post.date.toLocaleDateString()}</span>
                            <span class="post-author"><i class="far fa-user"></i> ${post.author || 'Anonymous'}</span>
                            <span class="post-reading-time"><i class="far fa-clock"></i> ${estimateReadingTime(post.content)} min read</span>
                            <span class="view-count"><i class="fas fa-eye"></i> ${post.views + 1}</span>
                            <span class="post-category"><i class="fas fa-tag"></i> ${post.category}</span>
                        </div>
                    </div>
                </div>
                <div class="fullscreen-content">
                    <div class="post-tags">${generateTags(post.tags)}</div>
                    <div class="post-content">${post.content}</div>
                    <div class="fullscreen-reactions">
                        <button class="fullscreen-reaction-btn love ${isLoved ? 'active' : ''}" data-id="${post.id}">
                            <i class="${isLoved ? 'fas' : 'far'} fa-heart"></i>
                            <span>${reactions.love || 0}</span> Love
                        </button>
                        <button class="fullscreen-reaction-btn bookmark">
                            <i class="far fa-bookmark"></i> Bookmark
                        </button>
                        <div class="social-share">
                            <button class="facebook" onclick="shareOnFacebook('${post.id}')"><i class="fab fa-facebook-f"></i> Share</button>
                            <button class="twitter" onclick="shareOnTwitter('${post.id}')"><i class="fab fa-twitter"></i> Tweet</button>
                        </div>
                    </div>
                    <div class="comments-section">
                        <div class="comments-header">
                            <h3>Comments</h3>
                            <span class="comments-count">0</span>
                        </div>
                        <div class="comment-form">
                            <textarea class="comment-input" placeholder="Write a comment..." rows="3"></textarea>
                            <button class="comment-submit">Post Comment</button>
                        </div>
                        <div class="comments-container"></div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(fullscreenElement);

            // Trigger reflow to enable the transition
            fullscreenElement.offsetHeight;
            fullscreenElement.classList.add('active');

            // Add event listener for close button
            const closeButton = fullscreenElement.querySelector('.close-fullscreen');
            closeButton.addEventListener('click', function() {
                fullscreenElement.classList.remove('active');
                setTimeout(() => {
                    document.body.removeChild(fullscreenElement);
                    history.pushState(null, '', window.location.pathname); // Remove the post ID from the URL
                }, 300); // Wait for the transition to complete
            });

            // Add event listener for love reaction
            const loveButton = fullscreenElement.querySelector('.fullscreen-reaction-btn.love');
            loveButton.addEventListener('click', function() {
                toggleReaction(post.id, this);
            });

            // Add event listener for bookmark
            const bookmarkButton = fullscreenElement.querySelector('.fullscreen-reaction-btn.bookmark');
            bookmarkButton.addEventListener('click', function() {
                bookmarkPost(post);
            });
            
            // Add event listener for comment form
            const commentForm = fullscreenElement.querySelector('.comment-form');
            const commentSubmit = commentForm.querySelector('.comment-submit');
            const commentInput = commentForm.querySelector('.comment-input');
            
            commentSubmit.addEventListener('click', function() {
                addComment(post.id, commentInput.value, commentForm);
            });
            
            // Allow submitting with Enter key (Shift+Enter for new line)
            commentInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    addComment(post.id, commentInput.value, commentForm);
                }
            });

            // Update the URL with the post ID
            history.pushState(null, '', `?post=${post.id}`);

            // Increment view count
            await incrementViewCount(post.id);
            
            // Load comments
            loadComments(post.id, fullscreenElement);
        }

        // Check if user has loved a post
        async function checkIfUserLoved(postId) {
            // Generate a unique user ID or use an existing one
            const userId = getUserId();
            
            try {
                const snapshot = await rtdb.ref(`reactions/${postId}/users/${userId}`).once('value');
                return snapshot.exists() && snapshot.val() === true;
            } catch (error) {
                console.error('Error checking if user loved post:', error);
                return false;
            }
        }

        // Toggle love reaction
        async function toggleReaction(postId, button) {
            // Generate a unique user ID or use an existing one
            const userId = getUserId();
            
            try {
                // Check if user already reacted
                const userReactionRef = rtdb.ref(`reactions/${postId}/users/${userId}`);
                const snapshot = await userReactionRef.once('value');
                const hasReacted = snapshot.exists() && snapshot.val() === true;
                
                // Toggle reaction
                if (hasReacted) {
                    // Remove reaction
                    await userReactionRef.remove();
                    await db.collection('articles').doc(postId).update({
                        'reactions.love': firebase.firestore.FieldValue.increment(-1)
                    });
                    
                    // Update UI
                    const countElement = button.querySelector('.reaction-count') || button.querySelector('span');
                    const iconElement = button.querySelector('i');
                    const currentCount = parseInt(countElement.textContent);
                    
                    countElement.textContent = Math.max(0, currentCount - 1);
                    
                    if (iconElement.classList.contains('fas')) {
                        iconElement.classList.replace('fas', 'far');
                    }
                    
                    button.classList.remove('active');
                    
                } else {
                    // Add reaction
                    await userReactionRef.set(true);
                    await db.collection('articles').doc(postId).update({
                        'reactions.love': firebase.firestore.FieldValue.increment(1)
                    });
                    
                    // Update UI
                    const countElement = button.querySelector('.reaction-count') || button.querySelector('span');
                    const iconElement = button.querySelector('i');
                    const currentCount = parseInt(countElement.textContent);
                    
                    countElement.textContent = currentCount + 1;
                    
                    if (iconElement.classList.contains('far')) {
                        iconElement.classList.replace('far', 'fas');
                    }
                    
                    button.classList.add('active');
                    
                    // Add heart animation
                    iconElement.classList.add('heart-beat');
                    setTimeout(() => {
                        iconElement.classList.remove('heart-beat');
                    }, 1000);
                    
                    // Create floating hearts
                    createFloatingHearts(button);
                }
                
                // Update the post in allPosts array
                const postIndex = allPosts.findIndex(p => p.id === postId);
                if (postIndex !== -1) {
                    if (!allPosts[postIndex].reactions) {
                        allPosts[postIndex].reactions = { love: 0 };
                    }
                    
                    allPosts[postIndex].reactions.love = hasReacted 
                        ? Math.max(0, (allPosts[postIndex].reactions.love || 1) - 1)
                        : (allPosts[postIndex].reactions.love || 0) + 1;
                }
                
            } catch (error) {
                console.error('Error toggling reaction:', error);
                showToast('Failed to save your reaction. Please try again.');
            }
        }

        // Create floating hearts animation
        function createFloatingHearts(button) {
            const heartsContainer = document.createElement('div');
            heartsContainer.className = 'floating-hearts';
            
            // Position the container near the button
            const rect = button.getBoundingClientRect();
            heartsContainer.style.position = 'fixed';
            heartsContainer.style.left = `${rect.left + rect.width / 2}px`;
            heartsContainer.style.top = `${rect.top}px`;
            
            document.body.appendChild(heartsContainer);
            
            // Create multiple hearts with random paths
            for (let i = 0; i < 7; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.innerHTML = '<i class="fas fa-heart"></i>';
                
                // Random horizontal movement
                const tx = (Math.random() - 0.5) * 120;
                heart.style.setProperty('--tx', `${tx}px`);
                
                // Random delay
                heart.style.animationDelay = `${i * 0.1}s`;
                
                heartsContainer.appendChild(heart);
            }
            
            // Remove the container after animations complete
            setTimeout(() => {
                document.body.removeChild(heartsContainer);
            }, 2000);
        }

        // Increment view count
        async function incrementViewCount(postId) {
            try {
                const postRef = db.collection('articles').doc(postId);
                await postRef.update({
                    views: firebase.firestore.FieldValue.increment(1)
                });
                
                // Update the local post object
                const postIndex = allPosts.findIndex(p => p.id === postId);
                if (postIndex !== -1) {
                    allPosts[postIndex].views++;
                }
            } catch (error) {
                console.error('Error incrementing view count:', error);
            }
        }

        // Share post
        function sharePost(post) {
            const shareUrl = `${window.location.origin}${window.location.pathname}?post=${post.id}`;
            
            if (navigator.share) {
                navigator.share({
                    title: post.title,
                    text: 'Check out this article from Ang Silakbo!',
                    url: shareUrl
                }).then(() => {
                    showToast('Article shared successfully!');
                }).catch((error) => {
                    console.log('Error sharing:', error);
                    prompt('Copy this link to share:', shareUrl);
                });
            } else {
                prompt('Copy this link to share:', shareUrl);
            }
        }

        // Bookmark post
        function bookmarkPost(post) {
            // Get existing bookmarks from localStorage
            let bookmarks = JSON.parse(localStorage.getItem('silakbo_bookmarks') || '[]');
            
            // Check if already bookmarked
            const isBookmarked = bookmarks.some(bookmark => bookmark.id === post.id);
            
            if (isBookmarked) {
                // Remove from bookmarks
                bookmarks = bookmarks.filter(bookmark => bookmark.id !== post.id);
                localStorage.setItem('silakbo_bookmarks', JSON.stringify(bookmarks));
                showToast('Bookmark removed');
            } else {
                // Add to bookmarks
                const bookmarkData = {
                    id: post.id,
                    title: post.title,
                    date: post.date.toISOString(),
                    author: post.author,
                    category: post.category
                };
                
                bookmarks.push(bookmarkData);
                localStorage.setItem('silakbo_bookmarks', JSON.stringify(bookmarks));
                showToast('Article bookmarked!');
            }
        }

        // Report post
        function reportPost(post) {
            const reason = prompt('Please provide a reason for reporting this article:');
            
            if (reason) {
                // Here you would typically send this to your backend
                console.log(`Article ${post.id} reported: ${reason}`);
                showToast('Thank you for your report. We will review this article.');
            }
        }

        // Estimate reading time
        function estimateReadingTime(content) {
            const wordsPerMinute = 200;
            const wordCount = content.trim().split(/\s+/).length;
            return Math.max(1, Math.ceil(wordCount / wordsPerMinute));
        }

        // Generate tags HTML
        function generateTags(tags) {
            if (!tags || tags.length === 0) return '';
            return tags.map(tag => `<span class="tag">${tag}</span>`).join('');
        }

        // Social sharing functions
        function shareOnFacebook(postId) {
            const shareUrl = `${window.location.origin}${window.location.pathname}?post=${postId}`;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank');
        }

        function shareOnTwitter(postId) {
            const shareUrl = `${window.location.origin}${window.location.pathname}?post=${postId}`;
            const text = 'Check out this article from Ang Silakbo!';
            window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(text)}`, '_blank');
        }

        function shareOnWhatsApp(postId) {
            const shareUrl = `${window.location.origin}${window.location.pathname}?post=${postId}`;
            const text = 'Check out this article from Ang Silakbo!';
            window.open(`https://wa.me/?text=${encodeURIComponent(text + ' ' + shareUrl)}`, '_blank');
        }

        // Get or create user ID
        function getUserId() {
            let userId = localStorage.getItem('silakbo_user_id');
            
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('silakbo_user_id', userId);
            }
            
            return userId;
        }

        // Function to open a specific post from a shared link
        async function openSharedPost() {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('post');
            
            if (postId) {
                const post = allPosts.find(p => p.id === postId);
                if (post) {
                    await openFullscreen(post);
                } else {
                    // If the post is not in allPosts, fetch it from Firestore
                    try {
                        const doc = await db.collection('articles').doc(postId).get();
                        if (doc.exists) {
                            const data = doc.data();
                            
                            // Extract first image from content if available
                            const { imageUrl: contentImageUrl, updatedContent } = extractFirstImage(data.content || '');
                            
                            // Use the image from content if available, otherwise use the provided image
                            let imageUrl;
                            let finalContent = data.content || '';
                            
                            if (contentImageUrl) {
                                imageUrl = contentImageUrl;
                                finalContent = updatedContent;
                            } else {
                                imageUrl = await getImageUrl(data.image);
                            }
                            
                            // Make sure category is never undefined
                            const category = data.category || 'News';
                            
                            const post = {
                                id: doc.id,
                                title: data.title || 'Untitled',
                                date: data.timestamp ? new Date(data.timestamp.seconds * 1000) : new Date(),
                                content: finalContent,
                                image: imageUrl,
                                author: data.author || 'Anonymous',
                                tags: data.tags || [],
                                views: data.views || 0,
                                category: category,
                                reactions: data.reactions || { love: 0 },
                                photojournalist: data.photojournalist || ''
                            };
                            await openFullscreen(post);
                        } else {
                            console.log('No such document!');
                            showToast('Article not found');
                        }
                    } catch (error) {
                        console.error('Error getting document:', error);
                        showToast('Error loading article');
                    }
                }
            }
        }

        // Search posts
        function searchPosts() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (searchTerm === '') {
                displayPosts(allPosts.slice(1)); // Skip the first post (latest)
                return;
            }
            
            const filteredPosts = allPosts.filter(post => 
                post.title.toLowerCase().includes(searchTerm) || 
                post.content.toLowerCase().includes(searchTerm) ||
                (post.author && post.author.toLowerCase().includes(searchTerm)) ||
                (post.tags && post.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
                (post.tags && post.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
            );
            
            displayPosts(filteredPosts);
            
            if (filteredPosts.length === 0) {
                postsContainer.innerHTML = `
                    <div class="no-posts fade-in">
                        <h2>No results found</h2>
                        <p>Try different keywords or browse all articles.</p>
                    </div>
                `;
            }
        }

        // Show login modal
        function showLoginModal(callback) {
            loginModal.classList.add('active');
            
            // Store the callback to be called after login
            window.loginCallback = callback;
            
            // Focus trap for accessibility
            setTimeout(() => {
                googleLoginBtn.focus();
            }, 100);
        }

        // Hide login modal
        function hideLoginModal() {
            loginModal.classList.remove('active');
        }

        // Sign in with Google
        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
                hideLoginModal();
                
                // Call the callback if it exists
                if (typeof window.loginCallback === 'function') {
                    window.loginCallback();
                    window.loginCallback = null;
                }
                
                showToast('Signed in successfully!');
            } catch (error) {
                console.error('Error signing in with Google:', error);
                showToast('Failed to sign in. Please try again.');
            }
        }

        // Sign in anonymously
        async function signInAnonymously() {
            try {
                await auth.signInAnonymously();
                hideLoginModal();
                
                // Call the callback if it exists
                if (typeof window.loginCallback === 'function') {
                    window.loginCallback();
                    window.loginCallback = null;
                }
                
                showToast('Continuing as Anonymous');
            } catch (error) {
                console.error('Error signing in anonymously:', error);
                showToast('Failed to continue as Anonymous. Please try again.');
            }
        }

        // Sign out
        async function signOut() {
            try {
                await auth.signOut();
                showToast('Signed out successfully!');
            } catch (error) {
                console.error('Error signing out:', error);
                showToast('Failed to sign out. Please try again.');
            }
        }

        // Update UI based on auth state
        function updateUserUI(user) {
            if (user) {
                // User is signed in
                if (user.isAnonymous) {
                    userInfo.innerHTML = `
                        <div class="user-avatar">
                            <i class="fas fa-user-secret"></i>
                        </div>
                        <span class="user-name">Anonymous</span>
                        <button class="login-btn" id="sign-out-button">Sign Out</button>
                    `;
                } else {
                    const displayName = user.displayName || 'User';
                    const firstName = displayName.split(' ')[0];
                    userInfo.innerHTML = `
                        <div class="user-avatar">
                            ${user.photoURL ? `<img src="${user.photoURL}" alt="${displayName}">` : firstName.charAt(0).toUpperCase()}
                        </div>
                        <span class="user-name">${firstName}</span>
                        <button class="login-btn" id="sign-out-button">Sign Out</button>
                    `;
                }
                
                // Add sign out event listener
                const signOutBtn = document.getElementById('sign-out-button');
                if (signOutBtn) {
                    signOutBtn.addEventListener('click', signOut);
                }
            } else {
                // User is signed out
                userInfo.innerHTML = `
                    <button class="login-btn" id="login-button">Sign In</button>
                `;
                
                // Re-attach event listener
                const loginBtn = document.getElementById('login-button');
                if (loginBtn) {
                    loginBtn.addEventListener('click', () => showLoginModal());
                }
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Auth state change listener
            auth.onAuthStateChanged(user => {
                currentUser = user;
                updateUserUI(user);
            });
            
            // Load posts
            loadPosts();
            
            // Check for shared post
            openSharedPost();
            
            // Search input
            searchInput.addEventListener('input', debounce(searchPosts, 300));
            
            // Category filter
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    currentCategory = this.dataset.category;
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    lastVisible = null;
                    loadPosts();
                });
            });
            
            // Load more button
            loadMoreBtn.addEventListener('click', () => loadPosts(true));
            
            // Mobile menu toggle
            mobileMenuBtn.addEventListener('click', () => {
                navLinks.classList.toggle('active');
            });
            
            // Back to top button
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopBtn.classList.add('visible');
                } else {
                    backToTopBtn.classList.remove('visible');
                }
            });
            
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
            
            // Close post menus when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.post-menu')) {
                    document.querySelectorAll('.post-menu-content').forEach(menu => {
                        menu.style.display = 'none';
                    });
                }
            });
            
            // Listen for popstate events (back/forward navigation)
            window.addEventListener('popstate', function() {
                const fullscreenElement = document.querySelector('.fullscreen');
                if (fullscreenElement) {
                    fullscreenElement.classList.remove('active');
                    setTimeout(() => {
                        document.body.removeChild(fullscreenElement);
                    }, 300);
                }
                openSharedPost();
            });
            
            // Login modal events
            loginButton.addEventListener('click', () => showLoginModal());
            
            googleLoginBtn.addEventListener('click', signInWithGoogle);
            
            anonymousLoginBtn.addEventListener('click', signInAnonymously);
            
            loginModalClose.addEventListener('click', hideLoginModal);
            
            // Close modal when clicking outside
            loginModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    hideLoginModal();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && loginModal.classList.contains('active')) {
                    hideLoginModal();
                }
            });
        });

        // Utility function: Debounce
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }
        
        // Make functions available globally for event handlers
        window.shareOnFacebook = shareOnFacebook;
        window.shareOnTwitter = shareOnTwitter;
        window.shareOnWhatsApp = shareOnWhatsApp;
    </script>
</body>
</html>
