<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANG SILAKBO - Text Analysis Tool</title>
    <link rel="icon" href="SILAKBO.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700&family=Playfair+Display:wght@400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #e65100;
            --primary-light: #ff833a;
            --primary-dark: #ac1900;
            --primary-transparent: rgba(230, 81, 0, 0.1);
            --primary-bg: rgba(230, 81, 0, 0.05);
            --primary-bg-medium: rgba(230, 81, 0, 0.15);
            --white: #ffffff;
            --off-white: #f9f9f9;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #757575;
            --text-dark: #333333;
            --text-light: #ffffff;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --border-radius-round: 50px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background-color: var(--off-white);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }

        h1, h2, h3 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }

        p, li {
            font-family: 'Source Sans Pro', sans-serif;
        }

        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: auto 1fr auto;
            grid-template-areas:
                "sidebar header"
                "sidebar main"
                "sidebar footer";
            height: 100vh;
            overflow: hidden;
        }

        /* Header Styles */
        .header {
            grid-area: header;
            background: var(--white);
            padding: 1rem 2rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            border-bottom: 1px solid var(--primary-bg-medium);
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
        }

        .logo-img {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 2px 8px rgba(230, 81, 0, 0.2);
            border: 2px solid var(--primary-light);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        /* Sidebar Styles - Now White */
        .sidebar {
            grid-area: sidebar;
            background: var(--white);
            color: var(--text-dark);
            padding: 2rem 0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.05);
            z-index: 20;
            border-right: 1px solid var(--medium-gray);
        }

        .sidebar-header {
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid var(--medium-gray);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .sidebar-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
            letter-spacing: 0.5px;
            color: var(--primary);
        }

        .sidebar-header p {
            font-size: 0.9rem;
            color: var(--dark-gray);
            font-family: 'Source Sans Pro', sans-serif;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0 1rem;
            margin-bottom: 2rem;
        }

        .sidebar-menu-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0.5rem 1rem;
            color: var(--dark-gray);
            margin-bottom: 0.5rem;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }

        .sidebar-menu-item {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem 1rem;
            color: var(--text-dark);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-family: 'Source Sans Pro', sans-serif;
        }

        .sidebar-menu-link:hover {
            background: var(--primary-bg);
            color: var(--primary);
            transform: translateX(5px);
        }

        .sidebar-menu-link.active {
            background: var(--primary-bg);
            color: var(--primary);
            font-weight: 500;
        }

        .sidebar-menu-link i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
            color: var(--primary);
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 1.5rem;
            border-top: 1px solid var(--medium-gray);
            text-align: center;
            font-size: 0.9rem;
            color: var(--dark-gray);
            font-family: 'Source Sans Pro', sans-serif;
        }

        /* Main Content Styles */
        .main-content {
            grid-area: main;
            padding: 2rem;
            overflow-y: auto;
            background-color: var(--off-white);
            position: relative;
            background-image: 
                radial-gradient(circle at 10% 20%, var(--primary-transparent) 0%, transparent 25%),
                radial-gradient(circle at 90% 80%, var(--primary-transparent) 0%, transparent 25%);
            background-attachment: fixed;
        }

        .editor-container {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 140px); /* Make editor taller */
            border: 1px solid var(--primary-bg-medium);
        }

        .editor-toolbar {
            background: var(--white);
            padding: 1rem;
            border-bottom: 1px solid var(--primary-bg-medium);
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .toolbar-group {
            display: flex;
            gap: 0.3rem;
            padding: 0.3rem;
            border-right: 1px solid var(--light-gray);
            margin-right: 0.5rem;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .editor-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            outline: none;
            line-height: 1.8;
            font-size: 1rem;
            background-color: var(--white);
            font-family: 'Merriweather', serif;
        }

        .editor:focus {
            outline: none;
        }

        .editor-statusbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 1.5rem;
            background: var(--primary-bg);
            font-size: 0.9rem;
            color: var(--dark-gray);
            border-top: 1px solid var(--primary-bg-medium);
            font-family: 'Source Sans Pro', sans-serif;
        }

        /* Button Styles */
        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            background: var(--light-gray);
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif;
        }

        .btn:hover {
            background: var(--medium-gray);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-light);
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-sm);
        }

        .btn-icon:hover {
            background: var(--primary-bg);
            color: var(--primary);
        }

        .btn-icon.active {
            background: var(--primary-transparent);
            color: var(--primary);
        }

        /* AI Analysis Panel */
        .analysis-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--white);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--primary-bg-medium);
        }

        .analysis-panel.active {
            right: 0;
        }

        .analysis-header {
            padding: 1.5rem;
            background: var(--primary);
            color: var(--white);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .analysis-header h3 {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-family: 'Poppins', sans-serif;
        }

        .analysis-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--white);
            transition: var(--transition);
        }

        .analysis-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .analysis-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .analysis-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--primary-bg-medium);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: var(--primary-bg);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: all 0.3s ease;
            border: 1px solid var(--primary-bg-medium);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.2rem 1.5rem;
            background: var(--primary);
            color: var(--white);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }

        .modal-header h3 {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-size: 1.2rem;
            font-family: 'Poppins', sans-serif;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--white);
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            border-top: 1px solid var(--primary-bg-medium);
            background: var(--primary-bg);
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--white);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--primary-bg-medium);
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-header {
            padding: 1.5rem;
            background: var(--primary);
            color: var(--white);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-header h3 {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-family: 'Poppins', sans-serif;
        }

        .settings-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--white);
            transition: var(--transition);
        }

        .settings-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .settings-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: 2rem;
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--primary-bg-medium);
        }

        .settings-section-title {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Poppins', sans-serif;
        }

        .settings-option {
            margin-bottom: 1.2rem;
        }

        .settings-option label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-family: 'Source Sans Pro', sans-serif;
        }

        .settings-option select,
        .settings-option input {
            width: 100%;
            padding: 0.8rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--medium-gray);
            background: var(--white);
            font-family: 'Source Sans Pro', sans-serif;
        }

        .settings-option select:focus,
        .settings-option input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-transparent);
        }

        .settings-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--primary-bg-medium);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: var(--primary-bg);
        }

        /* Notes Panel */
        .notes-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--white);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--primary-bg-medium);
        }

        .notes-panel.active {
            right: 0;
        }

        .notes-header {
            padding: 1.5rem;
            background: var(--primary);
            color: var(--white);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notes-header h3 {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-family: 'Poppins', sans-serif;
        }

        .notes-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--white);
            transition: var(--transition);
        }

        .notes-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .notes-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: var(--primary-bg);
        }

        .notes-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--primary-bg-medium);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: var(--primary-bg);
        }

        .note-item {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1.2rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--primary-bg-medium);
        }

        .note-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            border-color: var(--primary-light);
        }

        .note-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: var(--primary);
            font-family: 'Poppins', sans-serif;
        }

        .note-date {
            font-size: 0.8rem;
            color: var(--dark-gray);
            font-family: 'Source Sans Pro', sans-serif;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 0.5rem 0;
            z-index: 1000;
            display: none;
            min-width: 200px;
            border: 1px solid var(--primary-bg-medium);
        }

        .context-menu-item {
            padding: 0.7rem 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transition: var(--transition);
            font-family: 'Source Sans Pro', sans-serif;
        }

        .context-menu-item:hover {
            background: var(--primary-bg);
            color: var(--primary);
        }

        .context-menu-divider {
            height: 1px;
            background: var(--primary-bg-medium);
            margin: 0.5rem 0;
        }

        /* Loading Indicator */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }

        .loading-spinner {
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow);
            z-index: 1000;
            max-width: 350px;
            border-left: 4px solid var(--primary);
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: var(--primary);
            font-family: 'Poppins', sans-serif;
        }

        .notification-message {
            font-size: 0.9rem;
            font-family: 'Source Sans Pro', sans-serif;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: var(--border-radius-round);
            font-size: 0.75rem;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
        }

        .badge-success {
            background: var(--primary-transparent);
            color: var(--primary);
        }

        .badge-warning {
            background: var(--primary-transparent);
            color: var(--primary);
        }

        .badge-error {
            background: var(--primary-transparent);
            color: var(--primary);
        }

        .badge-info {
            background: var(--primary-transparent);
            color: var(--primary);
        }

        /* Result Card */
        .result-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1.2rem;
            margin-bottom: 1.2rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--primary-bg-medium);
        }

        .result-title {
            font-weight: 600;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            color: var(--primary);
            font-family: 'Poppins', sans-serif;
        }

        .result-content {
            padding: 1rem;
            background: var(--primary-bg);
            border-radius: var(--border-radius);
            border-left: 3px solid var(--primary);
            font-family: 'Source Sans Pro', sans-serif;
        }

        /* Grammar Check Results */
        .grammar-item {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: var(--border-radius);
            background: var(--primary-bg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--primary-bg-medium);
        }

        .grammar-original {
            text-decoration: line-through;
            color: var(--primary);
            font-family: 'Merriweather', serif;
        }

        .grammar-suggestion {
            color: var(--primary);
            font-weight: 600;
            font-family: 'Merriweather', serif;
        }

        /* Keywords */
        .keywords-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .keyword {
            background: var(--primary-bg);
            color: var(--primary);
            padding: 0.6rem 1.2rem;
            border-radius: var(--border-radius-round);
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid var(--primary-bg-medium);
            font-family: 'Poppins', sans-serif;
        }

        .keyword:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            background: var(--primary);
            color: var(--white);
        }

        /* Sentiment Analysis */
        .sentiment-meter {
            height: 10px;
            width: 100%;
            background: var(--light-gray);
            border-radius: var(--border-radius-round);
            margin: 1.2rem 0;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .sentiment-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            top: -5px;
            transform: translateX(-50%);
            transition: left 0.5s ease;
            box-shadow: 0 0 15px rgba(230, 81, 0, 0.5);
        }

        .sentiment-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--dark-gray);
            font-family: 'Source Sans Pro', sans-serif;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.05);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1001;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0;
            transition: width 0.3s ease;
        }

        /* Tutorial Button */
        .tutorial-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: none;
            font-size: 1.5rem;
            z-index: 90;
        }

        .tutorial-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 25px rgba(230, 81, 0, 0.3);
        }

        /* Mobile Styles */
        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "header"
                    "main"
                    "footer";
            }

            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                bottom: 0;
                transition: left 0.3s ease;
            }

            .sidebar.active {
                left: 0;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .analysis-panel,
            .settings-panel,
            .notes-panel {
                width: 100%;
                right: -100%;
            }

            .editor-container {
                height: calc(100vh - 120px);
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }

            .main-content {
                padding: 1rem;
            }

            .editor {
                padding: 1rem;
            }

            .toolbar-group {
                margin-bottom: 0.5rem;
            }

            .tutorial-btn {
                bottom: 1rem;
                right: 1rem;
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-dark);
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 992px) {
            .mobile-menu-toggle {
                display: block;
            }
        }

        /* Footer */
        .footer {
            grid-area: footer;
            background: var(--white);
            padding: 1rem 2rem;
            text-align: center;
            font-size: 0.9rem;
            color: var(--dark-gray);
            border-top: 1px solid var(--primary-bg-medium);
            font-family: 'Source Sans Pro', sans-serif;
        }
    </style>
</head>
<body>
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="Coral.png" alt="SILAKBO Logo" class="logo-img" style="width: 80px; height: 80px; margin-bottom: 1rem;">
                <h2>CoralVIA</h2>
                <p>Text Analysis Tool</p>
            </div>

            <div class="sidebar-menu">
                <div class="sidebar-menu-title">Document</div>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link active" id="btn-new-document">
                            <i class="fas fa-file"></i> New Document
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-save">
                            <i class="fas fa-save"></i> Save Document
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-load">
                            <i class="fas fa-folder-open"></i> Load Document
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-export">
                            <i class="fas fa-file-export"></i> Export Document
                        </a>
                    </li>
                </ul>

                <div class="sidebar-menu-title">AI Analysis</div>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-summarize">
                            <i class="fas fa-compress-alt"></i> Summarize
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-grammar">
                            <i class="fas fa-spell-check"></i> Grammar Check
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-plagiarism">
                            <i class="fas fa-search"></i> Plagiarism Check
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-sentiment">
                            <i class="fas fa-smile"></i> Sentiment Analysis
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-keywords">
                            <i class="fas fa-key"></i> Extract Keywords
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-translate">
                            <i class="fas fa-language"></i> Translate
                        </a>
                    </li>
                </ul>

                <div class="sidebar-menu-title">Tools</div>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-notes-toggle">
                            <i class="fas fa-sticky-note"></i> Notes
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-settings-toggle">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" id="btn-help">
                            <i class="fas fa-question-circle"></i> Help
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="tutorial.html" class="sidebar-menu-link" id="btn-tutorial">
                            <i class="fas fa-book"></i> Tutorial
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-footer">
                &copy; 2025 ANG SILAKBO
            </div>
        </aside>

        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <img src="SILAKBO.png" alt="SILAKBO Logo" class="logo-img">
                <h1>ANG SILAKBO</h1>
            </div>
            <div class="header-actions">
                <button class="btn" id="btn-clear">
                    <i class="fas fa-trash-alt"></i> Clear
                </button>
                <button class="btn btn-primary" id="btn-analyze">
                    <i class="fas fa-robot"></i> Analyze
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="editor-container">
                <div class="editor-toolbar">
                    <div class="toolbar-group">
                        <button class="btn btn-icon" id="btn-bold" title="Bold">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button class="btn btn-icon" id="btn-italic" title="Italic">
                            <i class="fas fa-italic"></i>
                        </button>
                        <button class="btn btn-icon" id="btn-underline" title="Underline">
                            <i class="fas fa-underline"></i>
                        </button>
                    </div>
                    <div class="toolbar-group">
                        <button class="btn btn-icon" id="btn-list" title="Bullet List">
                            <i class="fas fa-list-ul"></i>
                        </button>
                        <button class="btn btn-icon" id="btn-numbering" title="Numbered List">
                            <i class="fas fa-list-ol"></i>
                        </button>
                    </div>
                    <div class="toolbar-group">
                        <button class="btn btn-icon" id="btn-link" title="Insert Link">
                            <i class="fas fa-link"></i>
                        </button>
                        <button class="btn btn-icon" id="btn-quote" title="Blockquote">
                            <i class="fas fa-quote-right"></i>
                        </button>
                        <button class="btn btn-icon" id="btn-code" title="Code Block">
                            <i class="fas fa-code"></i>
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div class="editor" id="editor" contenteditable="true">
                        <p>Welcome to <strong>ANG SILAKBO</strong> - your advanced text analysis tool!</p>
                        <p>Start typing here or paste your text. Use the toolbar above to format your content or analyze your writing.</p>
                        <p>Key features:</p>
                        <ul>
                            <li>Grammar and spelling check</li>
                            <li>Plagiarism detection</li>
                            <li>Sentiment analysis</li>
                            <li>Text summarization</li>
                            <li>Keyword extraction</li>
                            <li>Translation services</li>
                        </ul>
                        <p>Highlight any text and right-click for additional options.</p>
                    </div>
                    <div class="editor-statusbar">
                        <div id="word-count">Words: 0 | Characters: 0</div>
                        <div id="status" class="badge badge-success">Ready</div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            2025 ANG SILAKBO | All Rights Reserved
        </footer>
    </div>

    <!-- Tutorial Button -->
    <a href="tutorial.html" class="tutorial-btn" title="View Tutorial">
        <i class="fas fa-graduation-cap"></i>
    </a>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu">
        <div class="context-menu-item" id="menu-rephrase">
            <i class="fas fa-sync-alt"></i> Rephrase
        </div>
        <div class="context-menu-item" id="menu-improve">
            <i class="fas fa-magic"></i> Improve
        </div>
        <div class="context-menu-item" id="menu-alternatives">
            <i class="fas fa-exchange-alt"></i> Find Alternatives
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" id="menu-bold">
            <i class="fas fa-bold"></i> Bold
        </div>
        <div class="context-menu-item" id="menu-italic">
            <i class="fas fa-italic"></i> Italic
        </div>
        <div class="context-menu-item" id="menu-underline">
            <i class="fas fa-underline"></i> Underline
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" id="menu-cut">
            <i class="fas fa-cut"></i> Cut
        </div>
        <div class="context-menu-item" id="menu-copy">
            <i class="fas fa-copy"></i> Copy
        </div>
        <div class="context-menu-item" id="menu-paste">
            <i class="fas fa-paste"></i> Paste
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" id="menu-grammar">
            <i class="fas fa-spell-check"></i> Check Grammar
        </div>
        <div class="context-menu-item" id="menu-sentiment">
            <i class="fas fa-smile"></i> Analyze Sentiment
        </div>
    </div>

    <!-- Analysis Panel -->
    <div class="analysis-panel" id="analysis-panel">
        <div class="analysis-header">
            <h3><i class="fas fa-robot"></i> <span id="analysis-title">AI Analysis</span></h3>
            <button class="analysis-close" id="analysis-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="analysis-content" id="analysis-content">
            <!-- Content will be dynamically inserted here -->
        </div>
        <div class="analysis-footer">
            <button class="btn" id="analysis-action-secondary">Cancel</button>
            <button class="btn btn-primary" id="analysis-action-primary">Apply</button>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settings-panel">
        <div class="settings-header">
            <h3><i class="fas fa-cog"></i> Settings</h3>
            <button class="settings-close" id="settings-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="settings-content">
            <div class="settings-section">
                <div class="settings-section-title">
                    <i class="fas fa-font"></i> Text Preferences
                </div>
                <div class="settings-option">
                    <label for="font-family">Font Family:</label>
                    <select id="font-family">
                        <option value="'Merriweather', serif">Merriweather</option>
                        <option value="'Playfair Display', serif">Playfair Display</option>
                        <option value="'Poppins', sans-serif">Poppins</option>
                        <option value="'Source Sans Pro', sans-serif">Source Sans Pro</option>
                        <option value="'Georgia', serif">Georgia</option>
                    </select>
                </div>
                <div class="settings-option">
                    <label for="font-size">Font Size:</label>
                    <select id="font-size">
                        <option value="14px">Small</option>
                        <option value="16px" selected>Medium</option>
                        <option value="18px">Large</option>
                        <option value="20px">Extra Large</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">
                    <i class="fas fa-sliders-h"></i> Application Settings
                </div>
                <div class="settings-option">
                    <label for="auto-save">Auto-save:</label>
                    <select id="auto-save">
                        <option value="off">Off</option>
                        <option value="1">Every 1 minute</option>
                        <option value="5" selected>Every 5 minutes</option>
                        <option value="10">Every 10 minutes</option>
                    </select>
                </div>
                <div class="settings-option">
                    <label for="api-key">Cohere API Key:</label>
                    <input type="password" id="api-key" placeholder="Enter your API key">
                </div>
            </div>
        </div>
        <div class="settings-footer">
            <button class="btn" id="btn-reset-settings">Reset to Defaults</button>
            <button class="btn btn-primary" id="btn-save-settings">Save Settings</button>
        </div>
    </div>

    <!-- Notes Panel -->
    <div class="notes-panel" id="notes-panel">
        <div class="notes-header">
            <h3><i class="fas fa-sticky-note"></i> Notes</h3>
            <button class="notes-close" id="notes-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="notes-content" id="saved-notes-list">
            <p>No saved notes yet.</p>
        </div>
        <div class="notes-footer">
            <button class="btn btn-primary" id="btn-new-note">
                <i class="fas fa-plus"></i> New Note
            </button>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div id="loading-text">Processing your request...</div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-title" id="notification-title">Success</div>
        <div class="notification-message" id="notification-message">Operation completed successfully.</div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="help-modal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-question-circle"></i> ANG SILAKBO Help Center</h3>
                <button class="modal-close" id="close-help-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="result-card">
                    <div class="result-title">
                        <i class="fas fa-info-circle"></i> About ANG SILAKBO
                    </div>
                    <div class="result-content">
                        <p>ANG SILAKBO is an advanced text analysis tool designed to help you improve your writing through AI-powered features. Whether you're writing an essay, article, or any other text content, our tool provides comprehensive analysis and suggestions to enhance your work.</p>
                    </div>
                </div>

                <div class="result-card">
                    <div class="result-title">
                        <i class="fas fa-edit"></i> Basic Text Editing
                    </div>
                    <div class="result-content">
                        <p><strong>Getting Started:</strong></p>
                        <ul>
                            <li>Type directly in the editor or paste your text</li>
                            <li>Use the formatting toolbar to style your text (bold, italic, lists, etc.)</li>
                            <li>Right-click on selected text to access additional options</li>
                            <li>The word and character count is displayed at the bottom of the editor</li>
                        </ul>
                        
                        <p><strong>Keyboard Shortcuts:</strong></p>
                        <ul>
                            <li><strong>Ctrl+B</strong> - Bold text</li>
                            <li><strong>Ctrl+I</strong> - Italic text</li>
                            <li><strong>Ctrl+U</strong> - Underline text</li>
                            <li><strong>Ctrl+S</strong> - Save document</li>
                        </ul>
                    </div>
                </div>

                <div class="result-card">
                    <div class="result-title">
                        <i class="fas fa-robot"></i> AI Analysis Features
                    </div>
                    <div class="result-content">
                        <p>ANG SILAKBO offers several AI-powered analysis tools:</p>
                        
                        <p><strong>Grammar Check:</strong> Identifies grammatical errors and suggests corrections.</p>
                        <p><strong>Plagiarism Detection:</strong> Checks your text for potential plagiarism and identifies possible sources.</p>
                        <p><strong>Sentiment Analysis:</strong> Analyzes the emotional tone of your text (positive, negative, or neutral).</p>
                        <p><strong>Text Summarization:</strong> Creates a concise summary of your text, capturing the main points.</p>
                        <p><strong>Keyword Extraction:</strong> Identifies the most important keywords and phrases in your text.</p>
                        <p><strong>Translation:</strong> Translates your text to various languages while preserving meaning.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grammar Check Modal -->
    <div class="modal-overlay" id="grammar-modal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-spell-check"></i> Grammar Check Results</h3>
                <button class="modal-close" id="close-grammar-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="grammar-modal-content">
                <!-- Content will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn" id="btn-apply-corrections">Apply All Corrections</button>
                <button class="btn btn-primary" id="btn-close-grammar">Close</button>
            </div>
        </div>
    </div>

    <!-- Plagiarism Check Modal -->
    <div class="modal-overlay" id="plagiarism-modal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-search"></i> Plagiarism Check Results</h3>
                <button class="modal-close" id="close-plagiarism-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="plagiarism-modal-content">
                <!-- Content will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="btn-close-plagiarism">Close</button>
            </div>
        </div>
    </div>

    <!-- Sentiment Analysis Modal -->
    <div class="modal-overlay" id="sentiment-modal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-smile"></i> Sentiment Analysis</h3>
                <button class="modal-close" id="close-sentiment-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="sentiment-modal-content">
                <!-- Content will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="btn-close-sentiment">Close</button>
            </div>
        </div>
    </div>

    <!-- Keywords Modal -->
    <div class="modal-overlay" id="keywords-modal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Extracted Keywords</h3>
                <button class="modal-close" id="close-keywords-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="keywords-modal-content">
                <!-- Content will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn" id="btn-copy-keywords">Copy Keywords</button>
                <button class="btn btn-primary" id="btn-close-keywords">Close</button>
            </div>
        </div>
    </div>

    <script>
        // API key for Cohere (in a real app, this should be handled server-side)
        const cohereApiKey = 'z99HUO9u2vu9E4YTRRfeue6hbdkdOcM8zWQDfbcq';
        
        // DOM elements
        const editor = document.getElementById('editor');
        const contextMenu = document.getElementById('context-menu');
        const statusIndicator = document.getElementById('status');
        const wordCountDisplay = document.getElementById('word-count');
        const loadingIndicator = document.getElementById('loading');
        const loadingText = document.getElementById('loading-text');
        const progressBar = document.getElementById('progress-bar');
        const sidebar = document.getElementById('sidebar');
        
        // Panels
        const analysisPanel = document.getElementById('analysis-panel');
        const settingsPanel = document.getElementById('settings-panel');
        const notesPanel = document.getElementById('notes-panel');
        const analysisContent = document.getElementById('analysis-content');
        const analysisTitle = document.getElementById('analysis-title');
        const analysisActionPrimary = document.getElementById('analysis-action-primary');
        const analysisActionSecondary = document.getElementById('analysis-action-secondary');
        
        // Modal elements
        const helpModal = document.getElementById('help-modal');
        const grammarModal = document.getElementById('grammar-modal');
        const plagiarismModal = document.getElementById('plagiarism-modal');
        const sentimentModal = document.getElementById('sentiment-modal');
        const keywordsModal = document.getElementById('keywords-modal');
        const grammarModalContent = document.getElementById('grammar-modal-content');
        const plagiarismModalContent = document.getElementById('plagiarism-modal-content');
        const sentimentModalContent = document.getElementById('sentiment-modal-content');
        const keywordsModalContent = document.getElementById('keywords-modal-content');
        
        // Toolbar buttons
        const btnBold = document.getElementById('btn-bold');
        const btnItalic = document.getElementById('btn-italic');
        const btnUnderline = document.getElementById('btn-underline');
        const btnLink = document.getElementById('btn-link');
        const btnList = document.getElementById('btn-list');
        const btnNumbering = document.getElementById('btn-numbering');
        const btnQuote = document.getElementById('btn-quote');
        const btnCode = document.getElementById('btn-code');
        
        // Sidebar buttons
        const btnSummarize = document.getElementById('btn-summarize');
        const btnPlagiarism = document.getElementById('btn-plagiarism');
        const btnGrammar = document.getElementById('btn-grammar');
        const btnTranslate = document.getElementById('btn-translate');
        const btnSentiment = document.getElementById('btn-sentiment');
        const btnKeywords = document.getElementById('btn-keywords');
        const btnSave = document.getElementById('btn-save');
        const btnLoad = document.getElementById('btn-load');
        const btnExport = document.getElementById('btn-export');
        const btnClear = document.getElementById('btn-clear');
        const btnNewDocument = document.getElementById('btn-new-document');
        const btnSettingsToggle = document.getElementById('btn-settings-toggle');
        const btnNotesToggle = document.getElementById('btn-notes-toggle');
        const btnHelp = document.getElementById('btn-help');
        const btnAnalyze = document.getElementById('btn-analyze');
        
        // Panel close buttons
        const analysisClose = document.getElementById('analysis-close');
        const settingsClose = document.getElementById('settings-close');
        const notesClose = document.getElementById('notes-close');
        
        // Modal buttons
        const closeHelpModal = document.getElementById('close-help-modal');
        const btnCloseGrammar = document.getElementById('btn-close-grammar');
        const btnClosePlagiarism = document.getElementById('btn-close-plagiarism');
        const btnCloseSentiment = document.getElementById('btn-close-sentiment');
        const btnCloseKeywords = document.getElementById('btn-close-keywords');
        const closeGrammarModal = document.getElementById('close-grammar-modal');
        const closePlagiarismModal = document.getElementById('close-plagiarism-modal');
        const closeSentimentModal = document.getElementById('close-sentiment-modal');
        const closeKeywordsModal = document.getElementById('close-keywords-modal');
        const btnApplyCorrections = document.getElementById('btn-apply-corrections');
        const btnCopyKeywords = document.getElementById('btn-copy-keywords');
        
        // Settings elements
        const fontFamilySelect = document.getElementById('font-family');
        const fontSizeSelect = document.getElementById('font-size');
        const autoSaveSelect = document.getElementById('auto-save');
        const apiKeyInput = document.getElementById('api-key');
        const btnResetSettings = document.getElementById('btn-reset-settings');
        const btnSaveSettings = document.getElementById('btn-save-settings');
        
        // Notes elements
        const savedNotesList = document.getElementById('saved-notes-list');
        const btnNewNote = document.getElementById('btn-new-note');
        
        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        
        // Notification elements
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notification-title');
        const notificationMessage = document.getElementById('notification-message');
        
        // Context menu items
        const menuRephrase = document.getElementById('menu-rephrase');
        const menuImprove = document.getElementById('menu-improve');
        const menuAlternatives = document.getElementById('menu-alternatives');
        const menuBold = document.getElementById('menu-bold');
        const menuItalic = document.getElementById('menu-italic');
        const menuUnderline = document.getElementById('menu-underline');
        const menuCut = document.getElementById('menu-cut');
        const menuCopy = document.getElementById('menu-copy');
        const menuPaste = document.getElementById('menu-paste');
        const menuGrammar = document.getElementById('menu-grammar');
        const menuSentiment = document.getElementById('menu-sentiment');
        
        // Current selection tracking
        let selectedText = '';
        let selectionRange = null;
        let documentHistory = [];
        let savedNotes = [];
        let autoSaveInterval = null;
        let grammarCorrections = [];
        let extractedKeywords = [];
        
        // Initialize the editor
        function initEditor() {
            updateWordCount();
            loadSettings();
            loadNotes();
            setupAutoSave();
            
            // Add event listeners
            addEventListeners();
            
            // Show welcome notification
            showNotification('Welcome to ANG SILAKBO', 'Your advanced text analysis tool is ready to use.');
        }
        
        // Add all event listeners
        function addEventListeners() {
            // Editor events
            editor.addEventListener('input', updateWordCount);
            editor.addEventListener('keydown', handleKeyDown);
            editor.addEventListener('contextmenu', handleContextMenu);
            
            // Mobile menu toggle
            mobileMenuToggle.addEventListener('click', toggleSidebar);
            
            // Panel close buttons
            analysisClose.addEventListener('click', () => closePanel(analysisPanel));
            settingsClose.addEventListener('click', () => closePanel(settingsPanel));
            notesClose.addEventListener('click', () => closePanel(notesPanel));
            
            // Help modal
            btnHelp.addEventListener('click', () => openModal(helpModal));
            closeHelpModal.addEventListener('click', () => closeModal(helpModal));
            
            // Analyze button
            btnAnalyze.addEventListener('click', showAnalysisOptions);
            
            // Formatting buttons
            btnBold.addEventListener('click', () => formatText('bold'));
            btnItalic.addEventListener('click', () => formatText('italic'));
            btnUnderline.addEventListener('click', () => formatText('underline'));
            btnLink.addEventListener('click', insertLink);
            btnList.addEventListener('click', () => formatText('insertUnorderedList'));
            btnNumbering.addEventListener('click', () => formatText('insertOrderedList'));
            btnQuote.addEventListener('click', insertQuote);
            btnCode.addEventListener('click', insertCode);
            
            // AI feature buttons
            btnSummarize.addEventListener('click', summarizeText);
            btnPlagiarism.addEventListener('click', checkPlagiarism);
            btnGrammar.addEventListener('click', checkGrammar);
            btnTranslate.addEventListener('click', translateText);
            btnSentiment.addEventListener('click', analyzeSentiment);
            btnKeywords.addEventListener('click', extractKeywords);
            
            // Document management buttons
            btnSave.addEventListener('click', saveDocument);
            btnLoad.addEventListener('click', loadDocument);
            btnExport.addEventListener('click', exportDocument);
            btnClear.addEventListener('click', clearEditor);
            btnNewDocument.addEventListener('click', createNewDocument);
            btnSettingsToggle.addEventListener('click', () => openPanel(settingsPanel));
            btnNotesToggle.addEventListener('click', () => openPanel(notesPanel));
            btnNewNote.addEventListener('click', createNewNote);
            
            // Settings buttons
            btnResetSettings.addEventListener('click', resetSettings);
            btnSaveSettings.addEventListener('click', saveSettings);
            
            // Modal buttons
            btnCloseGrammar.addEventListener('click', () => closeModal(grammarModal));
            btnClosePlagiarism.addEventListener('click', () => closeModal(plagiarismModal));
            btnCloseSentiment.addEventListener('click', () => closeModal(sentimentModal));
            btnCloseKeywords.addEventListener('click', () => closeModal(keywordsModal));
            closeGrammarModal.addEventListener('click', () => closeModal(grammarModal));
            closePlagiarismModal.addEventListener('click', () => closeModal(plagiarismModal));
            closeSentimentModal.addEventListener('click', () => closeModal(sentimentModal));
            closeKeywordsModal.addEventListener('click', () => closeModal(keywordsModal));
            btnApplyCorrections.addEventListener('click', applyAllCorrections);
            btnCopyKeywords.addEventListener('click', copyKeywordsToClipboard);
            
            // Context menu items
            menuRephrase.addEventListener('click', () => handleContextMenuAction('rephrase'));
            menuImprove.addEventListener('click', () => handleContextMenuAction('improve'));
            menuAlternatives.addEventListener('click', () => handleContextMenuAction('alternatives'));
            menuBold.addEventListener('click', () => formatText('bold'));
            menuItalic.addEventListener('click', () => formatText('italic'));
            menuUnderline.addEventListener('click', () => formatText('underline'));
            menuCut.addEventListener('click', cutText);
            menuCopy.addEventListener('click', copyText);
            menuPaste.addEventListener('click', pasteText);
            menuGrammar.addEventListener('click', checkGrammar);
            menuSentiment.addEventListener('click', analyzeSentiment);
            
            // Settings changes
            fontFamilySelect.addEventListener('change', updateEditorStyle);
            fontSizeSelect.addEventListener('change', updateEditorStyle);
            autoSaveSelect.addEventListener('change', setupAutoSave);
            apiKeyInput.addEventListener('change', saveSettings);
            
            // Hide context menu when clicking elsewhere
            document.addEventListener('click', () => {
                contextMenu.style.display = 'none';
            });
            
            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal-overlay')) {
                    closeModal(e.target);
                }
            });
        }
        
        // Show analysis options
        function showAnalysisOptions() {
            analysisTitle.textContent = 'Choose Analysis Type';
            analysisContent.innerHTML = `
                <div class="result-card">
                    <div class="result-title">
                        <i class="fas fa-robot"></i> AI Analysis Options
                    </div>
                    <div class="result-content">
                        <p>Select the type of analysis you want to perform on your text:</p>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 1rem;">
                            <button class="btn btn-primary" id="analysis-grammar">
                                <i class="fas fa-spell-check"></i> Grammar Check
                            </button>
                            <button class="btn btn-primary" id="analysis-plagiarism">
                                <i class="fas fa-search"></i> Plagiarism Check
                            </button>
                            <button class="btn btn-primary" id="analysis-sentiment">
                                <i class="fas fa-smile"></i> Sentiment Analysis
                            </button>
                            <button class="btn btn-primary" id="analysis-summarize">
                                <i class="fas fa-compress-alt"></i> Summarize
                            </button>
                            <button class="btn btn-primary" id="analysis-keywords">
                                <i class="fas fa-key"></i> Extract Keywords
                            </button>
                            <button class="btn btn-primary" id="analysis-translate">
                                <i class="fas fa-language"></i> Translate
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners to the analysis buttons
            document.getElementById('analysis-grammar').addEventListener('click', () => {
                closePanel(analysisPanel);
                checkGrammar();
            });
            document.getElementById('analysis-plagiarism').addEventListener('click', () => {
                closePanel(analysisPanel);
                checkPlagiarism();
            });
            document.getElementById('analysis-sentiment').addEventListener('click', () => {
                closePanel(analysisPanel);
                analyzeSentiment();
            });
            document.getElementById('analysis-summarize').addEventListener('click', () => {
                closePanel(analysisPanel);
                summarizeText();
            });
            document.getElementById('analysis-keywords').addEventListener('click', () => {
                closePanel(analysisPanel);
                extractKeywords();
            });
            document.getElementById('analysis-translate').addEventListener('click', () => {
                closePanel(analysisPanel);
                translateText();
            });
            
            analysisActionPrimary.style.display = 'none';
            analysisActionSecondary.textContent = 'Cancel';
            analysisActionSecondary.onclick = () => closePanel(analysisPanel);
            
            openPanel(analysisPanel);
        }
        
        // Toggle sidebar for mobile
        function toggleSidebar() {
            sidebar.classList.toggle('active');
        }
        
        // Open panel
        function openPanel(panel) {
            // Close all panels first
            closePanel(analysisPanel);
            closePanel(settingsPanel);
            closePanel(notesPanel);
            
            // Open the requested panel
            panel.classList.add('active');
        }
        
        // Close panel
        function closePanel(panel) {
            panel.classList.remove('active');
        }
        
        // Show notification
        function showNotification(title, message, duration = 3000) {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, duration);
        }
        
        // Open modal
        function openModal(modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Close modal
        function closeModal(modal) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // Apply all grammar corrections
        function applyAllCorrections() {
            if (grammarCorrections.length === 0) return;
            
            let content = editor.innerHTML;
            
            grammarCorrections.forEach(correction => {
                content = content.replace(correction.original, correction.correction);
            });
            
            editor.innerHTML = content;
            closeModal(grammarModal);
            showNotification('Corrections Applied', `${grammarCorrections.length} corrections have been applied to your text.`);
        }
        
        // Copy keywords to clipboard
        function copyKeywordsToClipboard() {
            if (extractedKeywords.length === 0) return;
            
            const keywordsText = extractedKeywords.join(', ');
            navigator.clipboard.writeText(keywordsText).then(() => {
                showNotification('Keywords Copied', 'Keywords have been copied to clipboard.');
            });
        }
        
        // Create new document
        function createNewDocument() {
            if (confirm('Create a new document? Any unsaved changes will be lost.')) {
                editor.innerHTML = '<p>Start typing here or paste your text.</p>';
                updateWordCount();
                setStatus('New document created', 'badge-success');
                showNotification('New Document', 'A new document has been created.');
            }
        }
        
        // Handle keydown events in editor
        function handleKeyDown(e) {
            // Tab key inserts spaces
            if (e.key === 'Tab') {
                e.preventDefault();
                document.execCommand('insertText', false, '    ');
            }
            
            // Save document on Ctrl+S
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveDocument();
            }
        }
        
        // Handle context menu
        function handleContextMenu(e) {
            const selection = window.getSelection();
            selectedText = selection.toString().trim();
            
            if (selectedText) {
                e.preventDefault();
                selectionRange = selection.getRangeAt(0);
                
                // Position the context menu
                contextMenu.style.display = 'block';
                contextMenu.style.left = `${e.pageX}px`;
                contextMenu.style.top = `${e.pageY}px`;
            }
        }
        
        // Handle context menu actions
        async function handleContextMenuAction(action) {
            contextMenu.style.display = 'none';
            if (!selectedText) return;
            
            setStatus(`Processing ${action}...`, 'badge-info');
            showLoading(true, `${action.charAt(0).toUpperCase() + action.slice(1)}ing text...`);
            updateProgress(20);
            
            try {
                let result;
                
                switch(action) {
                    case 'rephrase':
                        result = await makeCohereRequest('rephrase', selectedText);
                        break;
                    case 'improve':
                        result = await makeCohereRequest('improve', selectedText);
                        break;
                    case 'alternatives':
                        result = await makeCohereRequest('alternatives', selectedText);
                        break;
                }
                
                updateProgress(100);
                
                if (result) {
                    replaceSelectedText(result);
                    setStatus(`Text ${action}d successfully`, 'badge-success');
                    addToHistory(`Text ${action}d`);
                    showNotification(`Text ${action.charAt(0).toUpperCase() + action.slice(1)}d`, 'Your text has been processed successfully.');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error', error.message || 'Something went wrong. Please try again.', 5000);
                setStatus(`Error during ${action}`, 'badge-error');
            } finally {
                showLoading(false);
                resetProgress();
            }
        }
        
        // Format text with document.execCommand
        function formatText(command, value = null) {
            document.execCommand(command, false, value);
            editor.focus();
        }
        
        // Insert link
        function insertLink() {
            const url = prompt('Enter the URL:');
            if (url) {
                formatText('createLink', url);
            }
        }
        
        // Insert quote
        function insertQuote() {
            const selection = window.getSelection();
            if (selection.toString().trim()) {
                const range = selection.getRangeAt(0);
                const quote = document.createElement('blockquote');
                quote.style.borderLeft = '3px solid var(--primary)';
                quote.style.margin = '10px 0';
                quote.style.paddingLeft = '15px';
                quote.style.color = '#555';
                range.surroundContents(quote);
            } else {
                document.execCommand('formatBlock', false, 'blockquote');
            }
        }
        
        // Insert code block
        function insertCode() {
            const selection = window.getSelection();
            if (selection.toString().trim()) {
                const range = selection.getRangeAt(0);
                const code = document.createElement('pre');
                code.style.backgroundColor = 'var(--primary-bg)';
                code.style.padding = '10px';
                code.style.borderRadius = 'var(--border-radius)';
                code.style.fontFamily = 'monospace';
                code.style.overflowX = 'auto';
                range.surroundContents(code);
            } else {
                const codeBlock = document.createElement('pre');
                codeBlock.style.backgroundColor = 'var(--primary-bg)';
                codeBlock.style.padding = '10px';
                codeBlock.style.borderRadius = 'var(--border-radius)';
                codeBlock.style.fontFamily = 'monospace';
                codeBlock.innerHTML = '// Your code here';
                insertAtCursor(codeBlock);
            }
        }
        
        // Insert HTML at cursor position
        function insertAtCursor(htmlElement) {
            const selection = window.getSelection();
            if (selection.rangeCount) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                range.insertNode(htmlElement);
                
                // Move cursor after the inserted element
                const newRange = document.createRange();
                newRange.setStartAfter(htmlElement);
                newRange.collapse(true);
                selection.removeAllRanges();
                selection.addRange(newRange);
            }
            
            editor.focus();
        }
        
        // Cut text
        function cutText() {
            document.execCommand('cut');
            contextMenu.style.display = 'none';
        }
        
        // Copy text
        function copyText() {
            document.execCommand('copy');
            contextMenu.style.display = 'none';
            setStatus('Text copied to clipboard', 'badge-success');
            showNotification('Copied', 'Text copied to clipboard.');
        }
        
        // Paste text
        function pasteText() {
            document.execCommand('paste');
            contextMenu.style.display = 'none';
        }
        
        // Replace selected text with new text
        function replaceSelectedText(newText) {
            if (selectionRange) {
                selectionRange.deleteContents();
                selectionRange.insertNode(document.createTextNode(newText));
            }
        }
        
        // Update word and character count
        function updateWordCount() {
            const text = editor.innerText || '';
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            const charCount = text.length;
            wordCountDisplay.innerHTML = `Words: ${wordCount} | Characters: ${charCount}`;
        }
        
        // Show loading indicator
        function showLoading(show, message = 'Processing your request...') {
            loadingIndicator.style.display = show ? 'flex' : 'none';
            loadingText.textContent = message;
        }
        
        // Update progress bar
        function updateProgress(percent) {
            progressBar.style.width = `${percent}%`;
        }
        
        // Reset progress bar
        function resetProgress() {
            setTimeout(() => {
                progressBar.style.width = '0';
            }, 500);
        }
        
        // Update status indicator
        function setStatus(message, badgeClass = '') {
            statusIndicator.textContent = message;
            statusIndicator.className = 'badge';
            if (badgeClass) {
                statusIndicator.classList.add(badgeClass);
            }
        }
        
        // Add to document history
        function addToHistory(action) {
            const timestamp = new Date().toLocaleString();
            const content = editor.innerHTML;
            documentHistory.unshift({ action, timestamp, content });
        }
        
        // Load saved notes
        function loadNotes() {
            const saved = localStorage.getItem('savedNotes');
            if (saved) {
                savedNotes = JSON.parse(saved);
                updateNotesDisplay();
            }
        }
        
        // Update notes display
        function updateNotesDisplay() {
            if (!savedNotesList) return;
            
            savedNotesList.innerHTML = '';
            
            if (savedNotes.length === 0) {
                savedNotesList.innerHTML = '<p>No saved notes yet.</p>';
                return;
            }
            
            savedNotes.forEach((note, index) => {
                const noteItem = document.createElement('div');
                noteItem.className = 'note-item';
                noteItem.innerHTML = `
                    <div class="note-title">${note.title || 'Untitled Note'}</div>
                    <div class="note-date">${note.timestamp}</div>
                `;
                noteItem.addEventListener('click', () => {
                    editor.innerHTML = note.content;
                    setStatus(`Loaded note: ${note.title}`, 'badge-success');
                    updateWordCount();
                    showNotification('Note Loaded', `"${note.title}" has been loaded into the editor.`);
                    closePanel(notesPanel);
                });
                savedNotesList.appendChild(noteItem);
            });
        }
        
        // Create new note
        function createNewNote() {
            const title = prompt('Enter a title for your note:');
            if (title !== null) {
                const timestamp = new Date().toLocaleString();
                const content = editor.innerHTML;
                
                savedNotes.unshift({ title, timestamp, content });
                localStorage.setItem('savedNotes', JSON.stringify(savedNotes));
                
                updateNotesDisplay();
                setStatus('Note saved successfully', 'badge-success');
                showNotification('Note Saved', `"${title}" has been saved successfully.`);
            }
        }
        
        // Save document
        function saveDocument() {
            const content = editor.innerHTML;
            localStorage.setItem('savedDocument', content);
            addToHistory('Document saved');
            setStatus('Document saved successfully', 'badge-success');
            showNotification('Document Saved', 'Your document has been saved successfully.');
        }
        
        // Load document
        function loadDocument() {
            const content = localStorage.getItem('savedDocument');
            if (content) {
                editor.innerHTML = content;
                setStatus('Document loaded successfully', 'badge-success');
                updateWordCount();
                showNotification('Document Loaded', 'Your saved document has been loaded successfully.');
            } else {
                setStatus('No saved document found', 'badge-error');
                showNotification('Error', 'No saved document found.', 3000);
            }
        }
        
        // Summarize text
        async function summarizeText() {
            const text = getSelectedTextOrAll();
            if (!text) return;

            setStatus('Summarizing text...', 'badge-info');
            showLoading(true, 'Generating summary...');
            updateProgress(20);

            try {
                const result = await makeCohereRequest('summarize', text);
                updateProgress(100);
                
                analysisTitle.textContent = 'Text Summary';
                analysisContent.innerHTML = `
                    <div class="result-card">
                        <div class="result-title">
                            <i class="fas fa-compress-alt"></i> Summary
                        </div>
                        <div class="result-content">
                            ${result}
                        </div>
                    </div>
                `;
                
                analysisActionPrimary.textContent = 'Copy Summary';
                analysisActionPrimary.style.display = 'block';
                analysisActionSecondary.textContent = 'Close';
                
                analysisActionPrimary.onclick = () => {
                    navigator.clipboard.writeText(result).then(() => {
                        showNotification('Summary Copied', 'Summary has been copied to clipboard.');
                    });
                };
                
                analysisActionSecondary.onclick = () => closePanel(analysisPanel);
                
                openPanel(analysisPanel);
                
                setStatus('Summarization complete', 'badge-success');
                addToHistory('Text summarized');
            } catch (error) {
                handleError(error, 'summarization');
            } finally {
                showLoading(false);
                resetProgress();
            }
        }

        // Export document
        function exportDocument() {
            const content = editor.innerText;
            const htmlContent = editor.innerHTML;
            const blobText = new Blob([content], { type: 'text/plain' });
            const blobHtml = new Blob([htmlContent], { type: 'text/html' });
            
            const exportType = prompt('Export as: (1) TXT, (2) HTML, (3) Both', '1');
            
            if (exportType === '1' || exportType === '3') {
                const url = URL.createObjectURL(blobText);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'document.txt';
                a.click();
                URL.revokeObjectURL(url);
            }
            
            if (exportType === '2' || exportType === '3') {
                const url = URL.createObjectURL(blobHtml);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'document.html';
                a.click();
                URL.revokeObjectURL(url);
            }
            
            setStatus('Document exported', 'badge-success');
            showNotification('Document Exported', 'Your document has been exported successfully.');
        }
        
        // Clear editor
        function clearEditor() {
            if (confirm('Are you sure you want to clear the editor?')) {
                editor.innerHTML = '<p>Start typing here or paste your text.</p>';
                setStatus('Editor cleared', 'badge-info');
                updateWordCount();
                addToHistory('Editor cleared');
                showNotification('Editor Cleared', 'All content has been cleared from the editor.');
            }
        }
        
        // Load editor settings
        function loadSettings() {
            const settings = localStorage.getItem('editorSettings');
            if (settings) {
                const { fontFamily, fontSize, autoSave, apiKey } = JSON.parse(settings);
                
                if (fontFamily) fontFamilySelect.value = fontFamily;
                if (fontSize) fontSizeSelect.value = fontSize;
                if (apiKey) apiKeyInput.value = apiKey;
                if (autoSave) autoSaveSelect.value = autoSave;
                
                // Apply settings
                updateEditorStyle();
                setupAutoSave();
            }
        }
        
        // Update editor style based on settings
        function updateEditorStyle() {
            editor.style.fontFamily = fontFamilySelect.value;
            editor.style.fontSize = fontSizeSelect.value;
        }

        // Set up auto-save functionality
        function setupAutoSave() {
            // Clear existing interval
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            const interval = parseInt(autoSaveSelect.value) * 60 * 1000;
            if (interval > 0) {
                autoSaveInterval = setInterval(() => {
                    saveDocument();
                    setStatus(`Auto-saved at ${new Date().toLocaleTimeString()}`, 'badge-success');
                }, interval);
            }
        }

        // Reset settings to defaults
        function resetSettings() {
            if (confirm('Reset all settings to default?')) {
                fontFamilySelect.value = "'Merriweather', serif";
                fontSizeSelect.value = '16px';
                autoSaveSelect.value = '5';
                apiKeyInput.value = '';
                
                // Apply default styles
                editor.style.fontFamily = "'Merriweather', serif";
                editor.style.fontSize = '16px';
                
                setupAutoSave();
                saveSettings();
                setStatus('Settings reset to defaults', 'badge-success');
                showNotification('Settings Reset', 'All settings have been reset to their default values.');
            }
        }

        // Save current settings
        function saveSettings() {
            const settings = {
                fontFamily: fontFamilySelect.value,
                fontSize: fontSizeSelect.value,
                autoSave: autoSaveSelect.value,
                apiKey: apiKeyInput.value
            };
            localStorage.setItem('editorSettings', JSON.stringify(settings));
            showNotification('Settings Saved', 'Your settings have been saved successfully.');
        }

        // Grammar check
        async function checkGrammar() {
            const text = getSelectedTextOrAll();
            if (!text) return;

            setStatus('Checking grammar...', 'badge-info');
            showLoading(true, 'Analyzing grammar...');
            updateProgress(20);

            try {
                const result = await makeCohereRequest('grammar', text);
                updateProgress(100);
                
                // Parse and format grammar results for better display
                const formattedResult = formatGrammarResults(result, text);
                
                grammarModalContent.innerHTML = formattedResult;
                openModal(grammarModal);
                
                setStatus('Grammar check complete', 'badge-success');
                addToHistory('Grammar check performed');
            } catch (error) {
                handleError(error, 'grammar check');
            } finally {
                showLoading(false);
                resetProgress();
            }
        }

        // Format grammar results for better display
        function formatGrammarResults(result, originalText) {
            // Reset corrections array
            grammarCorrections = [];
            
            // If the result is just text without specific corrections
            if (!result.includes('Original:') && !result.includes('Correction:')) {
                return `
                    <div class="result-card">
                        <div class="result-title">
                            <i class="fas fa-check-circle" style="color: var(--primary)"></i> Grammar Check
                        </div>
                        <div class="result-content">
                            ${result}
                        </div>
                    </div>
                `;
            }
            
            // Try to parse structured grammar results
            try {
                const corrections = [];
                const lines = result.split('\n');
                
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].includes('Original:') && i + 1 < lines.length && lines[i + 1].includes('Correction:')) {
                        const original = lines[i].replace('Original:', '').trim();
                        const correction = lines[i + 1].replace('Correction:', '').trim();
                        
                        corrections.push({
                            original,
                            correction
                        });
                        
                        i++; // Skip the next line since we've already processed it
                    }
                }
                
                if (corrections.length > 0) {
                    grammarCorrections = corrections;
                    
                    let html = `
                        <div class="result-card">
                            <div class="result-title">
                                <i class="fas fa-exclamation-triangle" style="color: var(--primary)"></i> Grammar Issues Found
                            </div>
                            <div class="result-content">
                                <p>We found ${corrections.length} grammar ${corrections.length === 1 ? 'issue' : 'issues'} in your text. Review the suggestions below:</p>
                            </div>
                        </div>
                    `;
                    
                    corrections.forEach((item, index) => {
                        html += `
                            <div class="grammar-item">
                                <div><strong>${index + 1}.</strong> <span class="grammar-original">${item.original}</span></div>
                                <div>→ <span class="grammar-suggestion">${item.correction}</span></div>
                            </div>
                        `;
                    });
                    
                    return html;
                }
            } catch (e) {
                console.error('Error parsing grammar results:', e);
            }
            
            // Fallback to raw result if parsing fails
            return `
                <div class="result-card">
                    <div class="result-title">
                        <i class="fas fa-info-circle" style="color: var(--primary)"></i> Grammar Analysis
                    </div>
                    <div class="result-content">
                        ${result}
                    </div>
                </div>
            `;
        }

        // Translate text
        async function translateText() {
            const text = getSelectedTextOrAll();
            if (!text) return;

            const targetLanguage = prompt('Enter target language (e.g., French, Spanish):');
            if (!targetLanguage) return;

            setStatus(`Translating to ${targetLanguage}...`, 'badge-info');
            showLoading(true, `Translating to ${targetLanguage}...`);
            updateProgress(20);

            try {
                const result = await makeCohereRequest('translate', text, { targetLanguage });
                updateProgress(100);
                
                analysisTitle.textContent = `Translation to ${targetLanguage}`;
                analysisContent.innerHTML = `
                    <div class="result-card">
                        <div class="result-title">
                            <i class="fas fa-language"></i> Translation
                        </div>
                        <div class="result-content">
                            <p><strong>Original:</strong></p>
                            <p>${text}</p>
                            <hr style="margin: 10px 0; border-color: var(--medium-gray);">
                            <p><strong>Translation:</strong></p>
                            <p>${result}</p>
                        </div>
                    </div>
                `;
                
                analysisActionPrimary.textContent = 'Copy Translation';
                analysisActionPrimary.style.display = 'block';
                analysisActionSecondary.textContent = 'Close';
                
                analysisActionPrimary.onclick = () => {
                    navigator.clipboard.writeText(result).then(() => {
                        showNotification('Translation Copied', 'Translation has been copied to clipboard.');
                    });
                };
                
                analysisActionSecondary.onclick = () => closePanel(analysisPanel);
                
                openPanel(analysisPanel);
                
                setStatus('Translation completed', 'badge-success');
                addToHistory(`Text translated to ${targetLanguage}`);
            } catch (error) {
                handleError(error, 'translation');
            } finally {
                showLoading(false);
                resetProgress();
            }
        }

        // Analyze sentiment
        async function analyzeSentiment() {
            const text = getSelectedTextOrAll();
            if (!text) return;

            setStatus('Analyzing sentiment...', 'badge-info');
            showLoading(true, 'Evaluating emotional tone...');
            updateProgress(20);

            try {
                const result = await makeCohereRequest('sentiment', text);
                updateProgress(100);
                
                // Parse sentiment result to extract score if possible
                let sentimentScore = 0.5;
                let sentimentLabel = "Neutral";
                
                if (result.toLowerCase().includes('positive')) {
                    sentimentScore = 0.7;
                    sentimentLabel = "Positive";
                } else if (result.toLowerCase().includes('negative')) {
                    sentimentScore = 0.3;
                    sentimentLabel = "Negative";
                }
                
                // Calculate position for sentiment indicator (0-100%)
                const indicatorPosition = sentimentScore * 100;
                
                sentimentModalContent.innerHTML = `
                    <div class="result-card">
                        <div class="result-title">
                            <i class="fas fa-smile" style="color: var(--primary)"></i> Sentiment Analysis
                        </div>
                        <div class="result-content">
                            <div class="sentiment-result">
                                <h4>Overall Sentiment: <span style="color: var(--primary)">${sentimentLabel}</span></h4>
                                
                                <div class="sentiment-meter">
                                    <div class="sentiment-indicator" style="left: ${indicatorPosition}%"></div>
                                </div>
                                <div class="sentiment-labels">
                                    <span>Negative</span>
                                    <span>Neutral</span>
                                    <span>Positive</span>
                                </div>
                                
                                <h4>Analysis:</h4>
                                <p>${result}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                openModal(sentimentModal);
                
                setStatus('Sentiment analysis complete', 'badge-success');
                addToHistory('Sentiment analyzed');
            } catch (error) {
                handleError(error, 'sentiment analysis');
            } finally {
                showLoading(false);
                resetProgress();
            }
        }

        // Check plagiarism
        async function checkPlagiarism() {
            const text = getSelectedTextOrAll();
            if (!text) return;

            setStatus('Checking for plagiarism...', 'badge-info');
            showLoading(true, 'Analyzing content...');
            updateProgress(20);

            try {
                const result = await makeCohereRequest('plagiarism', text);
                updateProgress(100);
                
                // Parse plagiarism results for better display
                const formattedResult = formatPlagiarismResults(result);
                
                plagiarismModalContent.innerHTML = formattedResult;
                openModal(plagiarismModal);
                
                setStatus('Plagiarism check complete', 'badge-success');
                addToHistory('Plagiarism check performed');
            } catch (error) {
                handleError(error, 'plagiarism check');
            } finally {
                showLoading(false);
                resetProgress();
            }
        }

        // Format plagiarism results for better display
        function formatPlagiarismResults(result) {
            // Check if the result indicates no plagiarism
            if (result.toLowerCase().includes('no plagiarism') || 
                result.toLowerCase().includes('original content') || 
                result.toLowerCase().includes('no matches found')) {
                
                return `
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-check-circle" style="color: var(--primary); font-size: 48px;"></i>
                        <h4 style="margin-top: 15px; color: var(--primary);">No Plagiarism Detected</h4>
                        <p>${result}</p>
                    </div>
                `;
            }
            
            // Try to parse structured plagiarism results
            try {
                const matches = [];
                const lines = result.split('\n');
                let currentMatch = null;
                
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].includes('Potential plagiarism:') || lines[i].includes('Matched text:')) {
                        if (currentMatch) {
                            matches.push(currentMatch);
                        }
                        currentMatch = {
                            text: lines[i].replace('Potential plagiarism:', '').replace('Matched text:', '').trim(),
                            source: ''
                        };
                    } else if (lines[i].includes('Possible source:') && currentMatch) {
                        currentMatch.source = lines[i].replace('Possible source:', '').trim();
                    }
                }

                if (currentMatch) {
                    matches.push(currentMatch);
                }
                
                if (matches.length > 0) {
                    let html = `
                        <div style="text-align: center; padding: 10px; margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle" style="color: var(--primary); font-size: 36px;"></i>
                            <h4 style="margin-top: 10px; color: var(--primary);">Potential Plagiarism Detected</h4>
                            <p>We found ${matches.length} potential ${matches.length === 1 ? 'match' : 'matches'} in your text.</p>
                        </div>
                    `;
                    
                    matches.forEach((item, index) => {
                        html += `
                            <div class="grammar-item">
                                <div><strong>${index + 1}.</strong> <span class="grammar-original">${item.text}</span></div>
                                ${item.source ? `<div><strong>Source:</strong> <span class="grammar-suggestion">${item.source}</span></div>` : ''}
                            </div>
                        `;
                    });
                    
                    return html;
                }
            } catch (e) {
                console.error('Error parsing plagiarism results:', e);
            }
            
            // Fallback to raw result if parsing fails
            return `
                <div class="result-card">
                    <div class="result-title">
                        <i class="fas fa-info-circle" style="color: var(--primary)"></i> Plagiarism Analysis
                    </div>
                    <div class="result-content">
                        ${result}
                    </div>
                </div>
            `;
        }

        // Extract keywords
        async function extractKeywords() {
            const text = getSelectedTextOrAll();
            if (!text) return;

            setStatus('Extracting keywords...', 'badge-info');
            showLoading(true, 'Identifying key terms...');
            updateProgress(20);

            try {
                const result = await makeCohereRequest('keywords', text);
                updateProgress(100);
                
                // Parse keywords for better display
                let keywords = [];
                
                if (result.includes(',')) {
                    keywords = result.split(',').map(keyword => keyword.trim());
                } else if (result.includes('\n')) {
                    keywords = result.split('\n').map(keyword => keyword.trim()).filter(k => k);
                } else {
                    keywords = [result];
                }
                
                // Filter out empty keywords and duplicates
                keywords = [...new Set(keywords.filter(k => k))];
                extractedKeywords = keywords;
                
                let keywordsHtml = '';
                if (keywords.length > 0) {
                    keywordsHtml = `
                        <div class="keywords-container">
                            ${keywords.map(keyword => `<div class="keyword">${keyword}</div>`).join('')}
                        </div>
                    `;
                } else {
                    keywordsHtml = '<p>No keywords extracted.</p>';
                }
                
                keywordsModalContent.innerHTML = `
                    <div class="result-card">
                        <div class="result-title">
                            <i class="fas fa-key" style="color: var(--primary)"></i> Extracted Keywords
                        </div>
                        <div class="result-content">
                            <p>We've identified the following keywords from your text:</p>
                            ${keywordsHtml}
                        </div>
                    </div>
                `;
                
                openModal(keywordsModal);
                
                setStatus('Keywords extracted', 'badge-success');
                addToHistory('Keywords extracted');
            } catch (error) {
                handleError(error, 'keyword extraction');
            } finally {
                showLoading(false);
                resetProgress();
            }
        }

        // Get selected text or all text if nothing selected
        function getSelectedTextOrAll() {
            try {
                const selection = window.getSelection();
                if (selection && selection.toString().trim()) {
                    return selection.toString().trim();
                }
                return editor.innerText.trim() || '';
            } catch (error) {
                console.error('Error getting text:', error);
                return '';
            }
        }

        // Handle API errors
        function handleError(error, context) {
            console.error('Error:', error);
            showNotification('Error', `Error during ${context}: ${error.message || 'Please try again later'}`, 5000);
            setStatus(`${context} failed`, 'badge-error');
        }

        // Enhanced Cohere API request handler
        async function makeCohereRequest(action, text, params = {}) {
            // Get API key from settings or use default
            const apiKey = apiKeyInput.value || cohereApiKey;
            
            if (!apiKey) {
                throw new Error('API key is required. Please enter your Cohere API key in Settings.');
            }
            
            let prompt;
            
            switch(action) {
                case 'rephrase':
                    prompt = `Rephrase this text while preserving meaning and tone. Make it sound natural and professional:

"${text}"`;
                    break;
                case 'improve':
                    prompt = `Improve the clarity, grammar, and quality of this text. Make it more professional and engaging:

"${text}"`;
                    break;
                case 'alternatives':
                    prompt = `Suggest 3 alternative ways to express this text, labeled as Option 1, Option 2, and Option 3:

"${text}"`;
                    break;
                case 'summarize':
                    prompt = `Create a concise, comprehensive summary of this text. Capture the main points and key information:

"${text}"`;
                    break;
                case 'plagiarism':
                    prompt = `Analyze this text for potential plagiarism. If you find suspicious content, identify the specific text and possible sources:

"${text}"`;
                    break;
                case 'grammar':
                    prompt = `Perform a detailed grammar and spelling check on this text. For each error, provide the original text and the correction in this format:
                    Original: [error text]
                    Correction: [corrected text]
                    
                    Text to check:
"${text}"`;
                    break;
                case 'translate':
                    prompt = `Translate this text to ${params.targetLanguage} while preserving the meaning and tone:

"${text}"`;
                    break;
                case 'sentiment':
                    prompt = `Analyze the sentiment of this text. Determine if it's positive, negative, or neutral, and explain why. Provide a detailed analysis of the emotional tone:

"${text}"`;
                    break;
                case 'keywords':
                    prompt = `Extract 5-7 key keywords or phrases from this text. Return only the keywords separated by commas:

"${text}"`;
                    break;
                default:
                    throw new Error('Invalid API action');
            }

            updateProgress(40);
            
            const response = await fetch('https://api.cohere.ai/v1/generate', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'command-r-plus',
                    prompt: prompt,
                    max_tokens: 800,
                    temperature: 0.5,
                    stop_sequences: ['\n\n\n']
                })
            });

            updateProgress(80);
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'API request failed');
            }

            try {
                const data = await response.json();
                if (!data || !data.generations || !data.generations[0]) {
                    throw new Error('Invalid response format');
                }
                return data.generations[0].text.trim();
            } catch (error) {
                throw new Error('Failed to parse API response: ' + error.message);
            }
        }

        // Initialize the editor when DOM is loaded
        document.addEventListener('DOMContentLoaded', initEditor);
    </script>
</body>
</html>
