<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANG SILAKBO - Application Portal</title>
    <link rel="icon" href="SILAKBO%20(1).png">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- EmailJS -->
    <script defer src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <!-- JSZip for multiple file downloads -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
        :root {
            --primary-50: #fff7ed;
            --primary-100: #ffedd5;
            --primary-200: #fed7aa;
            --primary-300: #fdba74;
            --primary-400: #fb923c;
            --primary-500: #e65100;
            --primary-600: #dc2626;
            --primary-700: #b91c1c;
            --primary-800: #991b1b;
            --primary-900: #7f1d1d;
            
            --gray-25: #fcfcfd;
            --gray-50: #f9fafb;
            --gray-100: #f2f4f7;
            --gray-200: #eaecf0;
            --gray-300: #d0d5dd;
            --gray-400: #98a2b3;
            --gray-500: #667085;
            --gray-600: #475467;
            --gray-700: #344054;
            --gray-800: #1d2939;
            --gray-900: #101828;
            
            --success-50: #ecfdf5;
            --success-500: #10b981;
            --success-600: #059669;
            
            --error-50: #fef2f2;
            --error-500: #ef4444;
            --error-600: #dc2626;
            
            --warning-50: #fffbeb;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            
            --info-50: #eff6ff;
            --info-500: #3b82f6;
            --info-600: #2563eb;
            
            --white: #ffffff;
            --black: #000000;
            
            --shadow-xs: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
            --shadow-sm: 0px 1px 2px 0px rgba(16, 24, 40, 0.06), 0px 1px 3px 0px rgba(16, 24, 40, 0.10);
            --shadow-md: 0px 2px 4px -2px rgba(16, 24, 40, 0.06), 0px 4px 8px -2px rgba(16, 24, 40, 0.10);
            --shadow-lg: 0px 4px 6px -2px rgba(16, 24, 40, 0.03), 0px 12px 16px -4px rgba(16, 24, 40, 0.08);
            --shadow-xl: 0px 8px 8px -4px rgba(16, 24, 40, 0.03), 0px 20px 24px -4px rgba(16, 24, 40, 0.08);
            
            --border-radius-sm: 6px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
            --border-radius-xl: 16px;
            
            --sidebar-width: 320px;
            --header-height: 72px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--gray-25);
            color: var(--gray-900);
            line-height: 1.5;
            font-size: 14px;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Layout */
        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--white);
            border-right: 1px solid var(--gray-200);
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 100;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--gray-100);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .brand-logo {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
        }

        .brand-text h1 {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 2px;
            letter-spacing: -0.02em;
        }

        .brand-text p {
            font-size: 13px;
            color: var(--gray-500);
            font-weight: 500;
        }

        /* Stats Cards */
        .stats-section {
            margin-bottom: 24px;
        }

        .stats-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .stat-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-100);
            border-radius: var(--border-radius-md);
            padding: 16px 12px;
            text-align: center;
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-500), var(--primary-400));
        }

        .stat-card:hover {
            background: var(--white);
            border-color: var(--gray-200);
            box-shadow: var(--shadow-xs);
            transform: translateY(-1px);
        }

        .stat-number {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-600);
            margin-bottom: 4px;
            font-feature-settings: 'tnum';
        }

        .stat-label {
            font-size: 11px;
            color: var(--gray-600);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Sidebar Navigation */
        .sidebar-content {
            flex: 1;
            padding: 0 24px 24px;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 32px;
        }

        .nav-section:last-child {
            margin-bottom: 0;
        }

        .nav-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: var(--border-radius-md);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            margin-bottom: 2px;
            border: 1px solid transparent;
            color: var(--gray-700);
        }

        .nav-item:hover {
            background: var(--gray-50);
            border-color: var(--gray-100);
            color: var(--gray-900);
        }

        .nav-item.active {
            background: var(--primary-50);
            color: var(--primary-700);
            border-color: var(--primary-200);
            font-weight: 600;
        }

        .nav-item .material-icons-round {
            font-size: 18px;
        }

        .nav-item .count {
            margin-left: auto;
            background: var(--gray-100);
            color: var(--gray-600);
            font-size: 11px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .nav-item.active .count {
            background: var(--primary-100);
            color: var(--primary-700);
        }

        /* Analytics Toggle */
        .analytics-toggle {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-md);
            padding: 16px;
            cursor: pointer;
            transition: all 0.15s ease;
            margin-bottom: 16px;
        }

        .analytics-toggle:hover {
            background: var(--gray-100);
            border-color: var(--gray-300);
        }

        .analytics-toggle.active {
            background: var(--primary-50);
            border-color: var(--primary-200);
            color: var(--primary-700);
        }

        .toggle-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toggle-text {
            font-size: 14px;
            font-weight: 600;
        }

        .toggle-switch {
            width: 40px;
            height: 20px;
            background: var(--gray-300);
            border-radius: 10px;
            position: relative;
            transition: all 0.2s ease;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: var(--white);
            border-radius: 50%;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-xs);
        }

        .analytics-toggle.active .toggle-switch {
            background: var(--primary-500);
        }

        .analytics-toggle.active .toggle-switch::after {
            transform: translateX(20px);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        .header {
            height: var(--header-height);
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .sidebar-toggle {
            display: none;
            width: 36px;
            height: 36px;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--gray-200);
            background: var(--white);
            color: var(--gray-600);
            cursor: pointer;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
        }

        .sidebar-toggle:hover {
            background: var(--gray-50);
            color: var(--gray-900);
            border-color: var(--gray-300);
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            letter-spacing: -0.02em;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: var(--border-radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
            text-decoration: none;
            position: relative;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary-500);
            color: var(--white);
            box-shadow: var(--shadow-xs);
        }

        .btn-primary:hover {
            background: var(--primary-600);
            box-shadow: var(--shadow-sm);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
            color: var(--gray-900);
        }

        .btn-ghost {
            background: transparent;
            color: var(--gray-600);
            border: 1px solid transparent;
        }

        .btn-ghost:hover {
            background: var(--gray-50);
            color: var(--gray-900);
            border-color: var(--gray-200);
        }

        .btn .material-icons-round {
            font-size: 18px;
        }

        /* Content Area */
        .content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        /* Messages */
        .messages {
            margin-bottom: 24px;
        }

        .message {
            padding: 16px 20px;
            border-radius: var(--border-radius-lg);
            margin-bottom: 16px;
            font-size: 14px;
            font-weight: 500;
            display: none;
            border-left: 4px solid;
            animation: slideIn 0.3s ease;
        }

        .message.show {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .message-error {
            background: var(--error-50);
            color: var(--error-600);
            border-left-color: var(--error-500);
        }

        .message-success {
            background: var(--success-50);
            color: var(--success-600);
            border-left-color: var(--success-500);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Analytics Panel */
        .analytics-panel {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-sm);
            margin-bottom: 32px;
            overflow: hidden;
            display: none;
        }

        .analytics-panel.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-16px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .analytics-header {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: var(--white);
            padding: 24px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .analytics-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .period-selector {
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-md);
            padding: 4px;
        }

        .period-btn {
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            border: none;
        }

        .period-btn.active {
            background: var(--white);
            color: var(--primary-600);
            box-shadow: var(--shadow-xs);
        }

        .analytics-content {
            padding: 32px;
        }

        .analytics-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }

        .analytics-stat {
            text-align: center;
            padding: 24px;
            background: var(--gray-50);
            border: 1px solid var(--gray-100);
            border-radius: var(--border-radius-lg);
        }

        .analytics-stat-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--primary-600);
            margin-bottom: 8px;
            font-feature-settings: 'tnum';
        }

        .analytics-stat-label {
            font-size: 13px;
            color: var(--gray-600);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .chart-container {
            height: 300px;
            background: var(--gray-50);
            border: 1px solid var(--gray-100);
            border-radius: var(--border-radius-lg);
            padding: 20px;
        }

        /* Clean Filters Section */
        .filters-section {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-sm);
            padding: 24px;
            margin-bottom: 24px;
        }

        .filters-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .filters-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filters-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .search-row {
            display: flex;
            align-items: center;
        }

        .search-input-container {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            transition: all 0.15s ease;
            background: var(--white);
            color: var(--gray-900);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(230, 81, 0, 0.1);
        }

        .search-input::placeholder {
            color: var(--gray-500);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
            font-size: 18px;
        }

        .filters-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .filter-dropdown-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .filter-dropdown {
            padding: 10px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            font-weight: 500;
            background: var(--white);
            cursor: pointer;
            transition: all 0.15s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23667085' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px 16px;
            padding-right: 40px;
            color: var(--gray-900);
        }

        .filter-dropdown:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(230, 81, 0, 0.1);
        }

        .filter-dropdown:hover {
            border-color: var(--gray-400);
        }

        .active-filters {
            padding: 16px;
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-md);
        }

        .active-filters-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .active-filters-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .active-filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: var(--primary-50);
            color: var(--primary-700);
            border: 1px solid var(--primary-200);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .active-filter-tag .remove-filter {
            cursor: pointer;
            font-size: 14px;
            color: var(--primary-600);
            transition: color 0.15s ease;
        }

        .active-filter-tag .remove-filter:hover {
            color: var(--primary-800);
        }

        /* Applications Section */
        .applications-section {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .applications-header {
            padding: 20px 32px;
            border-bottom: 1px solid var(--gray-100);
            background: var(--gray-25);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .applications-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .applications-count {
            font-size: 13px;
            color: var(--gray-500);
            font-weight: 500;
        }

        .applications-container {
            max-height: 800px;
            overflow-y: auto;
        }

        .application-card {
            border-bottom: 1px solid var(--gray-100);
            transition: all 0.15s ease;
        }

        .application-card:last-child {
            border-bottom: none;
        }

        .application-card:hover {
            background: var(--gray-25);
        }

        .application-main {
            padding: 20px 32px;
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 20px;
            align-items: center;
        }

        .applicant-avatar {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-lg);
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            box-shadow: var(--shadow-sm);
            flex-shrink: 0;
        }

        .applicant-info {
            min-width: 0;
        }

        .applicant-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 6px;
            letter-spacing: -0.01em;
        }

        .applicant-details {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            font-size: 13px;
            color: var(--gray-600);
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .detail-item .material-icons-round {
            font-size: 16px;
            color: var(--gray-400);
        }

        .application-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: var(--success-50);
            color: var(--success-700);
            border: 1px solid var(--success-200);
        }

        /* Status Management */
        .status-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }

        .status-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-dropdown {
            padding: 10px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            font-weight: 600;
            background: var(--white);
            cursor: pointer;
            transition: all 0.15s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23667085' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px 16px;
            padding-right: 40px;
            color: var(--gray-900);
        }

        .status-dropdown:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(230, 81, 0, 0.1);
        }

        .status-dropdown:hover {
            border-color: var(--gray-400);
        }

        .quick-actions {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .quick-btn {
            padding: 6px 12px;
            border-radius: var(--border-radius-sm);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            border: 1px solid;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .quick-btn-approve {
            background: var(--success-500);
            color: var(--white);
            border-color: var(--success-500);
        }

        .quick-btn-approve:hover {
            background: var(--success-600);
            border-color: var(--success-600);
            transform: translateY(-1px);
        }

        .quick-btn-reject {
            background: var(--error-500);
            color: var(--white);
            border-color: var(--error-500);
        }

        .quick-btn-reject:hover {
            background: var(--error-600);
            border-color: var(--error-600);
            transform: translateY(-1px);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--gray-200);
            background: var(--white);
            color: var(--gray-500);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .action-btn:hover {
            background: var(--primary-500);
            color: var(--white);
            border-color: var(--primary-500);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .action-btn.expand {
            background: var(--primary-500);
            color: var(--white);
            border-color: var(--primary-500);
        }

        .action-btn .material-icons-round {
            font-size: 18px;
        }

        /* Expandable Details */
        .application-details {
            display: none;
            background: var(--gray-25);
            border-top: 1px solid var(--gray-100);
            padding: 32px;
        }

        .application-details.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .detail-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            transition: all 0.15s ease;
        }

        .detail-card:hover {
            border-color: var(--gray-300);
            box-shadow: var(--shadow-xs);
        }

        .detail-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .detail-value {
            font-size: 14px;
            color: var(--gray-900);
            font-weight: 500;
            word-break: break-word;
            line-height: 1.5;
        }

        .detail-value a {
            color: var(--primary-600);
            text-decoration: none;
            font-weight: 600;
        }

        .detail-value a:hover {
            text-decoration: underline;
        }

        .experience-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-lg);
            padding: 24px;
            margin-bottom: 20px;
        }

        .experience-text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--gray-700);
        }

        /* Loading States */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 64px;
            color: var(--gray-500);
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 64px 32px;
            color: var(--gray-500);
        }

        .empty-state .material-icons-round {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--gray-300);
        }

        .empty-state h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray-900);
        }

        .empty-state p {
            font-size: 14px;
            color: var(--gray-600);
        }

        /* Load More */
        .load-more {
            padding: 24px;
            text-align: center;
            border-top: 1px solid var(--gray-100);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(16, 24, 40, 0.7);
            z-index: 1000;
            padding: 32px;
            overflow-y: auto;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--border-radius-xl);
            max-width: 600px;
            margin: 32px auto;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: var(--white);
            padding: 24px 32px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-body {
            padding: 32px;
        }

        .modal-footer {
            padding: 20px 32px;
            border-top: 1px solid var(--gray-100);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            background: var(--gray-25);
        }

        .recipient-info {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .recipient-avatar {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-lg);
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
        }

        .recipient-details h4 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--gray-900);
        }

        .recipient-details p {
            font-size: 14px;
            color: var(--gray-600);
        }

        .info-box {
            background: var(--warning-50);
            border: 1px solid var(--warning-200);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-bottom: 24px;
        }

        .info-box h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--warning-700);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box p {
            font-size: 14px;
            color: var(--warning-700);
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .info-box ul {
            font-size: 14px;
            color: var(--warning-700);
            padding-left: 20px;
            line-height: 1.5;
        }

        /* Export Modal Styles */
        .export-options {
            display: grid;
            gap: 16px;
            margin-bottom: 24px;
        }

        .export-option {
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            cursor: pointer;
            transition: all 0.15s ease;
            background: var(--white);
        }

        .export-option:hover {
            border-color: var(--primary-300);
            background: var(--primary-25);
        }

        .export-option.selected {
            border-color: var(--primary-500);
            background: var(--primary-50);
        }

        .export-option-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .export-option-radio {
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-300);
            border-radius: 50%;
            position: relative;
            transition: all 0.15s ease;
        }

        .export-option.selected .export-option-radio {
            border-color: var(--primary-500);
        }

        .export-option.selected .export-option-radio::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: var(--primary-500);
            border-radius: 50%;
        }

        .export-option-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .export-option-description {
            font-size: 14px;
            color: var(--gray-600);
            line-height: 1.5;
        }

        .export-filters {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--gray-200);
        }

        .export-filters.show {
            display: block;
        }

        .export-filter-group {
            margin-bottom: 16px;
        }

        .export-filter-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            display: block;
        }

        .export-filter-select {
            width: 100%;
            padding: 10px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            background: var(--white);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .export-filter-select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(230, 81, 0, 0.1);
        }

        .export-summary {
            background: var(--info-50);
            border: 1px solid var(--info-200);
            border-radius: var(--border-radius-lg);
            padding: 16px;
            margin-top: 20px;
        }

        .export-summary-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--info-700);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-summary-text {
            font-size: 14px;
            color: var(--info-700);
            line-height: 1.5;
        }

        /* Progress Modal */
        .progress-modal .modal-content {
            max-width: 400px;
        }

        .progress-container {
            text-align: center;
            padding: 20px 0;
        }

        .progress-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--gray-200);
            border-top: 4px solid var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .progress-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 8px;
        }

        .progress-subtext {
            font-size: 14px;
            color: var(--gray-600);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.show {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .sidebar-toggle {
                display: flex;
            }
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .analytics-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .details-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .application-main {
                grid-template-columns: auto 1fr;
                gap: 16px;
            }
            .status-container {
                grid-column: 1 / -1;
                margin-top: 16px;
            }
            .action-buttons {
                grid-column: 1 / -1;
                justify-content: flex-end;
                margin-top: 12px;
            }
            .filter-groups {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 16px;
            }
            .content {
                padding: 16px;
            }
            .filters-section {
                padding: 16px 20px;
            }
            .search-bar {
                flex-direction: column;
                align-items: stretch;
            }
            .search-input-container {
                max-width: none;
            }
            .application-main {
                grid-template-columns: 1fr;
                gap: 12px;
                text-align: center;
            }
            .applicant-details {
                flex-direction: column;
                gap: 8px;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .analytics-stats {
                grid-template-columns: 1fr;
            }
            .details-grid {
                grid-template-columns: 1fr;
            }
            .modal-content {
                margin: 16px auto;
            }
            .modal-header,
            .modal-body {
                padding: 20px;
            }
            .status-container {
                min-width: auto;
            }
            .filter-options {
                flex-direction: column;
            }
            .filter-chip {
                justify-content: center;
            }
            .page-title {
                font-size: 20px;
            }
            .header-actions {
                gap: 8px;
            }
            .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
            .filters-row {
                grid-template-columns: 1fr;
            }
            .search-input-container {
                max-width: none;
            }
            .filters-header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <img src="SILAKBO%20(1).png" alt="Ang Silakbo Logo" class="brand-logo" />
                    <div class="brand-text">
                        <h1>ANG SILAKBO</h1>
                        <p>Applicant's Portal</p>
                    </div>
                </div>
                <div class="stats-section">
                    <div class="stats-title">Overview</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-applications">0</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="screening-count">0</div>
                            <div class="stat-label">Screening</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="interview-count">0</div>
                            <div class="stat-label">Interview</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="technical-count">0</div>
                            <div class="stat-label">Technical</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="confirmation-count">0</div>
                            <div class="stat-label">Confirmation</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar-content">
                <div class="nav-section">
                    <div class="nav-title">Analytics</div>
                    <div class="analytics-toggle" onclick="toggleAnalytics()">
                        <div class="toggle-content">
                            <span class="toggle-text">Show Analytics</span>
                            <div class="toggle-switch"></div>
                        </div>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-title">Status Filter</div>
                    <div class="nav-item active" data-status="all" onclick="filterByStatus('all')">
                        <span class="material-icons-round">apps</span>
                        All Applications
                        <span class="count" id="nav-all-count">0</span>
                    </div>
                    <div class="nav-item" data-status="Screening" onclick="filterByStatus('Screening')">
                        <span class="material-icons-round">filter_list</span>
                        Screening
                        <span class="count" id="nav-screening-count">0</span>
                    </div>
                    <div class="nav-item" data-status="Interview" onclick="filterByStatus('Interview')">
                        <span class="material-icons-round">record_voice_over</span>
                        Interview
                        <span class="count" id="nav-interview-count">0</span>
                    </div>
                    <div class="nav-item" data-status="Technical" onclick="filterByStatus('Technical')">
                        <span class="material-icons-round">build</span>
                        Technical
                        <span class="count" id="nav-technical-count">0</span>
                    </div>
                    <div class="nav-item" data-status="Confirmation" onclick="filterByStatus('Confirmation')">
                        <span class="material-icons-round">check_circle</span>
                        Confirmation
                        <span class="count" id="nav-confirmation-count">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <button class="sidebar-toggle" onclick="toggleSidebar()">
                        <span class="material-icons-round">menu</span>
                    </button>
                    <div class="page-title">Application Management</div>
                </div>
                <div class="header-actions">
                    <a href="#" class="btn btn-ghost">
                        <span class="material-icons-round">arrow_back</span>
                        Back to Main
                    </a>
                    <button class="btn btn-secondary" onclick="loadApplications()">
                        <span class="material-icons-round">refresh</span>
                        Refresh
                    </button>
                    <button class="btn btn-primary" onclick="showExportModal()">
                        <span class="material-icons-round">download</span>
                        Export CSV
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <!-- Messages -->
                <div class="messages">
                    <div id="error-message" class="message message-error"></div>
                    <div id="success-message" class="message message-success"></div>
                </div>

                <!-- Analytics Panel -->
                <div id="analytics-panel" class="analytics-panel">
                    <div class="analytics-header">
                        <div class="analytics-title">
                            <span class="material-icons-round">analytics</span>
                            Application Analytics
                        </div>
                        <div class="period-selector">
                            <button class="period-btn active" onclick="updateAnalyticsPeriod('week')">Week</button>
                            <button class="period-btn" onclick="updateAnalyticsPeriod('month')">Month</button>
                            <button class="period-btn" onclick="updateAnalyticsPeriod('year')">Year</button>
                        </div>
                    </div>
                    <div class="analytics-content">
                        <div class="analytics-stats">
                            <div class="analytics-stat">
                                <div class="analytics-stat-value">78%</div>
                                <div class="analytics-stat-label">Acceptance Rate</div>
                            </div>
                            <div class="analytics-stat">
                                <div class="analytics-stat-value">2.8</div>
                                <div class="analytics-stat-label">Avg. Processing Days</div>
                            </div>
                            <div class="analytics-stat">
                                <div class="analytics-stat-value">42</div>
                                <div class="analytics-stat-label">This Week</div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="applicationsChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Filters Section -->
                <div class="filters-section">
                    <div class="filters-header">
                        <div class="filters-title">
                            <span class="material-icons-round">tune</span>
                            Search & Filters
                        </div>
                        <button class="btn btn-secondary" onclick="clearFilters()">
                            <span class="material-icons-round">clear</span>
                            Clear All
                        </button>
                    </div>
                    
                    <div class="filters-content">
                        <div class="search-row">
                            <div class="search-input-container">
                                <span class="material-icons-round search-icon">search</span>
                                <input type="text" id="search-input" class="search-input" placeholder="Search applications..." onkeyup="searchApplications()">
                            </div>
                        </div>
                        <div class="filters-row">
                            <div class="filter-dropdown-group">
                                <label class="filter-label">Status</label>
                                <select class="filter-dropdown" id="status-filter" onchange="filterByStatus(this.value)">
                                    <option value="all">All Status</option>
                                    <option value="Screening">Screening</option>
                                    <option value="Interview">Interview</option>
                                    <option value="Technical">Technical</option>
                                    <option value="Confirmation">Confirmation</option>
                                </select>
                            </div>
                            <div class="filter-dropdown-group">
                                <label class="filter-label">Position</label>
                                <select class="filter-dropdown" id="position-filter" onchange="filterByPosition(this.value)">
                                    <option value="all">All Positions</option>
                                </select>
                            </div>
                            <div class="filter-dropdown-group">
                                <label class="filter-label">Organization</label>
                                <select class="filter-dropdown" id="organization-filter" onchange="filterByOrganization(this.value)">
                                    <option value="all">All Organizations</option>
                                </select>
                            </div>
                            <div class="filter-dropdown-group">
                                <label class="filter-label">Date Range</label>
                                <select class="filter-dropdown" id="date-filter" onchange="filterByDate(this.value)">
                                    <option value="all">All Time</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="quarter">This Quarter</option>
                                </select>
                            </div>
                        </div>
                        <div class="active-filters" id="active-filters" style="display: none;">
                            <div class="active-filters-title">Active Filters:</div>
                            <div class="active-filters-list" id="active-filters-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Applications Section -->
                <div class="applications-section">
                    <div class="applications-header">
                        <div class="applications-title">
                            <span class="material-icons-round">people</span>
                            Applications
                        </div>
                        <div class="applications-count" id="applications-count">0 applications</div>
                    </div>
                    <!-- Loading -->
                    <div id="loading" class="loading">
                        <div class="spinner"></div>
                        <div style="font-weight: 600;">Loading applications...</div>
                    </div>
                    <!-- Applications List -->
                    <div id="applications" class="applications-container" style="display: none;"></div>
                    <!-- Load More -->
                    <div id="load-more-container" class="load-more" style="display: none;">
                        <button id="load-more-btn" class="btn btn-secondary" onclick="loadMoreApplications()">
                            <span class="material-icons-round">expand_more</span>
                            Load More Applications
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-round">delete_forever</span>
                    Confirm Deletion
                </div>
            </div>
            <div class="modal-body">
                <p style="font-size: 16px; line-height: 1.6; color: var(--gray-700);">Are you sure you want to delete this application? This action cannot be undone and all associated data will be permanently removed.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('deleteModal')">
                    <span class="material-icons-round">close</span>
                    Cancel
                </button>
                <button class="btn btn-primary" onclick="confirmDelete()">
                    <span class="material-icons-round">delete</span>
                    Delete Application
                </button>
            </div>
        </div>
    </div>

    <!-- Email Modal -->
    <div id="emailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-round">email</span>
                    Send Interview Email
                </div>
            </div>
            <div class="modal-body">
                <div class="recipient-info" id="email-recipient-info">
                    <div class="recipient-avatar">A</div>
                    <div class="recipient-details">
                        <h4>Applicant Name</h4>
                        <p>applicant@example.com</p>
                    </div>
                </div>
                <div class="info-box">
                    <h4>
                        <span class="material-icons-round">info</span>
                        Important Information
                    </h4>
                    <p>You are about to send an interview invitation email to this applicant.</p>
                    <ul>
                        <li>The email will be sent immediately</li>
                        <li>Application status will be updated to "Interview"</li>
                        <li>Applicant will receive contact information and next steps</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('emailModal')">
                    <span class="material-icons-round">close</span>
                    Cancel
                </button>
                <button class="btn btn-primary" onclick="sendInterviewEmail()">
                    <span class="material-icons-round">send</span>
                    Send Email
                </button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-round">download</span>
                    Export Applications
                </div>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <div class="export-option selected" onclick="selectExportOption('all')">
                        <div class="export-option-header">
                            <div class="export-option-radio"></div>
                            <div class="export-option-title">Export All Applications</div>
                        </div>
                        <div class="export-option-description">
                            Download a single CSV file containing all applications with their current status and details.
                        </div>
                    </div>

                    <div class="export-option" onclick="selectExportOption('filtered')">
                        <div class="export-option-header">
                            <div class="export-option-radio"></div>
                            <div class="export-option-title">Export Current Filtered Results</div>
                        </div>
                        <div class="export-option-description">
                            Download only the applications currently visible based on your active filters and search criteria.
                        </div>
                    </div>

                    <div class="export-option" onclick="selectExportOption('by-position')">
                        <div class="export-option-header">
                            <div class="export-option-radio"></div>
                            <div class="export-option-title">Export Separated by Position</div>
                        </div>
                        <div class="export-option-description">
                            Download multiple CSV files, one for each position (e.g., Layout Artist, Video Editor, etc.).
                        </div>
                    </div>

                    <div class="export-option" onclick="selectExportOption('by-organization')">
                        <div class="export-option-header">
                            <div class="export-option-radio"></div>
                            <div class="export-option-title">Export Separated by Organization</div>
                        </div>
                        <div class="export-option-description">
                            Download multiple CSV files, one for each organization/department.
                        </div>
                    </div>

                    <div class="export-option" onclick="selectExportOption('specific-position')">
                        <div class="export-option-header">
                            <div class="export-option-radio"></div>
                            <div class="export-option-title">Export Specific Position Only</div>
                        </div>
                        <div class="export-option-description">
                            Download applications for a specific position only.
                        </div>
                        <div class="export-filters" id="position-filters">
                            <div class="export-filter-group">
                                <label class="export-filter-label">Select Position</label>
                                <select class="export-filter-select" id="export-position-select">
                                    <option value="">Choose a position...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="export-option" onclick="selectExportOption('specific-organization')">
                        <div class="export-option-header">
                            <div class="export-option-radio"></div>
                            <div class="export-option-title">Export Specific Organization Only</div>
                        </div>
                        <div class="export-option-description">
                            Download applications for a specific organization/department only.
                        </div>
                        <div class="export-filters" id="organization-filters">
                            <div class="export-filter-group">
                                <label class="export-filter-label">Select Organization</label>
                                <select class="export-filter-select" id="export-organization-select">
                                    <option value="">Choose an organization...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="export-summary" id="export-summary">
                    <div class="export-summary-title">
                        <span class="material-icons-round">info</span>
                        Export Summary
                    </div>
                    <div class="export-summary-text" id="export-summary-text">
                        You will download 1 CSV file containing all applications.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('exportModal')">
                    <span class="material-icons-round">close</span>
                    Cancel
                </button>
                <button class="btn btn-primary" onclick="executeExport()" id="export-btn">
                    <span class="material-icons-round">download</span>
                    Download CSV
                </button>
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div id="progressModal" class="modal progress-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-round">download</span>
                    Preparing Export
                </div>
            </div>
            <div class="modal-body">
                <div class="progress-container">
                    <div class="progress-spinner"></div>
                    <div class="progress-text" id="progress-text">Preparing your export...</div>
                    <div class="progress-subtext" id="progress-subtext">This may take a few moments</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
        import { getDatabase, ref, get, update, remove } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js';

        // Global variables
        let db = null;
        let applicationsData = {};
        let filteredApplications = [];
        let deleteTrackingId = null;
        let emailApplicantData = null;
        let currentFilters = {
            status: 'all',
            position: 'all',
            organization: 'all',
            search: ''
        };
        let expandedApplications = new Set();
        let applicationsChart = null;
        let emailJSInitialized = false;
        let selectedExportOption = 'all';

        // Define searchApplications to update the search filter and re-apply filters
        window.searchApplications = function() {
            const value = document.getElementById('search-input').value.trim().toLowerCase();
            currentFilters.search = value;
            applyFilters();
        };

        // Pagination
        const ITEMS_PER_PAGE = 15;
        let currentPage = 1;
        let totalPages = 1;

        // Stage definitions
        const regularStages = ['Screening', 'Interview', 'Technical/Auditions', 'Confirmation'];
        const auditionPositions = ['Layout Artist', 'Video Editor', 'Videographer'];

        // Initialize EmailJS
        function initializeEmailJS() {
            try {
                if (typeof emailjs === 'undefined') {
                    console.warn('EmailJS not loaded yet, will retry...');
                    return false;
                }
                emailjs.init('NYNZK9TDyHu17M6G_');
                emailJSInitialized = true;
                return true;
            } catch (error) {
                console.error('Failed to initialize EmailJS:', error);
                return false;
            }
        }

        // Utility functions
        window.showError = function(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.innerHTML = `<span class="material-icons-round">error</span>${message}`;
            errorDiv.classList.add('show');
            setTimeout(() => errorDiv.classList.remove('show'), 5000);
        }

        window.showSuccess = function(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.innerHTML = `<span class="material-icons-round">check_circle</span>${message}`;
            successDiv.classList.add('show');
            setTimeout(() => successDiv.classList.remove('show'), 5000);
        }

        // Sidebar toggle
        window.toggleSidebar = function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }

        // Initialize Firebase
        function initializeFirebase() {
            try {
                const firebaseConfig = {
                    apiKey: "AIzSyDSe2c9-8xqShoHEW-D7BXXAyD5N9uXWEs",
                    authDomain: "ang-silakbo.firebaseapp.com",
                    databaseURL: "https://ang-silakbo-default-rtdb.firebaseio.com",
                    projectId: "ang-silakbo",
                    storageBucket: "ang-silakbo.firebasestorage.app",
                    messagingSenderId: "1006400633782",
                    appId: "1:1006400633782:web:ef4a93c1d445cb825b9f17",
                    measurementId: "G-TSDTG2YJ94"
                };
                const app = initializeApp(firebaseConfig);
                getAnalytics(app);
                return getDatabase(app);
            } catch (error) {
                showError('Failed to initialize Firebase: ' + error.message);
                return null;
            }
        }

        function getStagesForApplication(app) {
            const stages = [...regularStages];
            if (auditionPositions.includes(app.position)) {
                const techIndex = stages.indexOf('Technical/Auditions');
                if (techIndex !== -1) {
                    stages[techIndex] = 'Audition';
                }
            }
            return stages;
        }

        function updateStats() {
            const stats = {
                total: 0,
                screening: 0,
                interview: 0,
                technical: 0,
                confirmation: 0
            };

            const positions = new Map();
            const organizations = new Map();

            Object.values(applicationsData).forEach(app => {
                stats.total++;
                
                if (app.status.includes('Screening')) stats.screening++;
                else if (app.status.includes('Interview')) stats.interview++;
                else if (app.status.includes('Technical') || app.status.includes('Audition')) stats.technical++;
                else if (app.status.includes('Confirmation')) stats.confirmation++;

                // Count positions
                positions.set(app.position, (positions.get(app.position) || 0) + 1);
                
                // Count organizations
                organizations.set(app.subOrganization, (organizations.get(app.subOrganization) || 0) + 1);
            });

            // Update main stats
            document.getElementById('total-applications').textContent = stats.total;
            document.getElementById('screening-count').textContent = stats.screening;
            document.getElementById('interview-count').textContent = stats.interview;
            document.getElementById('technical-count').textContent = stats.technical;
            document.getElementById('confirmation-count').textContent = stats.confirmation;

            // Update nav counts
            document.getElementById('nav-all-count').textContent = stats.total;
            document.getElementById('nav-screening-count').textContent = stats.screening;
            document.getElementById('nav-interview-count').textContent = stats.interview;
            document.getElementById('nav-technical-count').textContent = stats.technical;
            document.getElementById('nav-confirmation-count').textContent = stats.confirmation;

            // Update position filters
            updatePositionFilters(positions);
            
            // Update organization filters
            updateOrganizationFilters(organizations);
        }

        // Update the filter functions to work with clean dropdowns
        function updatePositionFilters(positions) {
            const dropdown = document.getElementById('position-filter');
            const exportDropdown = document.getElementById('export-position-select');
            
            // Clear existing options except "All"
            dropdown.innerHTML = '<option value="all">All Positions</option>';
            exportDropdown.innerHTML = '<option value="">Choose a position...</option>';
            
            // Add position options
            positions.forEach((count, position) => {
                const option = document.createElement('option');
                option.value = position;
                option.textContent = `${position} (${count})`;
                dropdown.appendChild(option);

                const exportOption = document.createElement('option');
                exportOption.value = position;
                exportOption.textContent = position;
                exportDropdown.appendChild(exportOption);
            });
        }

        function updateOrganizationFilters(organizations) {
            const dropdown = document.getElementById('organization-filter');
            const exportDropdown = document.getElementById('export-organization-select');
            
            // Clear existing options except "All"
            dropdown.innerHTML = '<option value="all">All Organizations</option>';
            exportDropdown.innerHTML = '<option value="">Choose an organization...</option>';
            
            // Add organization options
            organizations.forEach((count, organization) => {
                const option = document.createElement('option');
                option.value = organization;
                option.textContent = `${organization} (${count})`;
                dropdown.appendChild(option);

                const exportOption = document.createElement('option');
                exportOption.value = organization;
                exportOption.textContent = organization;
                exportDropdown.appendChild(exportOption);
            });
        }

        function updateActiveFilters() {
            const activeFiltersContainer = document.getElementById('active-filters');
            const activeFiltersList = document.getElementById('active-filters-list');
            
            const activeFilters = [];
            
            if (currentFilters.status !== 'all') {
                activeFilters.push({ type: 'Status', value: currentFilters.status, key: 'status' });
            }
            if (currentFilters.position !== 'all') {
                activeFilters.push({ type: 'Position', value: currentFilters.position, key: 'position' });
            }
            if (currentFilters.organization !== 'all') {
                activeFilters.push({ type: 'Organization', value: currentFilters.organization, key: 'organization' });
            }
            if (currentFilters.search !== '') {
                activeFilters.push({ type: 'Search', value: currentFilters.search, key: 'search' });
            }
            
            if (activeFilters.length > 0) {
                activeFiltersContainer.style.display = 'block';
                activeFiltersList.innerHTML = activeFilters.map(filter => `
                    <div class="active-filter-tag">
                        ${filter.type}: ${filter.value}
                        <span class="material-icons-round remove-filter" onclick="removeFilter('${filter.key}')">close</span>
                    </div>
                `).join('');
            } else {
                activeFiltersContainer.style.display = 'none';
            }
        }

        window.removeFilter = function(filterKey) {
            if (filterKey === 'search') {
                currentFilters.search = '';
                document.getElementById('search-input').value = '';
            } else {
                currentFilters[filterKey] = 'all';
                document.getElementById(`${filterKey}-filter`).value = 'all';
            }
            applyFilters();
        }

        // Update applyFilters to show active filters
        function applyFilters() {
            filteredApplications = Object.keys(applicationsData).filter(trackingId => {
                const app = applicationsData[trackingId];
                
                // Search filter
                const matchesSearch = currentFilters.search === '' ||
                    app.fullName.toLowerCase().includes(currentFilters.search) ||
                    app.position.toLowerCase().includes(currentFilters.search) ||
                    app.trackingId.toLowerCase().includes(currentFilters.search) ||
                    app.subOrganization.toLowerCase().includes(currentFilters.search) ||
                    app.email.toLowerCase().includes(currentFilters.search) ||
                    (app.section && app.section.toLowerCase().includes(currentFilters.search));
                
                // Status filter
                const matchesStatus = currentFilters.status === 'all' ||
                    app.status.includes(currentFilters.status);
                
                // Position filter
                const matchesPosition = currentFilters.position === 'all' ||
                    app.position === currentFilters.position;
                
                // Organization filter
                const matchesOrganization = currentFilters.organization === 'all' ||
                    app.subOrganization === currentFilters.organization;
                
                return matchesSearch && matchesStatus && matchesPosition && matchesOrganization;
            });
            
            currentPage = 1;
            totalPages = Math.ceil(filteredApplications.length / ITEMS_PER_PAGE);
            displayApplications();
            
            // Update applications count
            document.getElementById('applications-count').textContent = 
                `${filteredApplications.length} application${filteredApplications.length !== 1 ? 's' : ''}`;
            
            updateActiveFilters();
        }

        window.filterByStatus = function(status) {
            currentFilters.status = status;
            applyFilters();
        };

        window.filterByPosition = function(position) {
            currentFilters.position = position;
            applyFilters();
        };

        window.filterByOrganization = function(organization) {
            currentFilters.organization = organization;
            applyFilters();
        };

        window.clearFilters = function() {
            currentFilters = {
                status: 'all',
                position: 'all',
                organization: 'all',
                search: ''
            };
            
            document.getElementById('search-input').value = '';
            document.getElementById('status-filter').value = 'all';
            document.getElementById('position-filter').value = 'all';
            document.getElementById('organization-filter').value = 'all';
            
            applyFilters();
        };

        // Application display functions
        window.toggleApplication = function(trackingId) {
            const details = document.getElementById(`details-${trackingId}`);
            const btn = document.querySelector(`[onclick="toggleApplication('${trackingId}')"]`);
            
            if (expandedApplications.has(trackingId)) {
                details.classList.remove('show');
                btn.classList.remove('expand');
                btn.innerHTML = '<span class="material-icons-round">expand_more</span>';
                expandedApplications.delete(trackingId);
            } else {
                details.classList.add('show');
                btn.classList.add('expand');
                btn.innerHTML = '<span class="material-icons-round">expand_less</span>';
                expandedApplications.add(trackingId);
            }
        };

        window.loadMoreApplications = function() {
            if (currentPage < totalPages) {
                currentPage++;
                displayApplications(true);
            }
        };

        function displayApplications(append = false) {
            const container = document.getElementById('applications');
            const loadMoreContainer = document.getElementById('load-more-container');
            
            if (!append) {
                container.innerHTML = '';
                expandedApplications.clear();
            }
            
            if (filteredApplications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <span class="material-icons-round">search_off</span>
                        <h3>No applications found</h3>
                        <p>Try adjusting your search criteria or filters.</p>
                    </div>
                `;
                loadMoreContainer.style.display = 'none';
                return;
            }
            
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, filteredApplications.length);
            const currentPageApplications = filteredApplications.slice(startIndex, endIndex);
            
            currentPageApplications.forEach(trackingId => {
                const app = applicationsData[trackingId];
                const stages = getStagesForApplication(app);
                const initials = app.fullName ? app.fullName.split(' ').map(n => n[0]).join('').substring(0, 2) : '';
                
                const div = document.createElement('div');
                div.className = 'application-card';
                div.innerHTML = `
                    <div class="application-main">
                        <div class="applicant-avatar">${initials}</div>
                        <div class="applicant-info">
                            <div class="applicant-name">${app.fullName}</div>
                            <div class="applicant-details">
                                <div class="detail-item">
                                    <span class="material-icons-round">work</span>
                                    ${app.position}
                                </div>
                                <div class="detail-item">
                                    <span class="material-icons-round">school</span>
                                    ${app.section || 'N/A'}
                                </div>
                                <div class="detail-item">
                                    <span class="material-icons-round">business</span>
                                    ${app.subOrganization}
                                </div>
                                <div class="detail-item">
                                    <span class="material-icons-round">badge</span>
                                    ${app.trackingId}
                                </div>
                                <div class="application-badge">
                                    Silakbo Member
                                </div>
                            </div>
                        </div>
                        <div class="status-container">
                            <div class="status-label">Current Status</div>
                            <select class="status-dropdown" onchange="updateStatus('${trackingId}', this.value)">
                                ${stages.map(stage => `<option value="${stage}" ${stage === app.status ? 'selected' : ''}>${stage}</option>`).join('')}
                                <option value="Disqualified" ${app.status === 'Disqualified' ? 'selected' : ''}>Disqualified</option>
                                <option value="Confirmation: Accepted" ${app.status === 'Confirmation: Accepted' ? 'selected' : ''}>Accept</option>
                            </select>
                            <div class="quick-actions">
                                <button class="quick-btn quick-btn-approve" onclick="quickApprove('${trackingId}')">
                                    <span class="material-icons-round" style="font-size: 14px;">check</span>
                                    Approve
                                </button>
                                <button class="quick-btn quick-btn-reject" onclick="updateStatus('${trackingId}', 'Disqualified')">
                                    <span class="material-icons-round" style="font-size: 14px;">close</span>
                                    Reject
                                </button>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="toggleApplication('${trackingId}')">
                                <span class="material-icons-round">expand_more</span>
                            </button>
                            <button class="action-btn" onclick="showEmailModal('${trackingId}')">
                                <span class="material-icons-round">email</span>
                            </button>
                            <button class="action-btn" onclick="showDeleteModal('${trackingId}')">
                                <span class="material-icons-round">delete</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="details-${trackingId}" class="application-details">
                        <div class="details-grid">
                            <div class="detail-card">
                                <div class="detail-label">Full Name</div>
                                <div class="detail-value">${app.fullName}</div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Section</div>
                                <div class="detail-value">${app.section || 'Not specified'}</div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Email Address</div>
                                <div class="detail-value">${app.email}</div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Phone Number</div>
                                <div class="detail-value">${app.phone}</div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Address</div>
                                <div class="detail-value">${app.address}</div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Portfolio Link</div>
                                <div class="detail-value">
                                    <a href="${app.portfolioLink}" target="_blank">View Portfolio</a>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">How They Heard</div>
                                <div class="detail-value">${app.hearAbout}</div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Submitted Date</div>
                                <div class="detail-value">${new Date(app.submittedAt).toLocaleDateString()}</div>
                            </div>
                        </div>
                        
                        <div class="experience-card">
                            <div class="detail-label">Experience & Skills</div>
                            <div class="experience-text">${app.experience}</div>
                        </div>
                        
                        ${app.additionalMessage ? `
                            <div class="experience-card">
                                <div class="detail-label">Additional Message</div>
                                <div class="experience-text">${app.additionalMessage}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
                container.appendChild(div);
            });
            
            if (currentPage < totalPages) {
                loadMoreContainer.style.display = 'block';
            } else {
                loadMoreContainer.style.display = 'none';
            }
        }

        // Load applications
        window.loadApplications = async function() {
            if (!db) {
                showError('Database not initialized.');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('applications').style.display = 'none';

            try {
                const snapshot = await get(ref(db, 'applications'));
                applicationsData = snapshot.val() || {};
                filteredApplications = Object.keys(applicationsData);
                totalPages = Math.ceil(filteredApplications.length / ITEMS_PER_PAGE);
                currentPage = 1;
                
                displayApplications();
                updateStats();
                
                // Update applications count
                document.getElementById('applications-count').textContent =
                    `${filteredApplications.length} application${filteredApplications.length !== 1 ? 's' : ''}`;
            } catch (error) {
                showError('Error loading applications: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('applications').style.display = 'block';
            }
        }

        // Update status
        window.updateStatus = async function(trackingId, newStatus) {
            if (!db) {
                showError('Database not initialized.');
                return;
            }

            try {
                await update(ref(db, 'applications/' + trackingId), { status: newStatus });
                applicationsData[trackingId].status = newStatus;
                
                displayApplications();
                updateStats();
                showSuccess(`Status updated to ${newStatus}`);
            } catch (error) {
                showError('Error updating status: ' + error.message);
            }
        };

        // Quick approve function
        window.quickApprove = async function(trackingId) {
            const app = applicationsData[trackingId];
            if (!app) return;

            const stages = getStagesForApplication(app);
            const currentIndex = stages.indexOf(app.status);
            const nextStage = currentIndex < stages.length - 1 ? stages[currentIndex + 1] : 'Confirmation: Accepted';
            
            await updateStatus(trackingId, nextStage);
        };

        // Modal functions
        window.showDeleteModal = function(trackingId) {
            deleteTrackingId = trackingId;
            document.getElementById('deleteModal').style.display = 'block';
        };

        window.showEmailModal = function(trackingId) {
            emailApplicantData = applicationsData[trackingId];
            if (!emailApplicantData) {
                showError('Applicant data not found.');
                return;
            }
            
            const initials = emailApplicantData.fullName ? emailApplicantData.fullName.split(' ').map(n => n[0]).join('').substring(0, 2) : '';
            document.getElementById('email-recipient-info').innerHTML = `
                <div class="recipient-avatar">${initials}</div>
                <div class="recipient-details">
                    <h4>${emailApplicantData.fullName}</h4>
                    <p>${emailApplicantData.email}</p>
                </div>
            `;
            
            document.getElementById('emailModal').style.display = 'block';
        };

        // Export Modal Functions
        window.showExportModal = function() {
            updateExportSummary();
            document.getElementById('exportModal').style.display = 'block';
        };

        window.selectExportOption = function(option) {
            // Remove selected class from all options
            document.querySelectorAll('.export-option').forEach(el => el.classList.remove('selected'));
            
            // Add selected class to clicked option
            event.currentTarget.classList.add('selected');
            
            selectedExportOption = option;
            
            // Show/hide filters based on selection
            document.querySelectorAll('.export-filters').forEach(el => el.classList.remove('show'));
            
            if (option === 'specific-position') {
                document.getElementById('position-filters').classList.add('show');
            } else if (option === 'specific-organization') {
                document.getElementById('organization-filters').classList.add('show');
            }
            
            updateExportSummary();
        };

        function updateExportSummary() {
            const summaryText = document.getElementById('export-summary-text');
            let text = '';
            
            switch (selectedExportOption) {
                case 'all':
                    text = `You will download 1 CSV file containing all ${Object.keys(applicationsData).length} applications.`;
                    break;
                case 'filtered':
                    text = `You will download 1 CSV file containing ${filteredApplications.length} filtered applications.`;
                    break;
                case 'by-position':
                    const positions = new Set(Object.values(applicationsData).map(app => app.position));
                    text = `You will download ${positions.size} CSV files, one for each position.`;
                    break;
                case 'by-organization':
                    const organizations = new Set(Object.values(applicationsData).map(app => app.subOrganization));
                    text = `You will download ${organizations.size} CSV files, one for each organization.`;
                    break;
                case 'specific-position':
                    const selectedPosition = document.getElementById('export-position-select').value;
                    if (selectedPosition) {
                        const count = Object.values(applicationsData).filter(app => app.position === selectedPosition).length;
                        text = `You will download 1 CSV file containing ${count} applications for ${selectedPosition}.`;
                    } else {
                        text = 'Please select a position to export.';
                    }
                    break;
                case 'specific-organization':
                    const selectedOrg = document.getElementById('export-organization-select').value;
                    if (selectedOrg) {
                        const count = Object.values(applicationsData).filter(app => app.subOrganization === selectedOrg).length;
                        text = `You will download 1 CSV file containing ${count} applications for ${selectedOrg}.`;
                    } else {
                        text = 'Please select an organization to export.';
                    }
                    break;
            }
            
            summaryText.textContent = text;
        }

        // Update export summary when dropdowns change
        document.addEventListener('change', function(e) {
            if (e.target.id === 'export-position-select' || e.target.id === 'export-organization-select') {
                updateExportSummary();
            }
        });

        window.executeExport = async function() {
            // Validate specific selections
            if (selectedExportOption === 'specific-position') {
                const selectedPosition = document.getElementById('export-position-select').value;
                if (!selectedPosition) {
                    showError('Please select a position to export.');
                    return;
                }
            }
            
            if (selectedExportOption === 'specific-organization') {
                const selectedOrg = document.getElementById('export-organization-select').value;
                if (!selectedOrg) {
                    showError('Please select an organization to export.');
                    return;
                }
            }
            
            // Close export modal and show progress
            closeModal('exportModal');
            document.getElementById('progressModal').style.display = 'block';
            
            try {
                await performExport();
                closeModal('progressModal');
                showSuccess('Export completed successfully!');
            } catch (error) {
                closeModal('progressModal');
                showError('Export failed: ' + error.message);
            }
        };

        async function performExport() {
            const headers = [
                'Tracking ID', 'Full Name', 'Section', 'Email', 'Phone', 'Position',
                'Sub-organization', 'Status', 'Submitted At', 'Address', 'Portfolio Link',
                'How They Heard', 'Experience', 'Additional Message'
            ];
            
            function createCSVContent(applications) {
                return [
                    headers.join(','),
                    ...applications.map(app => [
                        app.trackingId,
                        `"${app.fullName}"`,
                        `"${app.section || 'N/A'}"`,
                        app.email,
                        app.phone,
                        `"${app.position}"`,
                        `"${app.subOrganization}"`,
                        `"${app.status}"`,
                        `"${new Date(app.submittedAt).toLocaleString()}"`,
                        `"${app.address}"`,
                        `"${app.portfolioLink}"`,
                        `"${app.hearAbout}"`,
                        `"${app.experience.replace(/"/g, '""')}"`,
                        `"${(app.additionalMessage || '').replace(/"/g, '""')}"`
                    ].join(','))
                ].join('\n');
            }
            
            function downloadCSV(content, filename) {
                const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            const today = new Date().toISOString().split('T')[0];
            
            switch (selectedExportOption) {
                case 'all':
                    const allApps = Object.values(applicationsData);
                    const csvContent = createCSVContent(allApps);
                    downloadCSV(csvContent, `silakbo-applications-all-${today}.csv`);
                    break;
                    
                case 'filtered':
                    const filteredApps = filteredApplications.map(id => applicationsData[id]);
                    const filteredContent = createCSVContent(filteredApps);
                    downloadCSV(filteredContent, `silakbo-applications-filtered-${today}.csv`);
                    break;
                    
                case 'by-position':
                    const positionGroups = {};
                    Object.values(applicationsData).forEach(app => {
                        if (!positionGroups[app.position]) {
                            positionGroups[app.position] = [];
                        }
                        positionGroups[app.position].push(app);
                    });
                    
                    if (typeof JSZip !== 'undefined') {
                        const zip = new JSZip();
                        Object.entries(positionGroups).forEach(([position, apps]) => {
                            const content = createCSVContent(apps);
                            const filename = `${position.replace(/[^a-z0-9]/gi, '_').toLowerCase()}-${today}.csv`;
                            zip.file(filename, content);
                        });
                        
                        const zipContent = await zip.generateAsync({type: 'blob'});
                        downloadCSV(zipContent, `silakbo-applications-by-position-${today}.zip`);
                    } else {
                        // Fallback: download files individually
                        Object.entries(positionGroups).forEach(([position, apps]) => {
                            const content = createCSVContent(apps);
                            const filename = `silakbo-${position.replace(/[^a-z0-9]/gi, '_').toLowerCase()}-${today}.csv`;
                            setTimeout(() => downloadCSV(content, filename), 100);
                        });
                    }
                    break;
                    
                case 'by-organization':
                    const orgGroups = {};
                    Object.values(applicationsData).forEach(app => {
                        if (!orgGroups[app.subOrganization]) {
                            orgGroups[app.subOrganization] = [];
                        }
                        orgGroups[app.subOrganization].push(app);
                    });
                    
                    if (typeof JSZip !== 'undefined') {
                        const zip = new JSZip();
                        Object.entries(orgGroups).forEach(([org, apps]) => {
                            const content = createCSVContent(apps);
                            const filename = `${org.replace(/[^a-z0-9]/gi, '_').toLowerCase()}-${today}.csv`;
                            zip.file(filename, content);
                        });
                        
                        const zipContent = await zip.generateAsync({type: 'blob'});
                        downloadCSV(zipContent, `silakbo-applications-by-organization-${today}.zip`);
                    } else {
                        // Fallback: download files individually
                        Object.entries(orgGroups).forEach(([org, apps]) => {
                            const content = createCSVContent(apps);
                            const filename = `silakbo-${org.replace(/[^a-z0-9]/gi, '_').toLowerCase()}-${today}.csv`;
                            setTimeout(() => downloadCSV(content, filename), 100);
                        });
                    }
                    break;
                    
                case 'specific-position':
                    const selectedPosition = document.getElementById('export-position-select').value;
                    const positionApps = Object.values(applicationsData).filter(app => app.position === selectedPosition);
                    const positionContent = createCSVContent(positionApps);
                    const positionFilename = `silakbo-${selectedPosition.replace(/[^a-z0-9]/gi, '_').toLowerCase()}-${today}.csv`;
                    downloadCSV(positionContent, positionFilename);
                    break;
                    
                case 'specific-organization':
                    const selectedOrg = document.getElementById('export-organization-select').value;
                    const orgApps = Object.values(applicationsData).filter(app => app.subOrganization === selectedOrg);
                    const orgContent = createCSVContent(orgApps);
                    const orgFilename = `silakbo-${selectedOrg.replace(/[^a-z0-9]/gi, '_').toLowerCase()}-${today}.csv`;
                    downloadCSV(orgContent, orgFilename);
                    break;
            }
        }

        window.closeModal = function(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'deleteModal') deleteTrackingId = null;
            if (modalId === 'emailModal') emailApplicantData = null;
        };

        window.confirmDelete = async function() {
            if (!deleteTrackingId || !db) return;

            try {
                await remove(ref(db, 'applications/' + deleteTrackingId));
                delete applicationsData[deleteTrackingId];
                filteredApplications = filteredApplications.filter(id => id !== deleteTrackingId);
                
                closeModal('deleteModal');
                totalPages = Math.ceil(filteredApplications.length / ITEMS_PER_PAGE);
                if (currentPage > totalPages) currentPage = Math.max(1, totalPages);
                
                displayApplications();
                updateStats();
                showSuccess('Application deleted successfully');
            } catch (error) {
                showError('Error deleting application: ' + error.message);
            }
        };

        window.sendInterviewEmail = async function() {
            if (!emailApplicantData) return;
            
            if (!emailJSInitialized) {
                if (!initializeEmailJS()) {
                    showError('Email service not available. Please try again later.');
                    return;
                }
            }
            
            try {
                const templateParams = {
                    to_name: emailApplicantData.fullName,
                    to_email: emailApplicantData.email,
                    subject: "Interview Invitation - Ang Silakbo",
                    position: emailApplicantData.position,
                    tracking_id: emailApplicantData.trackingId
                };
                
                await emailjs.send('service_is88c5t', 'template_cbxlz4l', templateParams);
                showSuccess(`Interview email sent to ${emailApplicantData.fullName}`);
                closeModal('emailModal');
                await updateStatus(emailApplicantData.trackingId, 'Interview');
            } catch (error) {
                showError('Failed to send email: ' + error.message);
            }
        };

        // Close modal when clicking outside
        window.onclick = function(event) {
            const deleteModal = document.getElementById('deleteModal');
            const emailModal = document.getElementById('emailModal');
            const exportModal = document.getElementById('exportModal');
            const progressModal = document.getElementById('progressModal');
            
            if (event.target === deleteModal) {
                closeModal('deleteModal');
            } else if (event.target === emailModal) {
                closeModal('emailModal');
            } else if (event.target === exportModal) {
                closeModal('exportModal');
            } else if (event.target === progressModal) {
                closeModal('progressModal');
            }
        };

        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            db = initializeFirebase();
            
            // Try to initialize EmailJS immediately
            if (!initializeEmailJS()) {
                // If it fails, try again after a delay
                setTimeout(() => {
                    initializeEmailJS();
                }, 2000);
            }
            
            if (db) {
                loadApplications();
            }
        });
    </script>
</body>
</html>
