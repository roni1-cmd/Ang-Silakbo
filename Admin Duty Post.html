<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SILAKBO - Admin Post Duty</title>
    <link rel="icon" href="SILAKBO (1).png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff6600;
            --secondary-color: #333;
            --background-color: #ffffff;
            --text-color: #333;
            --card-background: #fff8f0;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .logo {
            display: flex;
            align-items: center;
        }
        .logo img {
            width: 40px;
            height: 40px;
            margin-right: 15px;
        }
        .contact-info {
            font-size: 0.9em;
        }
        main {
            flex-grow: 1;
            padding: 40px 0;
            background: linear-gradient(135deg, #fff8f0 0%, #ffffff 100%);
        }
        h1 {
            font-size: 1.8em;
            margin: 0;
            color: white;
        }
        h2, h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        .card {
            background-color: var(--card-background);
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(255, 102, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(255, 102, 0, 0.2);
        }
        #authStatus {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        input[type="email"], input[type="password"], input[type="text"], input[type="datetime-local"], textarea, select {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ffd1b3;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: white;
        }
        input:focus, textarea:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 102, 0, 0.2);
        }
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
            box-shadow: 0 4px 6px rgba(255, 102, 0, 0.2);
        }
        button:hover {
            background-color: #e55c00;
            box-shadow: 0 6px 8px rgba(255, 102, 0, 0.3);
        }
        button:active {
            transform: scale(0.98);
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-weight: 600;
        }
        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: white;
            color: var(--primary-color);
            padding: 12px;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: background-color 0.3s, color 0.3s, transform 0.1s;
            z-index: 1000;
        }
        .home-button:hover {
            background-color: var(--primary-color);
            color: white;
        }
        .home-button:active {
            transform: scale(0.95);
        }
        footer {
            background-color: var(--secondary-color);
            color: white;
            text-align: center;
            padding: 30px 0;
            margin-top: auto;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .social-links a {
            color: white;
            margin-left: 15px;
            font-size: 1.4em;
            transition: color 0.3s, transform 0.3s;
        }
        .social-links a:hover {
            color: var(--primary-color);
            transform: scale(1.2);
        }
        .quick-links {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 8px rgba(255, 102, 0, 0.1);
        }
        .quick-links ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        .quick-links li {
            margin: 10px;
        }
        .quick-links li a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s, transform 0.3s;
            display: inline-block;
        }
        .quick-links li a:hover {
            color: #e55c00;
            transform: translateY(-3px);
        }
        .stats-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            min-width: 200px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-card h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        .stat-card p {
            font-size: 1.5em;
            font-weight: bold;
        }
        .notification {
            background-color: #e6f7ff;
            border-left: 4px solid #1890ff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            .logo {
                margin-bottom: 10px;
            }
            .contact-info {
                margin-top: 10px;
            }
            .footer-content {
                flex-direction: column;
            }
            .social-links {
                margin-top: 20px;
            }
            .stats-container {
                flex-direction: column;
            }
            .stat-card {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <a href="Ang Silakbo Admin Panel.html" class="home-button">
        <i class="fas fa-home"></i>
    </a>

    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="SILAKBO.png" alt="SILAKBO Logo">
                    <h1>ANG SILAKBO</h1>
                </div>
                <div class="contact-info">
                    <i class="fas fa-envelope"></i> For Troubleshooting: asnahonron@gmail.com
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <h2><i class="fas fa-clipboard-list"></i> Admin - Post Duties</h2>
            
            <div class="notification">
                <p><strong>Notice:</strong> You can now schedule recurring duties, making it easier to manage repeated tasks or responsibilities. This allows you to automate the scheduling process for duties that occur daily, weekly, monthly, or at other intervals, saving time and ensuring consistency.</p>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <h3>Total Duties</h3>
                    <p id="totalDuties">0</p>
                </div>
                <div class="stat-card">
                    <h3>Active Admins</h3>
                    <p id="activeAdmins">3</p>
                </div>
                <div class="stat-card">
                    <h3>Upcoming Events</h3>
                    <p id="upcomingEvents">N/A</p>
                </div>
            </div>
            
            <div class="quick-links card">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="Ang Silakbo Registered Applicants.html"><i class="fas fa-users"></i> Applicants</a></li>
                    <li><a href="Calendar.html"><i class="fas fa-calendar-alt"></i> View Schedule</a></li>
                    <li><a href="Ang Silakbo Admin Panel.html"><i class="fas fa-cog"></i> Admin Panel</a></li>
                    <li><a href="Ang Silkabo Editor.html"><i class="fas fa-chart-bar"></i> Article Editor</a></li>
                    <li><a href="Chat.html"><i class="fas fa-envelope"></i> Messages</a></li>
                </ul>
            </div>
            
            <div id="authStatus"></div>
            
            <div id="loginForm" class="card">
                <h3><i class="fas fa-sign-in-alt"></i> Login</h3>
                <input type="email" id="email" placeholder="Email">
                <input type="password" id="password" placeholder="Password">
                <button id="loginButton"><i class="fas fa-lock"></i> Login</button>
            </div>

            <form id="dutyForm" class="card" style="display:none;">
                <h3><i class="fas fa-tasks"></i> Post New Duty</h3>
                <label for="what"><i class="fas fa-info-circle"></i> What:</label>
                <input type="text" id="what" required>

                <label for="when"><i class="far fa-calendar-alt"></i> When:</label>
                <input type="datetime-local" id="when" required>

                <label for="where"><i class="fas fa-map-marker-alt"></i> Where:</label>
                <input type="text" id="where" required>

                <label for="peopleInvolved"><i class="fas fa-users"></i> Silakboer Involved:</label>
                <textarea id="peopleInvolved" required></textarea>

                <label for="priority"><i class="fas fa-exclamation-circle"></i> Priority:</label>
                <select id="priority" required>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>

                <button type="submit"><i class="fas fa-paper-plane"></i> Post Duty</button>
            </form>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2021 SILAKBO. All rights reserved.</p>
                <div class="social-links">
                    <a href="https://www.facebook.com/AngSilakboUCLM"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getDatabase, ref, get, push, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDSe2c9-8xqShoHEW-D7BXXAyD5N9uXWEs",
            authDomain: "ang-silakbo.firebaseapp.com",
            databaseURL: "https://ang-silakbo-default-rtdb.firebaseio.com",
            projectId: "ang-silakbo",
            storageBucket: "ang-silakbo.firebasestorage.app",
            messagingSenderId: "1006400633782",
            appId: "1:1006400633782:web:ef4a93c1d445cb825b9f17",
            measurementId: "G-TSDTG2YJ94"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Admin name mapping
        const adminNames = {
            'angsilakbo1@uclm.com': 'Queenie Maire',
            'angsilakbo2@uclm.com': 'June Marie',
            'angsilakbo3@uclm.com': 'Diana Rose'
        };

        console.log("Firebase initialized");

        // Listen for authentication state changes
        onAuthStateChanged(auth, (user) => {
            console.log("Auth state changed");
            if (user) {
                console.log("User is signed in:", user.email);
                updateAuthStatus(user);
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('dutyForm').style.display = 'block';
                fetchStats();
            } else {
                console.log("No user is signed in.");
                document.getElementById('authStatus').textContent = "Not signed in";
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('dutyForm').style.display = 'none';
            }
        });

        function updateAuthStatus(user) {
            const authStatusDiv = document.getElementById('authStatus');
            authStatusDiv.textContent = `Signed in as: ${adminNames[user.email] || user.email}`;
            checkAdminStatus(user);
        }

        function checkAdminStatus(user) {
            console.log("Checking admin status for:", user.uid);
            get(ref(database, 'admins/' + user.uid))
                .then(snapshot => {
                    if (snapshot.exists()) {
                        console.log("User is an admin");
                        document.getElementById('authStatus').textContent += " (Admin)";
                    } else {
                        console.log("User is not an admin");
                        document.getElementById('authStatus').textContent += " (Not an admin)";
                    }
                })
                .catch(error => {
                    console.error("Error checking admin status:", error);
                });
        }

        document.getElementById('loginButton').addEventListener('click', function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            console.log("Attempting login with email:", email);
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    console.log("Login successful", userCredential);
                })
                .catch((error) => {
                    console.error("Login error:", error);
                    console.error("Error code:", error.code);
                    console.error("Error message:", error.message);
                    alert("Login failed: " + error.message);
                });
        });

        document.getElementById('dutyForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const user = auth.currentUser;
            if (!user) {
                alert('You must be logged in to post a duty.');
                return;
            }

            const duty = {
                what: document.getElementById('what').value,
                when: document.getElementById('when').value,
                where: document.getElementById('where').value,
                peopleInvolved: document.getElementById('peopleInvolved').value,
                priority: document.getElementById('priority').value,
                timestamp: new Date().toISOString(),
                postedBy: adminNames[user.email] || user.email
            };

            get(ref(database, 'admins/' + user.uid))
                .then(snapshot => {
                    if (snapshot.exists()) {
                        return push(ref(database, 'duties'), duty);
                    } else {
                        throw new Error('User is not an admin');
                    }
                })
                .then(() => {
                    console.log('Duty posted successfully!');
                    alert('Duty posted successfully!');
                    document.getElementById('dutyForm').reset();
                    fetchStats();
                })
                .catch((error) => {
                    console.error('Error posting duty: ', error);
                    alert('Error posting duty: ' + error.message);
                });
        });

        function fetchStats() {
            const dutiesRef = ref(database, 'duties');
            const adminsRef = ref(database, 'admins');

            get(dutiesRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const totalDuties = Object.keys(snapshot.val()).length;
                    document.getElementById('totalDuties').textContent = totalDuties;

                    const now = new Date();
                    const upcomingEvents = Object.values(snapshot.val()).filter(duty => {
                        const dutyDate = new Date(duty.when);
                        return dutyDate > now;
                    }).length;
                    document.getElementById('upcomingEvents').textContent = upcomingEvents;
                }
            });

            get(adminsRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const activeAdmins = Object.keys(snapshot.val()).length;
                    document.getElementById('activeAdmins').textContent = activeAdmins;
                }
            });
        }
    </script>
</body>
</html>