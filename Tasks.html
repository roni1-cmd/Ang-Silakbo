<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ang Silako - Production Team Tasking</title>
    <link rel="icon" href="SILAKBO (1).png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #FF6B35;
            --secondary-color: #FFA07A;
            --background-color: #F5F5F5;
            --text-color: #333333;
            --card-background: #FFFFFF;
            --border-color: #E0E0E0;
            --hover-color: #FF8C61;
            --error-color: #FF4136;
            --success-color: #2ECC40;
            --warning-color: #FFDC00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: var(--primary-color);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .logo {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .sidebar h1 {
            font-size: 24px;
            color: white;
            margin: 0;
        }

        .nav-menu {
            list-style-type: none;
        }

        .nav-menu li {
            margin-bottom: 15px;
        }

        .nav-menu a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-menu a i {
            margin-right: 10px;
            font-size: 18px;
        }

        .nav-menu a:hover, .nav-menu a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .main-content {
            flex-grow: 1;
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .card {
            background-color: var(--card-background);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .card h2 i {
            margin-right: 10px;
            font-size: 24px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background-color: var(--background-color);
            border-radius: 15px;
            transition: all 0.3s ease;
            border: 2px solid var(--primary-color);
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-item h3 {
            font-size: 28px;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .stat-item i {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }

        .error {
            color: var(--error-color);
            margin-top: 10px;
            font-weight: 500;
        }

        .task-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .member-tasks {
            background-color: var(--background-color);
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 15px;
            transition: all 0.3s ease;
            border-left: 5px solid var(--primary-color);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .member-tasks:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .member-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .member-name i {
            margin-right: 8px;
        }

        .task-item {
            background-color: var(--card-background);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .task-item .task-info {
            flex-grow: 1;
        }

        .task-item .task-actions {
            display: flex;
            gap: 10px;
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
        }

        .status i {
            margin-right: 5px;
        }

        .status.completed {
            background-color: var(--success-color);
            color: white;
        }

        .status.pending {
            background-color: var(--warning-color);
            color: var(--text-color);
        }

        .status.overdue {
            background-color: var(--error-color);
            color: white;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            gap: 15px;
        }

        .calendar-day {
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .calendar-day:hover {
            background-color: var(--secondary-color);
            color: white;
        }

        .calendar-day.today {
            background-color: var(--primary-color);
            color: white;
        }

        .calendar-day.has-task {
            border: 2px solid var(--primary-color);
        }

        .calendar-day .day-number {
            font-size: 18px;
            font-weight: 600;
        }

        .calendar-day .day-name {
            font-size: 12px;
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background-color: var(--card-background);
            margin: 15% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: var(--text-color);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover {
            color: var(--primary-color);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        .quick-add {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .quick-add input {
            flex-grow: 1;
        }

        .filter-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            background-color: var(--background-color);
            color: var(--text-color);
            border: 2px solid var(--primary-color);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
        }

        .filter-btn i {
            margin-right: 5px;
        }

        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .filter-btn:hover {
            background-color: var(--hover-color);
            color: white;
        }

        .task-summary {
            background-color: var(--card-background);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .task-summary h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .task-summary ul {
            list-style-type: none;
        }

        .task-summary li {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .task-summary li i {
            margin-right: 10px;
            color: var(--primary-color);
        }

        #loginForm {
            max-width: 300px;
            margin: 0 auto;
        }

        #loginError {
            color: var(--error-color);
            margin-top: 10px;
            text-align: center;
        }

        .search-container {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
        }

        .team-chat {
            background-color: var(--card-background);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .team-chat h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .chat-message {
            background-color: var(--background-color);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .chat-message .sender {
            font-weight: bold;
            color: var(--primary-color);
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex-grow: 1;
        }

        .task-log {
            background-color: var(--background-color);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .task-log-entry {
            margin-bottom: 5px;
            font-size: 14px;
        }

        @media (max-width: 1200px) {
            .sidebar {
                width: 80px;
                overflow: hidden;
            }

            .sidebar h1 {
                font-size: 24px;
                white-space: nowrap;
            }

            .nav-menu a {
                padding: 15px;
                text-align: center;
            }

            .nav-menu a span {
                display: none;
            }

            .main-content {
                margin-left: 80px;
            }
        }

        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                padding: 10px;
            }

            .sidebar h1 {
                font-size: 24px;
                white-space: normal;
            }

            .nav-menu {
                display: flex;
                justify-content: space-around;
            }

            .nav-menu li {
                margin-bottom: 0;
            }

            .main-content {
                margin-left: 0;
                padding: 10px;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
            }

            .calendar {
                grid-template-columns: repeat(7, 1fr);
            }

            .calendar-day {
                padding: 10px 5px;
            }

            .calendar-day .day-number {
                font-size: 14px;
            }

            .calendar-day .day-name {
                font-size: 10px;
            }

            .filter-container {
                flex-wrap: wrap;
            }

            .filter-btn {
                flex: 1 0 calc(50% - 5px);
            }
        }

        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
            }

            .calendar-day {
                padding: 5px;
            }

            .calendar-day .day-number {
                font-size: 12px;
            }

            .calendar-day .day-name {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="SILAKBO.png" alt="Logo" class="logo">
                <h1>ANG SILAKBO</h1>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#summary" class="active"><i class="fas fa-chart-pie"></i><span>Summary</span></a></li>
                    <li><a href="#assign-task"><i class="fas fa-tasks"></i><span>Assign Task</span></a></li>
                    <li><a href="#task-list"><i class="fas fa-list-ul"></i><span>Task List</span></a></li>
                    <li><a href="#calendar"><i class="far fa-calendar-alt"></i><span>Calendar</span></a></li>
                    <li><a href="#team-chat"><i class="fas fa-comments"></i><span>Team Chat</span></a></li>
                </ul>
            </nav>
        </aside>
        <main class="main-content">
            <section id="login" class="card">
                <h2><i class="fas fa-sign-in-alt"></i>Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" required>
                    </div>
                    <button type="submit" class="btn"><i class="fas fa-sign-in-alt"></i>Login</button>
                </form>
                <p id="loginError"></p>
            </section>
            <section id="summary" class="card">
                <h2><i class="fas fa-chart-pie"></i>Summary</h2>
                <div class="stats">
                    <div class="stat-item">
                        <i class="fas fa-tasks"></i>
                        <h3 id="totalTasks">0</h3>
                        <p>Total Tasks</p>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-check-circle"></i>
                        <h3 id="completedTasks">0</h3>
                        <p>Completed</p>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <h3 id="pendingTasks">0</h3>
                        <p>Pending</p>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3 id="overdueTasks">0</h3>
                        <p>Overdue</p>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress" id="taskProgress"></div>
                </div>
                <p id="progressText" class="text-center mt-2"></p>
            </section>
            <section id="assign-task" class="card" style="display: none;">
                <h2><i class="fas fa-plus-circle"></i>Assign New Task</h2>
                <form id="taskForm">
                    <div class="form-group">
                        <label for="positionSelect">Position:</label>
                        <select id="positionSelect" required>
                            <option value="">Select Position</option>
                            <option value="Broadcaster">Broadcaster</option>
                            <option value="Photojournalist">Photojournalist</option>
                            <option value="Videographer">Videographer</option>
                            <option value="Video Editor">Video Editor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="memberSelect">Member:</label>
                        <select id="memberSelect" required>
                            <option value="">Select Member</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskInput">Task Description:</label>
                        <textarea id="taskInput" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="taskDate">Due Date:</label>
                        <input type="date" id="taskDate" required>
                    </div>
                    <div class="form-group">
                        <label for="taskLocation">Location:</label>
                        <input type="text" id="taskLocation">
                    </div>
                    <button type="submit" class="btn"><i class="fas fa-plus"></i>Assign Task</button>
                </form>
                <p id="errorMessage" class="error"></p>
            </section>
            <section id="task-list" class="card">
                <h2><i class="fas fa-list-ul"></i>Task List</h2>
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="Search by position or name...">
                </div>
                <div class="filter-container">
                    <button class="filter-btn active" data-filter="all"><i class="fas fa-th-list"></i>All</button>
                    <button class="filter-btn" data-filter="pending"><i class="fas fa-clock"></i>Pending</button>
                    <button class="filter-btn" data-filter="completed"><i class="fas fa-check-circle"></i>Completed</button>
                    <button class="filter-btn" data-filter="overdue"><i class="fas fa-exclamation-triangle"></i>Overdue</button>
                </div>
                <div class="quick-add">
                    <input type="text" id="quickTaskInput" placeholder="Quick add task...">
                    <button id="quickAddBtn" class="btn"><i class="fas fa-bolt"></i>Add</button>
                </div>
                <div class="task-list" id="taskListContainer"></div>
                <div class="task-summary">
                    <h3>Task Overview</h3>
                    <ul>
                        <li><i class="fas fa-user"></i>Most Active Member: <span id="mostActiveMember">-</span></li>
                        <li><i class="fas fa-calendar-day"></i>Busiest Day: <span id="busiestDay">-</span></li>
                        <li><i class="fas fa-chart-line"></i>Completion Rate: <span id="completionRate">-</span></li>
                    </ul>
                </div>
            </section>
            <section id="calendar" class="card">
                <h2><i class="far fa-calendar-alt"></i>Calendar</h2>
                <div class="calendar-header">
                    <h3 id="currentMonth"></h3>
                    <div class="calendar-nav">
                        <button id="prevMonth" class="btn"><i class="fas fa-chevron-left"></i></button>
                        <button id="nextMonth" class="btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div id="calendarContainer" class="calendar"></div>
            </section>
            <section id="team-chat" class="card">
                <h2><i class="fas fa-comments"></i>Team Chat</h2>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Type your message...">
                    <button id="sendMessageBtn" class="btn"><i class="fas fa-paper-plane"></i>Send</button>
                </div>
            </section>
        </main>
    </div>

    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Task Details</h2>
            <div id="taskDetails"></div>
            <div id="taskLog"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDSe2c9-8xqShoHEW-D7BXXAyD5N9uXWEs",
            authDomain: "ang-silakbo.firebaseapp.com",
            databaseURL: "https://ang-silakbo-default-rtdb.firebaseio.com",
            projectId: "ang-silakbo",
            storageBucket: "ang-silakbo.firebasestorage.app",
            messagingSenderId: "1006400633782",
            appId: "1:1006400633782:web:ef4a93c1d445cb825b9f17",
            measurementId: "G-TSDTG2YJ94"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Member data
        const members = {
            Broadcaster: [
                "Sylvania Kea Empenado", "Chandler Ken Castillano", "John Carmelo Ibasco",
                "Jazel Malinao", "Ashley Guibay", "Hanz Psyche Baritos", "Febrielle Jacla",
                "Aries Renz Bandalan", "Richelle Quilang", "Rhoda Amistad", "Vince Viñas",
                "Heaven Patricia Macol", "Cris Kervin Alfa", "Ron Asnahon", "Samantha Verdun",
                "Terrence Margaja", "Sharmagne Escobio", "Kharl Jones Almacin", "Rachel Althea T. Ochea",
                "Hesly Basco", "Joemelle Adriel Surilla", "Yaneca Marie Arong", "Jan Ivan Alolod",
                "Mishkha lujil Ordineza", "Ella Mae Nicole Camposo"
            ],
            Photojournalist: [
                "Mary Adellaine Pagador", "Precious Empress Sagarino", "Ruel Jericho Malon",
                "Christabelle Opiasa", "Claire Araneta", "Trisha Yvoe Angcay", "Matthew Taborada",
                "Khristylle Jade Alcos", "David Josh U. Jumalon", "Ian Danrev T. Castillo",
                "Jesry De Asis"
            ],
            Videographer: [
                "Philip Igot", "Karylle Abinuman", "Yezhia Boniel", "Eirene Jade Bardago",
                "DJ Dareal Sabas"
            ],
            "Video Editor": [
                "Marylle Marabiles", "Joem Cedrick Sungahid", "Jolisa Marie Yabillo"
            ]
        };

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Logged in successfully
                    document.getElementById('login').style.display = 'none';
                    document.getElementById('assign-task').style.display = 'block';
                    updateTaskList();
                    updateCalendar();
                })
                .catch((error) => {
                    // Handle errors
                    document.getElementById('loginError').textContent = error.message;
                });
        });

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                document.getElementById('login').style.display = 'none';
                document.getElementById('assign-task').style.display = 'block';
                updateTaskList();
                updateCalendar();
            } else {
                // User is signed out
                document.getElementById('login').style.display = 'block';
                document.getElementById('assign-task').style.display = 'none';
            }
        });

        // Populate member select based on position
        document.getElementById('positionSelect').addEventListener('change', function() {
            const position = this.value;
            const memberSelect = document.getElementById('memberSelect');
            memberSelect.innerHTML = '<option value="">Select Member</option>';
            if (position) {
                members[position].forEach(member => {
                    const option = document.createElement('option');
                    option.value = member;
                    option.textContent = member;
                    memberSelect.appendChild(option);
                });
            }
        });

        // Assign task
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const position = document.getElementById('positionSelect').value;
            const member = document.getElementById('memberSelect').value;
            const task = document.getElementById('taskInput').value;
            const date = document.getElementById('taskDate').value;
            const location = document.getElementById('taskLocation').value;

            const memberRef = database.ref('members/' + member.replace(/\./g, ','));
            memberRef.once('value', snapshot => {
                const memberData = snapshot.val();
                if (memberData && Object.keys(memberData).length >= 2) {
                    document.getElementById('errorMessage').textContent = 'This member already has 2 tasks assigned. Cannot assign more tasks.';
                } else {
                    const newTaskRef = memberRef.push();
                    newTaskRef.set({
                        position: position,
                        task: task,
                        date: date,
                        location: location,
                        status: 'Pending',
                        log: [{
                            action: 'Task Assigned',
                            timestamp: firebase.database.ServerValue.TIMESTAMP
                        }]
                    });
                    alert('Task assigned successfully');
                    document.getElementById('taskForm').reset();
                    document.getElementById('errorMessage').textContent = '';
                    updateTaskList();
                    updateCalendar();
                }
            });
        });

        // Quick add task
        document.getElementById('quickAddBtn').addEventListener('click', function() {
            const taskInput = document.getElementById('quickTaskInput');
            const task = taskInput.value.trim();
            if (task) {
                const randomMember = getRandomMember();
                const memberRef = database.ref('members/' + randomMember.replace(/\./g, ','));
                const newTaskRef = memberRef.push();
                newTaskRef.set({
                    position: 'Quick Task',
                    task: task,
                    date: new Date().toISOString().split('T')[0],
                    location: 'Not specified',
                    status: 'Pending',
                    log: [{
                        action: 'Task Assigned',
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    }]
                });
                taskInput.value = '';
                updateTaskList();
                updateCalendar();
            }
        });

        function getRandomMember() {
            const allMembers = Object.values(members).flat();
            return allMembers[Math.floor(Math.random() * allMembers.length)];
        }

        // Update task list
        function updateTaskList(filter = 'all', searchTerm = '') {
            const taskListContainer = document.getElementById('taskListContainer');
            taskListContainer.innerHTML = '<p>Loading tasks...</p>';

            database.ref('members').once('value', snapshot => {
                const data = snapshot.val();
                taskListContainer.innerHTML = '';
                let totalTasks = 0;
                let completedTasks = 0;
                let pendingTasks = 0;
                let overdueTasks = 0;

                const memberTasks = {};
                const memberTaskCounts = {};
                const dateCounts = {};

                for (let member in data) {
                    for (let taskId in data[member]) {
                        const task = data[member][taskId];
                        const status = getTaskStatus(task);
                        totalTasks++;

                        if (status === 'Completed') {
                            completedTasks++;
                        } else if (status === 'Pending') {
                            pendingTasks++;
                        } else if (status === 'Overdue') {
                            overdueTasks++;
                        }

                        // Count tasks per member
                        memberTaskCounts[member] = (memberTaskCounts[member] || 0) + 1;

                        // Count tasks per date
                        dateCounts[task.date] = (dateCounts[task.date] || 0) + 1;

                        if ((filter === 'all' || status.toLowerCase() === filter) &&
                            (searchTerm === '' || 
                             member.toLowerCase().includes(searchTerm.toLowerCase()) || 
                             task.position.toLowerCase().includes(searchTerm.toLowerCase()))) {
                            if (!memberTasks[member]) {
                                memberTasks[member] = [];
                            }
                            memberTasks[member].push({ id: taskId, ...task });
                        }
                    }
                }

                for (let member in memberTasks) {
                    const memberTasksElement = document.createElement('div');
                    memberTasksElement.className = 'member-tasks';
                    memberTasksElement.innerHTML = `<div class="member-name"><i class="fas fa-user"></i>${member.replace(/,/g, '.')}</div>`;

                    memberTasks[member].forEach(task => {
                        const status = getTaskStatus(task);
                        const taskElement = document.createElement('div');
                        taskElement.className = 'task-item';
                        taskElement.innerHTML = `
                            <div class="task-info">
                                <strong>${task.task}</strong>
                                <br>Due: ${task.date}, Location: ${task.location || 'Not specified'}
                            </div>
                            <div class="task-actions">
                                <span class="status ${status.toLowerCase()}">
                                    <i class="fas fa-${status === 'Completed' ? 'check-circle' : status === 'Pending' ? 'clock' : 'exclamation-triangle'}"></i>
                                    ${status}
                                </span>
                                ${auth.currentUser ? `
                                <button class="btn" onclick="toggleTaskStatus('${member}', '${task.id}', '${status}')">
                                    ${status === 'Completed' ? 'Mark Pending' : 'Mark Complete'}
                                </button>
                                <button class="btn" onclick="editTask('${member}', '${task.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn" onclick="deleteTask('${member}', '${task.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                                ` : ''}
                            </div>
                        `;
                        memberTasksElement.appendChild(taskElement);
                    });

                    taskListContainer.appendChild(memberTasksElement);
                }

                document.getElementById('totalTasks').textContent = totalTasks;
                document.getElementById('completedTasks').textContent = completedTasks;
                document.getElementById('pendingTasks').textContent = pendingTasks;
                document.getElementById('overdueTasks').textContent = overdueTasks;

                // Update progress bar
                const progressBar = document.getElementById('taskProgress');
                const progressPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
                progressBar.style.width = `${progressPercentage}%`;
                document.getElementById('progressText').textContent = `${completedTasks} of ${totalTasks} tasks completed (${progressPercentage.toFixed(1)}%)`;

                // Update task summary
                const mostActiveMember = Object.keys(memberTaskCounts).length > 0
                    ? Object.keys(memberTaskCounts).reduce((a, b) => memberTaskCounts[a] > memberTaskCounts[b] ? a : b)
                    : 'No active members';
                const busiestDay = Object.keys(dateCounts).length > 0
                    ? Object.keys(dateCounts).reduce((a, b) => dateCounts[a] > dateCounts[b] ? a : b)
                    : 'No tasks scheduled';
                const completionRate = totalTasks > 0 ? ((completedTasks / totalTasks) * 100).toFixed(1) + '%' : '0%';

                document.getElementById('mostActiveMember').textContent = mostActiveMember.replace(/,/g, '.');
                document.getElementById('busiestDay').textContent = busiestDay;
                document.getElementById('completionRate').textContent = completionRate;
            });
        }

        function getTaskStatus(task) {
            if (task.status === 'Completed') return 'Completed';
            const today = new Date();
            const dueDate = new Date(task.date);
            return dueDate < today ? 'Overdue' : 'Pending';
        }

        function toggleTaskStatus(member, taskId, currentStatus) {
            if (!auth.currentUser) return; // Prevent non-logged-in users from toggling status
            const newStatus = currentStatus === 'Completed' ? 'Pending' : 'Completed';
            const taskRef = database.ref(`members/${member}/${taskId}`);
            
            taskRef.once('value', snapshot => {
                const task = snapshot.val();
                const updatedLog = task.log || [];
                updatedLog.push({
                    action: `Status changed to ${newStatus}`,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                
                taskRef.update({ 
                    status: newStatus,
                    log: updatedLog
                });
            });
            
            updateTaskList();
            updateCalendar();
        }

        function editTask(member, taskId) {
            const taskRef = database.ref(`members/${member}/${taskId}`);
            taskRef.once('value', snapshot => {
                const task = snapshot.val();
                const newTask = prompt('Edit task:', task.task);
                if (newTask !== null && newTask.trim() !== '') {
                    const updatedLog = task.log || [];
                    updatedLog.push({
                        action: 'Task Edited',
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    taskRef.update({ 
                        task: newTask,
                        log: updatedLog
                    });
                    updateTaskList();
                    updateCalendar();
                }
            });
        }

        function deleteTask(member, taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                database.ref(`members/${member}/${taskId}`).remove();
                updateTaskList();
                updateCalendar();
            }
        }

        // Calendar functions
        let currentDate = new Date();

        function updateCalendar() {
            const calendarContainer = document.getElementById('calendarContainer');
            const currentMonthElement = document.getElementById('currentMonth');

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            currentMonthElement.textContent = new Date(year, month).toLocaleString('default', { month: 'long', year: 'numeric' });

            const calendar = generateCalendar(year, month);
            calendarContainer.innerHTML = calendar;

            database.ref('members').once('value', snapshot => {
                const data = snapshot.val();
                for (let member in data) {
                    for (let taskId in data[member]) {
                        const task = data[member][taskId];
                        const taskDate = new Date(task.date);
                        if (taskDate.getMonth() === month && taskDate.getFullYear() === year) {
                            const day = taskDate.getDate();
                            const cell = document.querySelector(`.calendar-day[data-date="${day}"]`);
                            if (cell) {
                                cell.classList.add('has-task');
                                cell.addEventListener('click', () => showTaskDetails(member, taskId, task));
                            }
                        }
                    }
                }
            });
        }

        function generateCalendar(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();

            let calendarHTML = '';
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            // Add day names
            for (let i = 0; i < 7; i++) {
                calendarHTML += `<div class="calendar-day"><span class="day-name">${dayNames[i]}</span></div>`;
            }

            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                calendarHTML += '<div class="calendar-day"></div>';
            }

            // Add days of the month
            for (let i = 1; i <= daysInMonth; i++) {
                const date = new Date(year, month, i);
                const isToday = date.toDateString() === new Date().toDateString();
                calendarHTML += `
                    <div class="calendar-day ${isToday ? 'today' : ''}" data-date="${i}">
                        <span class="day-number">${i}</span>
                    </div>
                `;
            }

            return calendarHTML;
        }

        function showTaskDetails(member, taskId, task) {
            const modal = document.getElementById('taskModal');
            const taskDetails = document.getElementById('taskDetails');
            const taskLog = document.getElementById('taskLog');
            
            taskDetails.innerHTML = `
                <p><strong>Member:</strong> ${member.replace(/,/g, '.')}</p>
                <p><strong>Task:</strong> ${task.task}</p>
                <p><strong>Due Date:</strong> ${task.date}</p>
                <p><strong>Location:</strong> ${task.location || 'Not specified'}</p>
                <p><strong>Status:</strong> ${getTaskStatus(task)}</p>
            `;
            
            taskLog.innerHTML = '<h3>Task Log</h3>';
            if (task.log && task.log.length > 0) {
                const logList = document.createElement('ul');
                task.log.forEach(entry => {
                    const logItem = document.createElement('li');
                    logItem.textContent = `${new Date(entry.timestamp).toLocaleString()}: ${entry.action}`;
                    logList.appendChild(logItem);
                });
                taskLog.appendChild(logList);
            } else {
                taskLog.innerHTML += '<p>No log entries available.</p>';
            }
            
            modal.style.display = 'block';
        }

        // Close modal when clicking on <span> (x)
        document.querySelector('.close').onclick = function() {
            document.getElementById('taskModal').style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('taskModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Calendar navigation
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateCalendar();
        });

        // Task list filtering
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                updateTaskList(this.dataset.filter, document.getElementById('searchInput').value);
            });
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value;
            const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
            updateTaskList(activeFilter, searchTerm);
        });

        // Team Chat functionality
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');

        function addMessage(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message';
            messageElement.innerHTML = `<span class="sender">${sender}:</span> ${message}`;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        sendMessageBtn.addEventListener('click', () => {
            const message = chatInput.value.trim();
            if (message && auth.currentUser) {
                const sender = auth.currentUser.email.split('@')[0];
                database.ref('chat').push({
                    sender: sender,
                    message: message,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                chatInput.value = '';
            }
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessageBtn.click();
            }
        });

        database.ref('chat').on('child_added', (snapshot) => {
            const message = snapshot.val();
            const senderName = getSenderName(message.sender);
            addMessage(senderName, message.message);
        });

        function getSenderName(email) {
            const memberNames = {
                'angsilakbo1@gmail.com': 'Ron Asnahon',
                'angsilakbo2@gmail.com': 'Jesry De Asis'
            };
            return memberNames[email] || email.split('@')[0];
        }

        // Initial load
        updateTaskList();
        updateCalendar();

    </script>
</body>
</html>
