<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ang Silako - Production Team Tasking</title>
    <link rel="icon" href="SILAKBO (1).png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #FF6B35;
            --secondary-color: #FFA07A;
            --background-color: #F5F5F5;
            --text-color: #333333;
            --card-background: #FFFFFF;
            --border-color: #E0E0E0;
            --hover-color: #FF8C61;
            --error-color: #FF4136;
            --success-color: #2ECC40;
            --warning-color: #FFDC00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: var(--primary-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .logo {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .sidebar h1 {
            font-size: 24px;
            color: white;
            margin: 0;
        }

        .nav-menu {
            list-style-type: none;
            flex-grow: 1;
        }

        .nav-menu li {
            margin-bottom: 15px;
        }

        .nav-menu a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-menu a i {
            margin-right: 10px;
            font-size: 18px;
        }

        .nav-menu a:hover, .nav-menu a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            background-color: var(--card-background);
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .content-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .content-actions {
            display: flex;
            gap: 10px;
        }

        .content-body {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .card {
            background-color: var(--card-background);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .card h2 i {
            margin-right: 10px;
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-item {
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .task-info {
            flex-grow: 1;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
        }

        .status i {
            margin-right: 5px;
        }

        .status.completed {
            background-color: var(--success-color);
            color: white;
        }

        .status.pending {
            background-color: var(--warning-color);
            color: var(--text-color);
        }

        .status.overdue {
            background-color: var(--error-color);
            color: white;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            gap: 15px;
        }

        .calendar-day {
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .calendar-day:hover {
            background-color: var(--secondary-color);
            color: white;
        }

        .calendar-day.today {
            background-color: var(--primary-color);
            color: white;
        }

        .calendar-day.has-task {
            border: 2px solid var(--primary-color);
        }

        .calendar-day .day-number {
            font-size: 18px;
            font-weight: 600;
        }

        .calendar-day .day-name {
            font-size: 12px;
            margin-top: 5px;
        }

        #loginForm {
            max-width: 300px;
            margin: 0 auto;
        }

        #loginError {
            color: var(--error-color);
            margin-top: 10px;
            text-align: center;
        }

        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            height: 400px;
            background-color: var(--card-background);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-close {
            cursor: pointer;
            font-size: 18px;
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .message {
            max-width: 80%;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 20px;
            line-height: 1.4;
            position: relative;
            clear: both;
        }

        .message.sent {
            background-color: var(--primary-color);
            color: white;
            float: right;
            border-bottom-right-radius: 0;
        }

        .message.received {
            background-color: white;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            float: left;
            border-bottom-left-radius: 0;
        }

        .message-info {
            font-size: 10px;
            margin-top: 5px;
            opacity: 0.7;
        }

        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid var(--border-color);
        }

        .chat-input input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            margin-right: 10px;
        }

        .chat-input button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
        }

        .sort-buttons {
            margin-bottom: 15px;
        }

        .sort-buttons button {
            margin-right: 10px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .summary-card i {
            font-size: 36px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .summary-card h3 {
            font-size: 24px;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .summary-card p {
            font-size: 14px;
            color: var(--text-color);
        }

        .chart-container {
            margin-top: 30px;
            height: 300px;
        }

        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .chat-toggle:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
            }

            .nav-menu {
                display: flex;
                justify-content: space-around;
                margin-top: 20px;
            }

            .nav-menu li {
                margin-bottom: 0;
            }

            .main-content {
                height: calc(100vh - 200px);
            }

            .chat-container {
                width: 100%;
                height: 300px;
                bottom: 0;
                right: 0;
                border-radius: 0;
            }

            .chat-toggle {
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="SILAKBO.png" alt="Logo" class="logo">
                <h1>ANG SILAKBO</h1>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#summary" class="active" onclick="showTab('summary')"><i class="fas fa-chart-pie"></i><span>Summary</span></a></li>
                    <li><a href="#assign-task" onclick="showTab('assign-task')"><i class="fas fa-tasks"></i><span>Assign Task</span></a></li>
                    <li><a href="#task-list" onclick="showTab('task-list')"><i class="fas fa-list-ul"></i><span>Task List</span></a></li>
                    <li><a href="#calendar" onclick="showTab('calendar')"><i class="far fa-calendar-alt"></i><span>Calendar</span></a></li>
                </ul>
            </nav>
        </aside>
        <main class="main-content">
            <div class="content-header">
                <h2 class="content-title">Production Team Tasking</h2>
                <div class="content-actions">
                    <button class="btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i>Logout</button>
                </div>
            </div>
            <div class="content-body">
                <div id="loginSection" class="card">
                    <h2><i class="fas fa-sign-in-alt"></i>Login</h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password:</label>
                            <input type="password" id="password" required>
                        </div>
                        <button type="submit" class="btn"><i class="fas fa-sign-in-alt"></i>Login</button>
                    </form>
                    <p id="loginError"></p>
                </div>
                <div id="mainContent" style="display: none;">
                    <div id="summary" class="tab-content active">
                        <h2><i class="fas fa-chart-pie"></i>Summary</h2>
                        <div class="summary-grid">
                            <div class="summary-card">
                                <i class="fas fa-tasks"></i>
                                <h3 id="totalTasks">0</h3>
                                <p>Total Tasks</p>
                            </div>
                            <div class="summary-card">
                                <i class="fas fa-check-circle"></i>
                                <h3 id="completedTasks">0</h3>
                                <p>Completed Tasks</p>
                            </div>
                            <div class="summary-card">
                                <i class="fas fa-clock"></i>
                                <h3 id="pendingTasks">0</h3>
                                <p>Pending Tasks</p>
                            </div>
                            <div class="summary-card">
                                <i class="fas fa-exclamation-triangle"></i>
                                <h3 id="overdueTasks">0</h3>
                                <p>Overdue Tasks</p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="taskChart"></canvas>
                        </div>
                    </div>
                    <div id="assign-task" class="tab-content">
                        <h2><i class="fas fa-plus-circle"></i>Assign New Task</h2>
                        <form id="taskForm">
                            <div class="form-group">
                                <label for="positionSelect">Position:</label>
                                <select id="positionSelect" required>
                                    <option value="">Select Position</option>
                                    <option value="Broadcaster">Broadcaster</option>
                                    <option value="Photojournalist">Photojournalist</option>
                                    <option value="Videographer">Videographer</option>
                                    <option value="Video Editor">Video Editor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="memberSelect">Member:</label>
                                <select id="memberSelect" required>
                                    <option value="">Select Member</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="taskInput">Task Description:</label>
                                <textarea id="taskInput" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="taskDate">Due Date:</label>
                                <input type="date" id="taskDate" required>
                            </div>
                            <div class="form-group">
                                <label for="taskLocation">Location:</label>
                                <input type="text" id="taskLocation">
                            </div>
                            <button type="submit" class="btn"><i class="fas fa-plus"></i>Assign Task</button>
                        </form>
                        <p id="errorMessage" class="error"></p>
                    </div>
                    <div id="task-list" class="tab-content">
                        <h2><i class="fas fa-list-ul"></i>Task List</h2>
                        <div class="sort-buttons">
                            <button class="btn" onclick="sortTasks('all')">All</button>
                            <button class="btn" onclick="sortTasks('pending')">Pending</button>
                            <button class="btn" onclick="sortTasks('completed')">Completed</button>
                            <button class="btn" onclick="sortTasks('overdue')">Overdue</button>
                        </div>
                        <div class="task-list" id="taskListContainer"></div>
                    </div>
                    <div id="calendar" class="tab-content">
                        <h2><i class="far fa-calendar-alt"></i>Calendar</h2>
                        <div class="calendar-header">
                            <h3 id="currentMonth"></h3>
                            <div class="calendar-nav">
                                <button id="prevMonth" class="btn"><i class="fas fa-chevron-left"></i></button>
                                <button id="nextMonth" class="btn"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <div id="calendarContainer" class="calendar"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <div class="chat-container" id="chatContainer" style="display: none;">
        <div class="chat-header">
            <span>Team Chat</span>
            <span class="chat-close" onclick="toggleChat()">&times;</span>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Type your message...">
            <button id="sendMessageBtn"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
    <button class="chat-toggle" id="chatToggle" onclick="toggleChat()">Open Chat</button>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDSe2c9-8xqShoHEW-D7BXXAyD5N9uXWEs",
            authDomain: "ang-silakbo.firebaseapp.com",
            databaseURL: "https://ang-silakbo-default-rtdb.firebaseio.com",
            projectId: "ang-silakbo",
            storageBucket: "ang-silakbo.firebasestorage.app",
            messagingSenderId: "1006400633782",
            appId: "1:1006400633782:web:ef4a93c1d445cb825b9f17",
            measurementId: "G-TSDTG2YJ94"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let taskChart = null;

        // Member data
        const members = {
            Broadcaster: [
                "Sylvania Kea Empenado", "Chandler Ken Castillano", "John Carmelo Ibasco",
                "Jazel Malinao", "Ashley Guibay", "Hanz Psyche Baritos", "Febrielle Jacla",
                "Aries Renz Bandalan", "Richelle Quilang", "Rhoda Amistad", "Vince Viñas",
                "Heaven Patricia Macol", "Cris Kervin Alfa", "Ron Asnahon", "Samantha Verdun",
                "Terrence Margaja", "Sharmagne Escobio", "Kharl Jones Almacin", "Rachel Althea T. Ochea",
                "Hesly Basco", "Joemelle Adriel Surilla", "Yaneca Marie Arong", "Jan Ivan Alolod",
                "Mishkha lujil Ordineza", "Ella Mae Nicole Camposo"
            ],
            Photojournalist: [
                "Mary Adellaine Pagador", "Precious Empress Sagarino", "Ruel Jericho Malon",
                "Christabelle Opiasa", "Claire Araneta", "Trisha Yvoe Angcay", "Matthew Taborada",
                "Khristylle Jade Alcos", "David Josh U. Jumalon", "Ian Danrev T. Castillo",
                "Jesry De Asis"
            ],
            Videographer: [
                "Philip Igot", "Karylle Abinuman", "Yezhia Boniel", "Eirene Jade Bardago",
                "DJ Dareal Sabas"
            ],
            "Video Editor": [
                "Marylle Marabiles", "Joem Cedrick Sungahid", "Jolisa Marie Yabillo"
            ]
        };

        // DOM Elements
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const loginSection = document.getElementById('loginSection');
        const mainContent = document.getElementById('mainContent');
        const logoutBtn = document.getElementById('logoutBtn');
        const positionSelect = document.getElementById('positionSelect');
        const memberSelect = document.getElementById('memberSelect');
        const taskForm = document.getElementById('taskForm');
        const errorMessage = document.getElementById('errorMessage');
        const taskListContainer = document.getElementById('taskListContainer');
        const calendarContainer = document.getElementById('calendarContainer');
        const currentMonthElement = document.getElementById('currentMonth');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const chatInput = document.getElementById('chatInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const chatMessages = document.getElementById('chatMessages');
        const chatContainer = document.getElementById('chatContainer');
        const chatToggle = document.getElementById('chatToggle');

        // Login functionality
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    loginSection.style.display = 'none';
                    mainContent.style.display = 'block';
                    chatToggle.style.display = 'block';
                    updateTaskList();
                    updateCalendar();
                    updateSummary();
                })
                .catch((error) => {
                    loginError.textContent = error.message;
                });
        });

        // Logout functionality
        logoutBtn.addEventListener('click', () => {
            auth.signOut().then(() => {
                loginSection.style.display = 'block';
                mainContent.style.display = 'none';
                chatContainer.style.display = 'none';
                chatToggle.style.display = 'none';
            }).catch((error) => {
                console.error('Logout Error:', error);
            });
        });

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                loginSection.style.display = 'none';
                mainContent.style.display = 'block';
                chatToggle.style.display = 'block';
                updateTaskList();
                updateCalendar();
                updateSummary();
            } else {
                loginSection.style.display = 'block';
                mainContent.style.display = 'none';
                chatContainer.style.display = 'none';
                chatToggle.style.display = 'none';
            }
        });

        // Populate member select based on position
        positionSelect.addEventListener('change', function() {
            const position = this.value;
            memberSelect.innerHTML = '<option value="">Select Member</option>';
            if (position) {
                members[position].forEach(member => {
                    const option = document.createElement('option');
                    option.value = member;
                    option.textContent = member;
                    memberSelect.appendChild(option);
                });
            }
        });

        // Assign task
        taskForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const position = positionSelect.value;
            const member = memberSelect.value;
            const task = document.getElementById('taskInput').value;
            const date = document.getElementById('taskDate').value;
            const location = document.getElementById('taskLocation').value;

            const memberRef = database.ref('members/' + member.replace(/\./g, ','));
            memberRef.once('value', snapshot => {
                const memberData = snapshot.val();
                if (memberData) {
                    const activeTasks = Object.values(memberData).filter(task => task.status !== 'Completed');
                    if (activeTasks.length >= 2) {
                        errorMessage.textContent = 'This member already has 2 active tasks assigned. Cannot assign more tasks.';
                    } else {
                        assignTask();
                    }
                } else {
                    assignTask();
                }
            });

            function assignTask() {
                const newTaskRef = memberRef.push();
                newTaskRef.set({
                    position: position,
                    task: task,
                    date: date,
                    location: location,
                    status: 'Pending',
                    log: [{
                        action: 'Task Assigned',
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    }]
                });
                alert('Task assigned successfully');
                taskForm.reset();
                errorMessage.textContent = '';
                updateTaskList();
                updateCalendar();
                updateSummary();
            }
        });

        // Update task list
        function updateTaskList(filter = 'all') {
            taskListContainer.innerHTML = '<p>Loading tasks...</p>';

            database.ref('members').once('value', snapshot => {
                const data = snapshot.val();
                taskListContainer.innerHTML = '';
                let totalTasks = 0;
                let completedTasks = 0;
                let pendingTasks = 0;
                let overdueTasks = 0;

                for (let member in data) {
                    const memberTasks = data[member];
                    const memberTasksElement = document.createElement('div');
                    memberTasksElement.className = 'member-tasks';
                    memberTasksElement.innerHTML = `<h3>${member.replace(/,/g, '.')}</h3>`;

                    for (let taskId in memberTasks) {
                        const task = memberTasks[taskId];
                
                        totalTasks++;
                        const status = getTaskStatus(task);
                        if (status === 'Completed') completedTasks++;
                        else if (status === 'Pending') pendingTasks++;
                        else if (status === 'Overdue') overdueTasks++;

                        if (filter !== 'all' && status.toLowerCase() !== filter) continue;

                        const taskElement = document.createElement('div');
                        taskElement.className = 'task-item';
                        taskElement.innerHTML = `
                            <div class="task-info">
                                <strong>${task.task}</strong>
                                <br>Due: ${task.date}, Location: ${task.location || 'Not specified'}
                            </div>
                            <div class="task-actions">
                                <span class="status ${status.toLowerCase()}">${status}</span>
                                <button class="btn" onclick="toggleTaskStatus('${member}', '${taskId}', '${status}')">
                                    ${status === 'Completed' ? 'Mark Pending' : 'Mark Complete'}
                                </button>
                                <button class="btn" onclick="editTask('${member}', '${taskId}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn" onclick="deleteTask('${member}', '${taskId}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        memberTasksElement.appendChild(taskElement);
                    }                    if (memberTasksElement.children.length > 1) {
                        taskListContainer.appendChild(memberTasksElement);
                    }
                }

                document.getElementById('totalTasks').textContent = totalTasks;
                document.getElementById('completedTasks').textContent = completedTasks;
                document.getElementById('pendingTasks').textContent = pendingTasks;
                document.getElementById('overdueTasks').textContent = overdueTasks;

                updateSummary();
            });
        }

        function getTaskStatus(task) {
            if (task.status === 'Completed') return 'Completed';
            const today = new Date();
            const dueDate = new Date(task.date);
            return dueDate < today ? 'Overdue' : 'Pending';
        }

        function toggleTaskStatus(member, taskId, currentStatus) {
            const newStatus = currentStatus === 'Completed' ? 'Pending' : 'Completed';
            const taskRef = database.ref(`members/${member}/${taskId}`);
            
            taskRef.once('value', snapshot => {
                const task = snapshot.val();
                const updatedLog = task.log || [];
                updatedLog.push({
                    action: `Status changed to ${newStatus}`,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                
                taskRef.update({
                    status: newStatus,
                    log: updatedLog
                });
            });
            
            updateTaskList();
            updateCalendar();
            updateSummary();
        }

        function editTask(member, taskId) {
            const taskRef = database.ref(`members/${member}/${taskId}`);
            taskRef.once('value', snapshot => {
                const task = snapshot.val();
                const newTask = prompt('Edit task:', task.task);
                if (newTask !== null && newTask.trim() !== '') {
                    const updatedLog = task.log || [];
                    updatedLog.push({
                        action: 'Task Edited',
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    taskRef.update({ 
                        task: newTask,
                        log: updatedLog
                    });
                    updateTaskList();
                    updateCalendar();
                    updateSummary();
                }
            });
        }

        function deleteTask(member, taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                database.ref(`members/${member}/${taskId}`).remove();
                updateTaskList();
                updateCalendar();
                updateSummary();
            }
        }

        // Calendar functions
        let currentDate = new Date();

        function updateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            currentMonthElement.textContent = new Date(year, month).toLocaleString('default', { month: 'long', year: 'numeric' });

            const calendar = generateCalendar(year, month);
            calendarContainer.innerHTML = calendar;

            database.ref('members').once('value', snapshot => {
                const data = snapshot.val();
                for (let member in data) {
                    for (let taskId in data[member]) {
                        const task = data[member][taskId];
                        const taskDate = new Date(task.date);
                        if (taskDate.getMonth() === month && taskDate.getFullYear() === year) {
                            const day = taskDate.getDate();
                            const cell = document.querySelector(`.calendar-day[data-date="${day}"]`);
                            if (cell) {
                                cell.classList.add('has-task');
                                cell.addEventListener('click', () => showTaskDetails(member, taskId, task));
                            }
                        }
                    }
                }
            });
        }

        function generateCalendar(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();

            let calendarHTML = '';
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            // Add day names
            for (let i = 0; i < 7; i++) {
                calendarHTML += `<div class="calendar-day"><span class="day-name">${dayNames[i]}</span></div>`;
            }

            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                calendarHTML += '<div class="calendar-day"></div>';
            }

            // Add days of the month
            for (let i = 1; i <= daysInMonth; i++) {
                const date = new Date(year, month, i);
                const isToday = date.toDateString() === new Date().toDateString();
                calendarHTML += `
                    <div class="calendar-day ${isToday ? 'today' : ''}" data-date="${i}">
                        <span class="day-number">${i}</span>
                    </div>
                `;
            }

            return calendarHTML;
        }

        function showTaskDetails(member, taskId, task) {
            alert(`
                Member: ${member.replace(/,/g, '.')}
                Task: ${task.task}
                Due Date: ${task.date}
                Location: ${task.location || 'Not specified'}
                Status: ${getTaskStatus(task)}
            `);
        }

        // Calendar navigation
        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateCalendar();
        });

        // Team Chat functionality
        function addMessage(sender, message) {
            const messageElement = document.createElement('div');
            const isCurrentUser = sender === (auth.currentUser.email === "angsilakbo1@uclm.com" ? "Ron Asnahon" : "Jesry De Asis");
            messageElement.className = 'message ' + (isCurrentUser ? 'sent' : 'received');
            messageElement.innerHTML = `
                <div class="message-content">${message}</div>
                <div class="message-info">${sender} - ${new Date().toLocaleTimeString()}</div>
            `;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        sendMessageBtn.addEventListener('click', () => {
            const message = chatInput.value.trim();
            if (message && auth.currentUser) {
                const sender = auth.currentUser.email === "angsilakbo1@uclm.com" ? "Ron Asnahon" : "Jesry De Asis";
                database.ref('chat').push({
                    sender: sender,
                    message: message,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                chatInput.value = '';
            }
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessageBtn.click();
            }
        });

        database.ref('chat').on('child_added', (snapshot) => {
            const message = snapshot.val();
            addMessage(message.sender, message.message);
        });

        // Sorting functionality
        function sortTasks(filter) {
            updateTaskList(filter);
        }

        // Tab functionality
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            const navItems = document.querySelectorAll('.nav-menu a');
            navItems.forEach(item => item.classList.remove('active'));
            document.querySelector(`.nav-menu a[href="#${tabId}"]`).classList.add('active');
        }

        // Chat toggle functionality
        function toggleChat() {
            const chatContainer = document.getElementById('chatContainer');
            const chatToggle = document.getElementById('chatToggle');
            if (chatContainer.style.display === 'none') {
                chatContainer.style.display = 'flex';
                chatToggle.textContent = 'Close Chat';
            } else {
                chatContainer.style.display = 'none';
                chatToggle.textContent = 'Open Chat';
            }
        }

        // Update summary
        function updateSummary() {
            const ctx = document.getElementById('taskChart').getContext('2d');
            const totalTasks = parseInt(document.getElementById('totalTasks').textContent);
            const completedTasks = parseInt(document.getElementById('completedTasks').textContent);
            const pendingTasks = parseInt(document.getElementById('pendingTasks').textContent);
            const overdueTasks = parseInt(document.getElementById('overdueTasks').textContent);

            // Destroy the existing chart if it exists
            if (taskChart) {
                taskChart.destroy();
            }

            // Create a new chart
            taskChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Pending', 'Overdue'],
                    datasets: [{
                        data: [completedTasks, pendingTasks, overdueTasks],
                        backgroundColor: [
                            'rgba(46, 204, 64, 0.8)',
                            'rgba(255, 220, 0, 0.8)',
                            'rgba(255, 65, 54, 0.8)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 64, 1)',
                            'rgba(255, 220, 0, 1)',
                            'rgba(255, 65, 54, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        position: 'bottom'
                    },
                    title: {
                        display: true,
                        text: 'Task Distribution'
                    }
                }
            });
        }

        // Initialize
        updateTaskList();
        updateCalendar();
        updateSummary();
    </script>
</body>
</html>

