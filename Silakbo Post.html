<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANG SILAKBO - Workstation</title>
    <link rel="icon" href="SILAKBO.png">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- TinyMCE -->
    <script src="https://cdn.tiny.cloud/1/n92j01vjprp9xy96v0uxd2kgqi5vnd50dwm5i47veg2u1bur/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: #e65100;
            --primary-dark: #bf360c;
            --primary-light: #ff9800;
            --primary-ultra-light: #fff3e0;
            --secondary: #f8fafc;
            --text-dark: #1a202c;
            --text-medium: #2d3748;
            --text-light: #4a5568;
            --text-muted: #718096;
            --white: #ffffff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            
            /* AI Nexora Colors */
            --nexora-purple: #8b5cf6;
            --nexora-blue: #3b82f6;
            --nexora-pink: #ec4899;
            --nexora-gradient: linear-gradient(135deg, var(--nexora-purple) 0%, var(--nexora-blue) 50%, var(--nexora-pink) 100%);
            --nexora-light: rgba(139, 92, 246, 0.1);
            --nexora-medium: rgba(139, 92, 246, 0.2);
            
            /* Sidebar */
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 80px;
            
            /* Circular border radius values */
            --radius-sm: 16px;
            --radius-md: 20px;
            --radius-lg: 24px;
            --radius-xl: 28px;
            --radius-2xl: 32px;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* Transitions */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-50);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            line-height: 1.6;
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            line-height: 1.3;
        }

        .font-merriweather {
            font-family: 'Merriweather', serif;
        }

        .font-poppins {
            font-family: 'Poppins', sans-serif;
        }

        /* Material Icons */
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }

        .material-icons.md-16 { font-size: 16px; }
        .material-icons.md-18 { font-size: 18px; }
        .material-icons.md-20 { font-size: 20px; }
        .material-icons.md-24 { font-size: 24px; }
        .material-icons.md-36 { font-size: 36px; }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--white);
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 1000;
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 1rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            border-radius: 0 var(--radius-lg) 0 0;
        }

        .sidebar-header img {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            flex-shrink: 0;
        }

        .sidebar-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.125rem;
            font-weight: 700;
            white-space: nowrap;
            opacity: 1;
            transition: var(--transition);
        }

        .sidebar.collapsed .sidebar-title {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-full);
            transition: var(--transition-fast);
            margin-left: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-nav {
            flex: 1;
            padding: 1.5rem 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0 1.5rem;
            margin-bottom: 0.75rem;
            opacity: 1;
            transition: var(--transition);
        }

        .sidebar.collapsed .nav-section-title {
            opacity: 0;
            height: 0;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem 1.5rem;
            color: var(--text-medium);
            text-decoration: none;
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition-fast);
            border-radius: 0 var(--radius-full) var(--radius-full) 0;
            position: relative;
            cursor: pointer;
            margin-right: 1rem;
        }

        .nav-link:hover {
            background: var(--gray-50);
            color: var(--primary);
        }

        .nav-link.active {
            background: var(--primary-ultra-light);
            color: var(--primary);
            border-right: 3px solid var(--primary);
        }

        .nav-link .material-icons {
            font-size: 20px;
            flex-shrink: 0;
        }

        .nav-link-text {
            white-space: nowrap;
            opacity: 1;
            transition: var(--transition);
        }

        .sidebar.collapsed .nav-link-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .sidebar.collapsed .nav-link {
            padding: 0.875rem;
            justify-content: center;
            margin-right: 0;
            border-radius: var(--radius-full);
        }

        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
            background: var(--gray-50);
            border-radius: 0 0 var(--radius-lg) 0;
        }

        .sidebar-footer-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            opacity: 1;
            transition: var(--transition);
        }

        .sidebar.collapsed .sidebar-footer-content {
            opacity: 0;
            height: 0;
            padding: 0;
            overflow: hidden;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            flex-shrink: 0;
        }

        .status-text {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .sidebar.collapsed + .main-content {
            margin-left: var(--sidebar-collapsed-width);
        }

        .main-header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-sm);
        }

        .main-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Nexora AI Header Section */
        .nexora-header-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1.25rem;
            background: var(--nexora-gradient);
            border-radius: var(--radius-full);
            color: var(--white);
            box-shadow: var(--shadow-md);
            position: relative;
            transition: var(--transition);
        }

        /* Nexora Aura Glow Effect */
        .nexora-header-section.aura-glow {
            animation: nexoraAura 2s ease-in-out infinite;
        }

        @keyframes nexoraAura {
            0%, 100% {
                box-shadow: 
                    var(--shadow-md),
                    0 0 20px rgba(139, 92, 246, 0.4),
                    0 0 40px rgba(59, 130, 246, 0.3),
                    0 0 60px rgba(236, 72, 153, 0.2);
            }
            50% {
                box-shadow: 
                    var(--shadow-md),
                    0 0 30px rgba(139, 92, 246, 0.6),
                    0 0 60px rgba(59, 130, 246, 0.5),
                    0 0 90px rgba(236, 72, 153, 0.4);
            }
        }

        .nexora-logo {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-full);
            flex-shrink: 0;
        }

        .nexora-info {
            display: flex;
            flex-direction: column;
            gap: 0.125rem;
        }

        .nexora-title {
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            line-height: 1;
        }

        .nexora-subtitle {
            font-size: 0.75rem;
            opacity: 0.9;
            line-height: 1;
        }

        .nexora-actions {
            display: flex;
            gap: 0.5rem;
        }

        .nexora-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--white);
            padding: 0.5rem;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }

        .nexora-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .nexora-btn .material-icons {
            font-size: 16px;
        }

        .main-body {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .content-card {
            background: var(--white);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-lg);
            padding: 2.5rem;
            position: relative;
            overflow: hidden;
        }

        .content-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        label {
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.75rem;
            display: block;
        }

        .input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-icon {
            position: absolute;
            left: 1rem;
            color: var(--text-muted);
            z-index: 2;
            pointer-events: none;
        }

        .input-icon.md-18 {
            font-size: 18px;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 1rem 1.25rem 1rem 3rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 0.875rem;
            transition: var(--transition);
            background: var(--white);
        }

        select {
            padding-left: 3rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 1rem center;
            background-repeat: no-repeat;
            background-size: 1rem;
        }

        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(230, 81, 0, 0.1);
            transform: translateY(-1px);
        }

        input[type="text"]:hover,
        select:hover {
            border-color: var(--gray-300);
        }

        /* Grammar Check */
        .grammar-check-container {
            position: relative;
        }

        .grammar-check-btn {
            position: absolute;
            top: 50%;
            right: 0.75rem;
            transform: translateY(-50%);
            background: var(--nexora-gradient);
            border: none;
            color: var(--white);
            padding: 0.5rem;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            width: 32px;
            height: 32px;
        }

        .grammar-check-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .grammar-check-btn .material-icons {
            font-size: 16px;
        }

        /* File Input */
        .file-input-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .file-input-label {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            border-radius: var(--radius-full);
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        input[type="file"] {
            display: none;
        }

        .file-name {
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 0.875rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .image-preview-container {
            margin-top: 1rem;
            max-width: 300px;
        }

        #imagePreview, #editImagePreview {
            max-width: 100%;
            border-radius: var(--radius-xl);
            display: none;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-xl);
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            white-space: nowrap;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--text-medium);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
            color: var(--text-dark);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error) 0%, #dc2626 100%);
            color: var(--white);
            box-shadow: var(--shadow-sm);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-nexora {
            background: var(--nexora-gradient);
            color: var(--white);
            box-shadow: var(--shadow-sm);
        }

        .btn-nexora:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: var(--gray-100);
            cursor: pointer;
            transition: var(--transition);
            padding: 0;
        }

        .btn-icon:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-view { color: var(--success); }
        .btn-view:hover { background: var(--success); color: var(--white); }

        .btn-edit { color: var(--info); }
        .btn-edit:hover { background: var(--info); color: var(--white); }

        .btn-delete { color: var(--error); }
        .btn-delete:hover { background: var(--error); color: var(--white); }

        /* Table Styles */
        .table-container {
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            margin-top: 1rem;
        }

        .posts-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--white);
        }

        .posts-table th,
        .posts-table td {
            padding: 1.25rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.875rem;
        }

        .posts-table th {
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: var(--text-dark);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .posts-table td {
            font-family: 'Source Sans Pro', sans-serif;
            color: var(--text-medium);
        }

        .posts-table tr:hover {
            background: var(--primary-ultra-light);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        /* Alerts */
        .alert {
            padding: 1rem 1.25rem;
            border-radius: var(--radius-xl);
            display: none;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: var(--shadow-md);
            animation: slideInDown 0.3s ease-out;
        }

        .alert-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: var(--white);
        }

        .alert-error {
            background: linear-gradient(135deg, var(--error) 0%, #dc2626 100%);
            color: var(--white);
        }

        .alert-close {
            margin-left: auto;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--white);
            opacity: 0.8;
            transition: var(--transition-fast);
            border-radius: var(--radius-full);
            padding: 0.25rem;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(4px);
            padding: 1rem;
        }

        .modal {
            background: var(--white);
            border-radius: var(--radius-2xl);
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            opacity: 0;
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 100%);
            border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
        }

        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--gray-100);
            color: var(--text-dark);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            background: var(--gray-50);
            border-radius: 0 0 var(--radius-2xl) var(--radius-2xl);
        }

        /* Draft Modal */
        .draft-modal .modal {
            max-width: 500px;
        }

        .draft-modal .modal-header {
            background: var(--primary-ultra-light);
            color: var(--text-dark);
        }

        .draft-info {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
        }

        .draft-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .draft-info-label {
            font-weight: 600;
            color: var(--text-medium);
        }

        .draft-info-value {
            color: var(--text-muted);
        }

        /* Nexora Chat Modal */
        .nexora-modal .modal {
            max-width: 800px;
            height: 600px;
            max-height: 80vh;
        }

        .nexora-modal .modal-header {
            background: var(--nexora-gradient);
            color: var(--white);
        }

        .nexora-modal .modal-close {
            color: var(--white);
        }

        .nexora-modal .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nexora-chat-container {
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .nexora-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            margin-bottom: 1rem;
        }

        .nexora-message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.75rem;
        }

        .nexora-message.user {
            flex-direction: row-reverse;
        }

        .nexora-message-avatar {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--white);
        }

        .nexora-message.user .nexora-message-avatar {
            background: var(--primary);
        }

        .nexora-message.assistant .nexora-message-avatar {
            background: var(--nexora-gradient);
        }

        .nexora-message-content {
            background: var(--white);
            padding: 0.75rem 1rem;
            border-radius: var(--radius-lg);
            max-width: 70%;
            box-shadow: var(--shadow-sm);
        }

        .nexora-message.user .nexora-message-content {
            background: var(--primary-ultra-light);
        }

        .nexora-input-container {
            display: flex;
            gap: 0.75rem;
        }

        .nexora-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .nexora-input:focus {
            outline: none;
            border-color: var(--nexora-purple);
            box-shadow: 0 0 0 4px var(--nexora-light);
        }

        .nexora-send-btn {
            background: var(--nexora-gradient);
            border: none;
            color: var(--white);
            padding: 0.75rem;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nexora-send-btn:hover {
            transform: scale(1.05);
        }

        /* Loading States */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state .material-icons {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gray-400);
        }

        .empty-state p {
            font-family: 'Merriweather', serif;
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        /* TinyMCE Customization */
        .tox-tinymce {
            border: 2px solid var(--gray-200) !important;
            border-radius: var(--radius-xl) !important;
            transition: var(--transition) !important;
        }

        .tox-tinymce:focus-within {
            border-color: var(--primary) !important;
            box-shadow: 0 0 0 4px rgba(230, 81, 0, 0.1) !important;
        }

        .tox .tox-toolbar__primary {
            background: var(--gray-50) !important;
            border-bottom: 1px solid var(--gray-200) !important;
        }

        .tox .tox-tbtn {
            border-radius: var(--radius-sm) !important;
        }

        .tox .tox-tbtn:hover {
            background: var(--primary-ultra-light) !important;
        }

        /* Word Count */
        .word-count {
            font-size: 0.75rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Grammar suggestions */
        .grammar-suggestion {
            background: var(--nexora-light);
            border: 1px solid var(--nexora-purple);
            border-radius: var(--radius-lg);
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }

        .grammar-suggestion.active {
            display: block;
            animation: fadeInUp 0.3s ease-out;
        }

        .grammar-suggestion-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            color: var(--nexora-purple);
            font-weight: 600;
        }

        .grammar-suggestion-content {
            font-size: 0.875rem;
            color: var(--text-medium);
            line-height: 1.5;
        }

        .grammar-suggestion-actions {
            margin-top: 0.75rem;
            display: flex;
            gap: 0.5rem;
        }

        .grammar-suggestion-btn {
            padding: 0.375rem 0.75rem;
            border: none;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .grammar-suggestion-btn.accept {
            background: var(--nexora-purple);
            color: var(--white);
        }

        .grammar-suggestion-btn.dismiss {
            background: var(--gray-200);
            color: var(--text-medium);
        }

        .grammar-suggestion-btn:hover {
            transform: translateY(-1px);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .sidebar.collapsed + .main-content {
                margin-left: 0;
            }

            .mobile-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                display: none;
            }

            .mobile-overlay.active {
                display: block;
            }

            .main-header {
                padding: 1rem;
            }

            .main-body {
                padding: 1rem;
            }

            .content-card {
                padding: 1.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .nexora-header-section {
                flex-direction: column;
                gap: 0.5rem;
                padding: 0.75rem;
            }

            .nexora-info {
                text-align: center;
            }
        }

        @media (max-width: 768px) {
            .main-header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: flex-start;
                flex-wrap: wrap;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .modal {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
            }

            .posts-table th,
            .posts-table td {
                padding: 0.75rem 0.5rem;
                font-size: 0.8rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .nexora-chat-container {
                height: 300px;
            }

            .nexora-header-section {
                padding: 0.5rem;
            }

            .nexora-title {
                font-size: 0.75rem;
            }

            .nexora-subtitle {
                font-size: 0.625rem;
            }
        }

        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-dark);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-full);
            transition: var(--transition-fast);
        }

        .mobile-menu-btn:hover {
            background: var(--gray-100);
        }

        @media (max-width: 1024px) {
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* Badge styles */
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-article {
            background: var(--primary-ultra-light);
            color: var(--primary-dark);
        }

        .badge-literary {
            background: #e0f2fe;
            color: #0277bd;
        }

        /* Post view styles */
        .post-view {
            font-family: 'Merriweather', serif;
            line-height: 1.8;
        }

        .post-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--gray-200);
        }

        .post-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .meta-item .material-icons {
            color: var(--primary);
            font-size: 18px;
        }

        .post-content {
            font-size: 1rem;
            line-height: 1.8;
        }

        .post-content h1,
        .post-content h2,
        .post-content h3,
        .post-content h4,
        .post-content h5,
        .post-content h6 {
            font-family: 'Playfair Display', serif;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .post-content p {
            margin-bottom: 1.5rem;
        }

        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius-lg);
            margin: 1.5rem 0;
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus styles */
        .nav-link:focus,
        .btn:focus,
        .btn-icon:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="SILAKBO.png" alt="Silakbo Logo">
            <span class="sidebar-title">ANG SILAKBO</span>
            <button class="sidebar-toggle" id="sidebarToggle">
                <span class="material-icons">menu</span>
            </button>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Content</div>
                <div class="nav-item">
                    <a href="#" class="nav-link active" data-tab="create">
                        <span class="material-icons">add_circle</span>
                        <span class="nav-link-text">New Post</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-tab="manage">
                        <span class="material-icons">list_alt</span>
                        <span class="nav-link-text">Manage Posts</span>
                    </a>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Tools</div>
                <div class="nav-item">
                    <a href="#" class="nav-link" id="refreshPostsNav">
                        <span class="material-icons">refresh</span>
                        <span class="nav-link-text">Refresh</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" id="clearFormNav">
                        <span class="material-icons">clear_all</span>
                        <span class="nav-link-text">Reset Form</span>
                    </a>
                </div>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="sidebar-footer-content">
                <div class="status-indicator"></div>
                <div class="status-text" id="sidebarStatus">Ready</div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="main-header">
            <div class="main-header-content">
                <div class="header-left">
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <span class="material-icons">menu</span>
                    </button>
                    <h1 class="page-title" id="pageTitle">New Piece</h1>
                </div>
                <div class="header-actions" id="headerActions">
                    <!-- Nexora AI Section -->
                    <div class="nexora-header-section" id="nexoraHeaderSection">
                        <img src="Nexora.png" alt="Nexora AI" class="nexora-logo">
                        <div class="nexora-info">
                            <div class="nexora-title">Nexora AI</div>
                            <div class="nexora-subtitle">Writing Assistant</div>
                        </div>
                        <div class="nexora-actions">
                            <button class="nexora-btn" id="openNexoraChat" title="Chat with Nexora">
                                <span class="material-icons">chat</span>
                            </button>
                            <button class="nexora-btn" id="checkGrammar" title="Check Grammar">
                                <span class="material-icons">spellcheck</span>
                            </button>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="submitBtn">
                        <span class="material-icons md-18">send</span> Publish
                    </button>
                    <div class="word-count">
                        <span class="material-icons md-18">description</span> Words: <span id="wordCount">0</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Body -->
        <div class="main-body">
            <div class="content-card">
                <!-- Success Alert -->
                <div class="alert alert-success" id="alertSuccess">
                    <span class="material-icons">check_circle</span>
                    <span>Success!</span>
                    <button class="alert-close" aria-label="Close alert">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                
                <!-- Error Alert -->
                <div class="alert alert-error" id="alertError">
                    <span class="material-icons">error</span>
                    <span id="errorMessage">Error occurred.</span>
                    <button class="alert-close" aria-label="Close alert">
                        <span class="material-icons">close</span>
                    </button>
                </div>

                <!-- Create Post Tab -->
                <div class="tab-content active" id="createTab">
                    <form id="postForm">
                        <div class="form-group">
                            <label for="title">Post Title</label>
                            <div class="grammar-check-container">
                                <div class="input-container">
                                    <span class="material-icons input-icon md-18">title</span>
                                    <input type="text" id="title" required placeholder="Enter an engaging title for your post">
                                </div>
                                <button type="button" class="grammar-check-btn" data-field="title" title="Check grammar">
                                    <span class="material-icons">spellcheck</span>
                                </button>
                            </div>
                            <div class="grammar-suggestion" id="titleSuggestion"></div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="category">Category</label>
                                <div class="input-container">
                                    <span class="material-icons input-icon md-18">folder</span>
                                    <select id="category" required>
                                        <option value="">Select a category</option>
                                        <option value="article">Article</option>
                                        <option value="literary">Literary</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="role">Role of the Contributor</label>
                                <div class="input-container">
                                    <span class="material-icons input-icon md-18">work</span>
                                    <select id="role" required>
                                        <option value="">Select a role</option>
                                        <option value="Photojournalist">Photojournalist</option>
                                        <option value="Cartoonist">Cartoonist</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="author">Author</label>
                                <div class="grammar-check-container">
                                    <div class="input-container">
                                        <span class="material-icons input-icon md-18">person</span>
                                        <input type="text" id="author" required placeholder="Enter the author's full name">
                                    </div>
                                    <button type="button" class="grammar-check-btn" data-field="author" title="Check grammar">
                                        <span class="material-icons">spellcheck</span>
                                    </button>
                                </div>
                                <div class="grammar-suggestion" id="authorSuggestion"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="additionalField">Contributors Name</label>
                                <div class="grammar-check-container">
                                    <div class="input-container">
                                        <span class="material-icons input-icon md-18">badge</span>
                                        <input type="text" id="additionalField" placeholder="Enter the person's name for the selected role">
                                    </div>
                                    <button type="button" class="grammar-check-btn" data-field="additionalField" title="Check grammar">
                                        <span class="material-icons">spellcheck</span>
                                    </button>
                                </div>
                                <div class="grammar-suggestion" id="additionalFieldSuggestion"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="imageUpload">Featured Image</label>
                            <div class="file-input-container">
                                <label class="file-input-label">
                                    <span class="material-icons md-18">cloud_upload</span> Choose Image
                                    <input type="file" id="imageUpload" accept="image/*">
                                </label>
                                <span class="file-name" id="fileName">
                                    <span class="material-icons md-18">image</span> No image selected
                                </span>
                            </div>
                            <div class="image-preview-container">
                                <img id="imagePreview" alt="Image Preview">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="content">Content</label>
                            <textarea id="content"></textarea>
                            <div class="grammar-suggestion" id="contentSuggestion"></div>
                        </div>
                    </form>
                </div>

                <!-- Manage Posts Tab -->
                <div class="tab-content" id="manageTab">
                    <div id="postsTableContainer">
                        <div id="loadingPosts" class="loading-container">
                            <div class="loading-spinner"></div>
                            <p class="font-merriweather">Loading your posts...</p>
                        </div>
                        
                        <div class="table-container" id="postsTable" style="display: none;">
                            <table class="posts-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Category</th>
                                        <th>Author</th>
                                        <th>Role</th>
                                        <th>Role Person</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="postsTableBody"></tbody>
                            </table>
                        </div>
                        
                        <div id="noPostsMessage" class="empty-state" style="display: none;">
                            <span class="material-icons">newspaper</span>
                            <p class="font-merriweather">No posts found. Start creating your first post!</p>
                            <button class="btn btn-primary" id="createFirstPostBtn">
                                <span class="material-icons md-18">add_circle</span> Create Your First Post
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Draft Modal -->
    <div class="modal-overlay draft-modal" id="draftModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span class="material-icons" style="margin-right: 0.5rem;">draft</span>
                    Draft Found
                </h3>
                <button class="modal-close" id="closeDraftModal" aria-label="Close modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="font-merriweather" style="margin-bottom: 1.5rem;">
                    We found a saved draft from your previous session. Would you like to restore it?
                </p>
                
                <div class="draft-info" id="draftInfo">
                    <!-- Draft information will be populated here -->
                </div>
                
                <p style="font-size: 0.875rem; color: var(--text-muted);">
                    <span class="material-icons md-16" style="vertical-align: middle; margin-right: 0.25rem;">info</span>
                    Drafts are automatically saved and expire after 24 hours.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="discardDraftBtn">
                    <span class="material-icons md-18">delete</span> Discard Draft
                </button>
                <button class="btn btn-primary" id="restoreDraftBtn">
                    <span class="material-icons md-18">restore</span> Restore Draft
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Post</h3>
                <button class="modal-close" id="closeEditModal" aria-label="Close modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <input type="hidden" id="editPostId">
                    
                    <div class="form-group">
                        <label for="editTitle">Post Title</label>
                        <div class="input-container">
                            <span class="material-icons input-icon md-18">title</span>
                            <input type="text" id="editTitle" required placeholder="Enter post title">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCategory">Category</label>
                            <div class="input-container">
                                <span class="material-icons input-icon md-18">folder</span>
                                <select id="editCategory" required>
                                    <option value="article">Article</option>
                                    <option value="literary">Literary</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="editRole">Role</label>
                            <div class="input-container">
                                <span class="material-icons input-icon md-18">work</span>
                                <select id="editRole" required>
                                    <option value="Photojournalist">Photojournalist</option>
                                    <option value="Cartoonist">Cartoonist</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editAuthor">Author</label>
                            <div class="input-container">
                                <span class="material-icons input-icon md-18">person</span>
                                <input type="text" id="editAuthor" required placeholder="Enter author's name">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="editAdditionalField">Role Person</label>
                            <div class="input-container">
                                <span class="material-icons input-icon md-18">badge</span>
                                <input type="text" id="editAdditionalField" placeholder="Enter the person's name for the selected role">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editImageUpload">Featured Image</label>
                        <div class="file-input-container">
                            <label class="file-input-label">
                                <span class="material-icons md-18">cloud_upload</span> Choose Image
                                <input type="file" id="editImageUpload" accept="image/*">
                            </label>
                            <span class="file-name" id="editFileName">
                                <span class="material-icons md-18">image</span> No image selected
                            </span>
                        </div>
                        <div class="image-preview-container">
                            <img id="editImagePreview" alt="Image Preview">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editContent">Content</label>
                        <textarea id="editContent"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditBtn">
                    <span class="material-icons md-18">close</span> Cancel
                </button>
                <button class="btn btn-primary" id="saveEditBtn">
                    <span class="material-icons md-18">save</span> Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Delete Post</h3>
                <button class="modal-close" id="closeDeleteModal" aria-label="Close modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="font-merriweather">Are you sure you want to delete this post? This action cannot be undone.</p>
                <input type="hidden" id="deletePostId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteBtn">
                    <span class="material-icons md-18">close</span> Cancel
                </button>
                <button class="btn btn-danger" id="confirmDeleteBtn">
                    <span class="material-icons md-18">delete</span> Delete Post
                </button>
            </div>
        </div>
    </div>

    <!-- View Modal -->
    <div class="modal-overlay" id="viewModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">View Post</h3>
                <button class="modal-close" id="closeViewModal" aria-label="Close modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="viewPostContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeViewBtn">
                    <span class="material-icons md-18">close</span> Close
                </button>
                <button class="btn btn-primary" id="editFromViewBtn">
                    <span class="material-icons md-18">edit</span> Edit Post
                </button>
            </div>
        </div>
    </div>

    <!-- Nexora Chat Modal -->
    <div class="modal-overlay nexora-modal" id="nexoraModal">
        <div class="modal">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <img src="Nexora.png" alt="Nexora AI" style="width: 24px; height: 24px; border-radius: 50%;">
                    <h3 class="modal-title">Nexora AI Assistant</h3>
                </div>
                <button class="modal-close" id="closeNexoraModal" aria-label="Close modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="nexora-chat-container">
                    <div class="nexora-messages" id="nexoraMessages">
                        <div class="nexora-message assistant">
                            <div class="nexora-message-avatar">
                                <span class="material-icons">smart_toy</span>
                            </div>
                            <div class="nexora-message-content">
                                <p>Hello! I'm Nexora, your AI writing assistant. I can help you with grammar corrections, content suggestions, and answer any questions about your writing. How can I assist you today?</p>
                            </div>
                        </div>
                    </div>
                    <div class="nexora-input-container">
                        <input type="text" class="nexora-input" id="nexoraInput" placeholder="Ask Nexora anything...">
                        <button class="nexora-send-btn" id="nexoraSendBtn">
                            <span class="material-icons">send</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = "https://uyxgsziyflquisckdwwc.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5eGdzeml5ZmxxdWlzY2tkd3djIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE1OTQyODUsImV4cCI6MjA1NzE3MDI4NX0.DoIEoWWuajDpBhD2UwLYzrKRyZNyBP4izasROCdIbkk";
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Cohere API configuration
        const COHERE_API_KEY = "z99HUO9u2vu9E4YTRRfeue6hbdkdOcM8zWQDfbcq";
        const COHERE_API_URL = "https://api.cohere.ai/v1/generate";

        // Global state
        let currentTab = 'create';
        let sidebarCollapsed = false;
        let draftData = null;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTinyMCE();
            initializeEventListeners();
            loadPosts();
            updateStatus('Ready');
            
            // Initialize Nexora aura glow for 5 seconds
            initializeNexoraAura();
        });

        // Initialize Nexora aura effect
        function initializeNexoraAura() {
            const nexoraSection = document.getElementById('nexoraHeaderSection');
            nexoraSection.classList.add('aura-glow');
            
            // Remove aura after 5 seconds
            setTimeout(() => {
                nexoraSection.classList.remove('aura-glow');
            }, 5000);
        }

        // Toggle Nexora aura effect
        function toggleNexoraAura() {
            const nexoraSection = document.getElementById('nexoraHeaderSection');
            nexoraSection.classList.toggle('aura-glow');
        }

        // Initialize TinyMCE with basic features only
        function initializeTinyMCE() {
            tinymce.init({
                selector: '#content, #editContent',
                plugins: 'autolink lists link image charmap searchreplace visualblocks code fullscreen media table wordcount',
                toolbar: 'undo redo | formatselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | code fullscreen',
                height: 400,
                menubar: false,
                statusbar: true,
                branding: false,
                promotion: false,
                content_css: 'default',
                font_family_formats: 'Merriweather=Merriweather,serif; Playfair Display=Playfair Display,serif; Poppins=Poppins,sans-serif; Source Sans Pro=Source Sans Pro,sans-serif; Arial=arial,helvetica,sans-serif; Times New Roman=times new roman,times,serif; Courier New=courier new,courier,monospace',
                setup: function(editor) {
                    editor.on('keyup change', function() {
                        updateWordCount(editor);
                    });
                    
                    editor.on('init', function() {
                        updateWordCount(editor);
                    });
                }
            });
        }

        // Update word count
        function updateWordCount(editor) {
            const content = editor.getContent({ format: 'text' });
            const wordCount = content.trim().split(/\s+/).filter(word => word.length > 0).length;
            document.getElementById('wordCount').textContent = wordCount || 0;
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Sidebar navigation
            document.querySelectorAll('.nav-link[data-tab]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchTab(link.getAttribute('data-tab'));
                });
            });

            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileSidebar);
            document.getElementById('mobileOverlay').addEventListener('click', closeMobileSidebar);

            // Navigation actions
            document.getElementById('refreshPostsNav').addEventListener('click', (e) => {
                e.preventDefault();
                loadPosts();
                updateStatus('Posts refreshed');
            });

            document.getElementById('clearFormNav').addEventListener('click', (e) => {
                e.preventDefault();
                clearForm();
            });

            // Nexora AI actions
            document.getElementById('openNexoraChat').addEventListener('click', () => {
                toggleNexoraAura();
                openModal('nexoraModal');
            });
            document.getElementById('checkGrammar').addEventListener('click', () => {
                toggleNexoraAura();
                checkAllGrammar();
            });
            document.getElementById('nexoraSendBtn').addEventListener('click', sendNexoraMessage);
            document.getElementById('nexoraInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendNexoraMessage();
            });

            // Grammar check buttons
            document.querySelectorAll('.grammar-check-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const field = btn.getAttribute('data-field');
                    checkGrammar(field);
                });
            });

            // Image upload handlers
            document.getElementById('imageUpload').addEventListener('change', (e) => handleImageUpload(e, 'imagePreview', 'fileName'));
            document.getElementById('editImageUpload').addEventListener('change', (e) => handleImageUpload(e, 'editImagePreview', 'editFileName'));

            // Form and button handlers
            document.getElementById('submitBtn').addEventListener('click', handleSubmit);
            document.getElementById('createFirstPostBtn').addEventListener('click', () => switchTab('create'));

            // Draft modal handlers
            document.getElementById('restoreDraftBtn').addEventListener('click', restoreDraft);
            document.getElementById('discardDraftBtn').addEventListener('click', discardDraft);
            document.getElementById('closeDraftModal').addEventListener('click', () => closeModal('draftModal'));

            // Modal handlers
            document.getElementById('saveEditBtn').addEventListener('click', handleEditSave);
            document.getElementById('confirmDeleteBtn').addEventListener('click', handleDelete);
            document.getElementById('editFromViewBtn').addEventListener('click', function() {
                const postId = this.getAttribute('data-id');
                closeModal('viewModal');
                openEditModal(postId);
            });

            // Modal close handlers
            ['closeEditModal', 'cancelEditBtn', 'closeDeleteModal', 'cancelDeleteBtn', 'closeViewModal', 'closeViewBtn', 'closeNexoraModal'].forEach(id => {
                document.getElementById(id).addEventListener('click', () => {
                    const modalId = id.includes('Edit') ? 'editModal' : 
                                   id.includes('Delete') ? 'deleteModal' : 
                                   id.includes('Nexora') ? 'nexoraModal' : 'viewModal';
                    closeModal(modalId);
                });
            });

            // Alert close handlers
            document.querySelectorAll('.alert-close').forEach(button => {
                button.addEventListener('click', function() {
                    this.parentElement.style.display = 'none';
                });
            });

            // Click outside modal to close
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }

        // Cohere API functions
        async function callCohereAPI(prompt, maxTokens = 100) {
            try {
                const response = await fetch(COHERE_API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${COHERE_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'command',
                        prompt: prompt,
                        max_tokens: maxTokens,
                        temperature: 0.3,
                        k: 0,
                        stop_sequences: [],
                        return_likelihoods: 'NONE'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.generations[0].text.trim();
            } catch (error) {
                console.error('Cohere API error:', error);
                throw error;
            }
        }

        // Grammar checking functions
        async function checkGrammar(fieldId) {
            const field = document.getElementById(fieldId);
            const text = field.value.trim();
            
            if (!text) {
                showAlert('error', 'Please enter some text to check');
                return;
            }

            const suggestionDiv = document.getElementById(`${fieldId}Suggestion`);
            suggestionDiv.innerHTML = `
                <div class="grammar-suggestion-header">
                    <span class="material-icons md-18">hourglass_empty</span>
                    Checking grammar...
                </div>
            `;
            suggestionDiv.classList.add('active');

            try {
                const prompt = `Please check the following text for grammar, spelling, and style errors. Provide a corrected version if needed. If the text is already correct, just say "No corrections needed."

Text to check: "${text}"

Corrected version:`;

                const correction = await callCohereAPI(prompt, 150);
                
                if (correction.toLowerCase().includes('no corrections needed') || correction.toLowerCase().includes('already correct')) {
                    suggestionDiv.innerHTML = `
                        <div class="grammar-suggestion-header">
                            <span class="material-icons md-18">check_circle</span>
                            Grammar Check Complete
                        </div>
                        <div class="grammar-suggestion-content">
                            Your text looks great! No corrections needed.
                        </div>
                        <div class="grammar-suggestion-actions">
                            <button class="grammar-suggestion-btn dismiss" onclick="dismissSuggestion('${fieldId}')">
                                Dismiss
                            </button>
                        </div>
                    `;
                } else {
                    suggestionDiv.innerHTML = `
                        <div class="grammar-suggestion-header">
                            <span class="material-icons md-18">edit</span>
                            Grammar Suggestion
                        </div>
                        <div class="grammar-suggestion-content">
                            <strong>Suggested correction:</strong><br>
                            ${correction}
                        </div>
                        <div class="grammar-suggestion-actions">
                            <button class="grammar-suggestion-btn accept" onclick="acceptSuggestion('${fieldId}', \`${correction.replace(/`/g, '\\`')}\`)">
                                Accept
                            </button>
                            <button class="grammar-suggestion-btn dismiss" onclick="dismissSuggestion('${fieldId}')">
                                Dismiss
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                suggestionDiv.innerHTML = `
                    <div class="grammar-suggestion-header">
                        <span class="material-icons md-18">error</span>
                        Error
                    </div>
                    <div class="grammar-suggestion-content">
                        Unable to check grammar at this time. Please try again later.
                    </div>
                    <div class="grammar-suggestion-actions">
                        <button class="grammar-suggestion-btn dismiss" onclick="dismissSuggestion('${fieldId}')">
                            Dismiss
                        </button>
                    </div>
                `;
            }
        }

        async function checkAllGrammar() {
            const fields = ['title', 'author', 'additionalField'];
            updateStatus('Checking grammar for all fields...');
            
            for (const field of fields) {
                const fieldElement = document.getElementById(field);
                if (fieldElement.value.trim()) {
                    await checkGrammar(field);
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Rate limiting
                }
            }
            
            updateStatus('Grammar check complete');
        }

        function acceptSuggestion(fieldId, suggestion) {
            document.getElementById(fieldId).value = suggestion;
            dismissSuggestion(fieldId);
            updateStatus('Suggestion applied');
        }

        function dismissSuggestion(fieldId) {
            const suggestionDiv = document.getElementById(`${fieldId}Suggestion`);
            suggestionDiv.classList.remove('active');
        }

        // Nexora chat functions
        async function sendNexoraMessage() {
            const input = document.getElementById('nexoraInput');
            const message = input.value.trim();
            
            if (!message) return;

            const messagesContainer = document.getElementById('nexoraMessages');
            
            // Add user message
            addNexoraMessage('user', message);
            input.value = '';

            // Add typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'nexora-message assistant';
            typingDiv.innerHTML = `
                <div class="nexora-message-avatar">
                    <span class="material-icons">smart_toy</span>
                </div>
                <div class="nexora-message-content">
                    <span class="material-icons">more_horiz</span> Nexora is thinking...
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                const prompt = `You are Nexora, a helpful AI writing assistant. You help with grammar, writing suggestions, content creation, and general writing questions. Please respond to this user message in a helpful and friendly way:

User: ${message}

Nexora:`;

                const response = await callCohereAPI(prompt, 200);
                
                // Remove typing indicator
                messagesContainer.removeChild(typingDiv);
                
                // Add AI response
                addNexoraMessage('assistant', response);
                
            } catch (error) {
                // Remove typing indicator
                messagesContainer.removeChild(typingDiv);
                
                // Add error message
                addNexoraMessage('assistant', 'I apologize, but I\'m having trouble connecting right now. Please try again in a moment.');
            }
        }

        function addNexoraMessage(sender, content) {
            const messagesContainer = document.getElementById('nexoraMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `nexora-message ${sender}`;
            
            const avatar = sender === 'user' ? 
                '<span class="material-icons">person</span>' : 
                '<span class="material-icons">smart_toy</span>';
            
            messageDiv.innerHTML = `
                <div class="nexora-message-avatar">
                    ${avatar}
                </div>
                <div class="nexora-message-content">
                    <p>${content}</p>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Sidebar functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebarCollapsed = !sidebarCollapsed;
            
            if (sidebarCollapsed) {
                sidebar.classList.add('collapsed');
            } else {
                sidebar.classList.remove('collapsed');
            }
        }

        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function closeMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }

        // Tab switching
        function switchTab(tabId) {
            currentTab = tabId;
            
            // Update navigation
            document.querySelectorAll('.nav-link[data-tab]').forEach(link => link.classList.remove('active'));
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabId}Tab`).classList.add('active');

            // Update page title and show/hide publish button
            const pageTitle = document.getElementById('pageTitle');
            const submitBtn = document.getElementById('submitBtn');
            
            if (tabId === 'create') {
                pageTitle.textContent = 'New Post';
                submitBtn.style.display = 'flex';
            } else {
                pageTitle.textContent = 'Manage Posts';
                submitBtn.style.display = 'none';
                loadPosts();
            }

            // Close mobile sidebar
            closeMobileSidebar();

            updateStatus(tabId === 'create' ? 'Ready to create' : 'Viewing posts');
        }

        // Handle image upload
        function handleImageUpload(event, previewId, fileNameId) {
            const file = event.target.files[0];
            if (file) {
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('error', 'Image size must be less than 5MB');
                    event.target.value = '';
                    return;
                }

                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showAlert('error', 'Please select a valid image file');
                    event.target.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgPreview = document.getElementById(previewId);
                    imgPreview.src = e.target.result;
                    imgPreview.style.display = 'block';
                    document.getElementById(fileNameId).innerHTML = `<span class="material-icons md-18">image</span> ${file.name}`;
                    updateStatus('Image selected');
                };
                reader.readAsDataURL(file);
            }
        }

        // Handle form submission
        async function handleSubmit() {
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            // Validate form
            if (!validateForm()) return;

            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="material-icons md-18">hourglass_empty</span> Publishing...';
            updateStatus('Publishing post...');

            try {
                const formData = getFormData();
                let imageUrl = '';

                // Upload image if present
                if (formData.imageFile) {
                    imageUrl = await uploadToCloudinary(formData.imageFile);
                }

                // Save to Supabase
                const { error } = await supabase.from("posts").insert([{
                    category: formData.category,
                    title: formData.title,
                    author: formData.author,
                    role: formData.role,
                    role_person: formData.rolePerson,
                    content: formData.content,
                    image_url: imageUrl,
                    created_at: new Date().toISOString()
                }]);

                if (error) throw new Error(error.message);

                showAlert('success', 'Post published successfully!');
                clearForm();
                updateStatus('Post published');

                // Clear draft after successful publish
                localStorage.removeItem('angSilakboDraft');

                // Refresh posts if on manage tab
                if (currentTab === 'manage') {
                    loadPosts();
                }

            } catch (error) {
                console.error('Error publishing post:', error);
                showAlert('error', error.message || 'Error publishing post');
                updateStatus('Error publishing');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        // Validate form
        function validateForm() {
            const title = document.getElementById('title').value.trim();
            const category = document.getElementById('category').value;
            const author = document.getElementById('author').value.trim();
            const role = document.getElementById('role').value;
            const content = tinymce.get('content').getContent().trim();

            if (!title) {
                showAlert('error', 'Please enter a title');
                document.getElementById('title').focus();
                return false;
            }

            if (!category) {
                showAlert('error', 'Please select a category');
                document.getElementById('category').focus();
                return false;
            }

            if (!author) {
                showAlert('error', 'Please enter an author name');
                document.getElementById('author').focus();
                return false;
            }

            if (!role) {
                showAlert('error', 'Please select a role');
                document.getElementById('role').focus();
                return false;
            }

            if (!content) {
                showAlert('error', 'Please enter some content');
                tinymce.get('content').focus();
                return false;
            }

            return true;
        }

        // Get form data
        function getFormData() {
            return {
                title: document.getElementById('title').value.trim(),
                category: document.getElementById('category').value,
                author: document.getElementById('author').value.trim(),
                role: document.getElementById('role').value,
                rolePerson: document.getElementById('additionalField').value.trim(),
                content: tinymce.get('content').getContent(),
                imageFile: document.getElementById('imageUpload').files[0]
            };
        }

        // Upload to Cloudinary
        async function uploadToCloudinary(file) {
            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", "Ang Silakbo");

            const response = await fetch("https://api.cloudinary.com/v1_1/ddalveuw6/image/upload", {
                method: "POST",
                body: formData
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error.message);
            return data.secure_url;
        }

        // Clear form
        function clearForm() {
            document.getElementById('postForm').reset();
            tinymce.get('content').setContent('');
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('fileName').innerHTML = '<span class="material-icons md-18">image</span> No image selected';
            
            // Clear all grammar suggestions
            document.querySelectorAll('.grammar-suggestion').forEach(suggestion => {
                suggestion.classList.remove('active');
            });
            
            updateStatus('Form cleared');
        }

        // Draft functions
        function showDraftModal(draft) {
            draftData = draft;
            const draftInfo = document.getElementById('draftInfo');
            const date = new Date(draft.timestamp);
            const timeAgo = getTimeAgo(date);
            
            draftInfo.innerHTML = `
                <div class="draft-info-item">
                    <span class="draft-info-label">Title:</span>
                    <span class="draft-info-value">${draft.title || 'Untitled'}</span>
                </div>
                <div class="draft-info-item">
                    <span class="draft-info-label">Author:</span>
                    <span class="draft-info-value">${draft.author || 'Not specified'}</span>
                </div>
                <div class="draft-info-item">
                    <span class="draft-info-label">Category:</span>
                    <span class="draft-info-value">${draft.category || 'Not selected'}</span>
                </div>
                <div class="draft-info-item">
                    <span class="draft-info-label">Last saved:</span>
                    <span class="draft-info-value">${timeAgo}</span>
                </div>
                <div class="draft-info-item">
                    <span class="draft-info-label">Content length:</span>
                    <span class="draft-info-value">${draft.content ? draft.content.length : 0} characters</span>
                </div>
            `;
            
            openModal('draftModal');
        }

        function restoreDraft() {
            if (draftData) {
                document.getElementById('title').value = draftData.title || '';
                document.getElementById('category').value = draftData.category || '';
                document.getElementById('author').value = draftData.author || '';
                document.getElementById('role').value = draftData.role || '';
                document.getElementById('additionalField').value = draftData.rolePerson || '';
                
                // Wait for TinyMCE to initialize
                const checkTinyMCE = setInterval(() => {
                    if (tinymce.get('content')) {
                        tinymce.get('content').setContent(draftData.content || '');
                        clearInterval(checkTinyMCE);
                    }
                }, 100);
                
                updateStatus('Draft restored');
                closeModal('draftModal');
                showAlert('success', 'Draft restored successfully!');
            }
        }

        function discardDraft() {
            localStorage.removeItem('angSilakboDraft');
            draftData = null;
            closeModal('draftModal');
            updateStatus('Draft discarded');
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
            return `${Math.floor(diffInSeconds / 86400)} days ago`;
        }

        // Load posts
        async function loadPosts() {
            const loadingElement = document.getElementById('loadingPosts');
            const tableElement = document.getElementById('postsTable');
            const noPostsMessage = document.getElementById('noPostsMessage');

            // Show loading state
            loadingElement.style.display = 'block';
            tableElement.style.display = 'none';
            noPostsMessage.style.display = 'none';
            updateStatus('Loading posts...');

            try {
                const { data, error } = await supabase
                    .from('posts')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw new Error(error.message);

                const tableBody = document.getElementById('postsTableBody');
                tableBody.innerHTML = '';

                if (data && data.length > 0) {
                    data.forEach(post => {
                        const row = createPostRow(post);
                        tableBody.appendChild(row);
                    });

                    tableElement.style.display = 'block';
                    attachTableEventListeners();
                    updateStatus(`${data.length} posts loaded`);
                } else {
                    noPostsMessage.style.display = 'block';
                    updateStatus('No posts found');
                }

            } catch (error) {
                console.error('Error loading posts:', error);
                showAlert('error', error.message || 'Error loading posts');
                updateStatus('Error loading posts');
            } finally {
                loadingElement.style.display = 'none';
            }
        }

        // Create post row
        function createPostRow(post) {
            const row = document.createElement('tr');
            const date = new Date(post.created_at);
            const formattedDate = date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            row.innerHTML = `
                <td><strong>${post.title || 'Untitled'}</strong></td>
                <td><span class="badge badge-${post.category}">${post.category.charAt(0).toUpperCase() + post.category.slice(1)}</span></td>
                <td>${post.author}</td>
                <td>${post.role || '-'}</td>
                <td>${post.role_person || '-'}</td>
                <td>${formattedDate}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-icon btn-view" data-id="${post.id}" title="View post">
                            <span class="material-icons md-18">visibility</span>
                        </button>
                        <button class="btn-icon btn-edit" data-id="${post.id}" title="Edit post">
                            <span class="material-icons md-18">edit</span>
                        </button>
                        <button class="btn-icon btn-delete" data-id="${post.id}" title="Delete post">
                            <span class="material-icons md-18">delete</span>
                        </button>
                    </div>
                </td>
            `;

            return row;
        }

        // Attach table event listeners
        function attachTableEventListeners() {
            document.querySelectorAll('.btn-view').forEach(button => {
                button.addEventListener('click', () => openViewModal(button.getAttribute('data-id')));
            });

            document.querySelectorAll('.btn-edit').forEach(button => {
                button.addEventListener('click', () => openEditModal(button.getAttribute('data-id')));
            });

            document.querySelectorAll('.btn-delete').forEach(button => {
                button.addEventListener('click', () => openDeleteModal(button.getAttribute('data-id')));
            });
        }

        // Open view modal
        async function openViewModal(postId) {
            try {
                updateStatus('Loading post...');
                const { data, error } = await supabase
                    .from('posts')
                    .select('*')
                    .eq('id', postId)
                    .single();

                if (error) throw new Error(error.message);

                const viewContent = document.getElementById('viewPostContent');
                const date = new Date(data.created_at);
                const formattedDate = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                let html = `
                    <article class="post-view">
                        <header class="post-header">
                            <h1 class="post-title">${data.title || 'Untitled'}</h1>
                            <div class="post-meta">
                                <div class="meta-item">
                                    <span class="material-icons">folder</span>
                                    <span>${data.category.charAt(0).toUpperCase() + data.category.slice(1)}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="material-icons">person</span>
                                    <span>${data.author}</span>
                                </div>
                                ${data.role ? `
                                <div class="meta-item">
                                    <span class="material-icons">work</span>
                                    <span>${data.role}</span>
                                </div>
                                ` : ''}
                                ${data.role_person ? `
                                <div class="meta-item">
                                    <span class="material-icons">badge</span>
                                    <span>${data.role_person}</span>
                                </div>
                                ` : ''}
                                <div class="meta-item">
                                    <span class="material-icons">calendar_today</span>
                                    <span>${formattedDate}</span>
                                </div>
                            </div>
                        </header>
                `;

                if (data.image_url) {
                    html += `
                        <div class="post-image">
                            <img src="${data.image_url}" alt="Post Image" style="max-width: 100%; border-radius: var(--radius-lg); margin: 1.5rem 0;">
                        </div>
                    `;
                }

                html += `
                        <div class="post-content">
                            ${data.content}
                        </div>
                    </article>
                `;

                viewContent.innerHTML = html;
                document.getElementById('editFromViewBtn').setAttribute('data-id', postId);
                openModal('viewModal');
                updateStatus('Viewing post');

            } catch (error) {
                console.error('Error loading post:', error);
                showAlert('error', error.message || 'Error loading post');
                updateStatus('Error loading post');
            }
        }

        // Open edit modal
        async function openEditModal(postId) {
            try {
                updateStatus('Loading post for editing...');
                const { data, error } = await supabase
                    .from('posts')
                    .select('*')
                    .eq('id', postId)
                    .single();

                if (error) throw new Error(error.message);

                // Populate form fields
                document.getElementById('editPostId').value = data.id;
                document.getElementById('editCategory').value = data.category;
                document.getElementById('editTitle').value = data.title || '';
                document.getElementById('editAuthor').value = data.author;
                document.getElementById('editRole').value = data.role || '';
                document.getElementById('editAdditionalField').value = data.role_person || '';

                // Set content in TinyMCE
                tinymce.get('editContent').setContent(data.content || '');

                // Handle image preview
                const imgPreview = document.getElementById('editImagePreview');
                if (data.image_url) {
                    imgPreview.src = data.image_url;
                    imgPreview.style.display = 'block';
                    document.getElementById('editFileName').innerHTML = '<span class="material-icons md-18">image</span> Current image';
                } else {
                    imgPreview.style.display = 'none';
                    document.getElementById('editFileName').innerHTML = '<span class="material-icons md-18">image</span> No image selected';
                }

                openModal('editModal');
                updateStatus('Editing post');

            } catch (error) {
                console.error('Error loading post:', error);
                showAlert('error', error.message || 'Error loading post');
                updateStatus('Error loading post');
            }
        }

        // Handle edit save
        async function handleEditSave() {
            const saveBtn = document.getElementById('saveEditBtn');
            const originalText = saveBtn.innerHTML;

            // Validate edit form
            if (!validateEditForm()) return;

            saveBtn.disabled = true;
            saveBtn.innerHTML = '<span class="material-icons md-18">hourglass_empty</span> Saving...';
            updateStatus('Saving changes...');

            try {
                const postId = document.getElementById('editPostId').value;
                const editData = getEditFormData();
                let updateData = {
                    category: editData.category,
                    title: editData.title,
                    author: editData.author,
                    role: editData.role,
                    role_person: editData.rolePerson,
                    content: editData.content,
                    updated_at: new Date().toISOString()
                };

                // Upload new image if selected
                if (editData.imageFile) {
                    updateData.image_url = await uploadToCloudinary(editData.imageFile);
                }

                const { error } = await supabase
                    .from("posts")
                    .update(updateData)
                    .eq('id', postId);

                if (error) throw new Error(error.message);

                showAlert('success', 'Post updated successfully!');
                closeModal('editModal');
                loadPosts();
                updateStatus('Post updated');

            } catch (error) {
                console.error('Error updating post:', error);
                showAlert('error', error.message || 'Error updating post');
                updateStatus('Error updating post');
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalText;
            }
        }

        // Validate edit form
        function validateEditForm() {
            const title = document.getElementById('editTitle').value.trim();
            const category = document.getElementById('editCategory').value;
            const author = document.getElementById('editAuthor').value.trim();
            const role = document.getElementById('editRole').value;
            const content = tinymce.get('editContent').getContent().trim();

            if (!title) {
                showAlert('error', 'Please enter a title');
                document.getElementById('editTitle').focus();
                return false;
            }

            if (!category) {
                showAlert('error', 'Please select a category');
                document.getElementById('editCategory').focus();
                return false;
            }

            if (!author) {
                showAlert('error', 'Please enter an author name');
                document.getElementById('editAuthor').focus();
                return false;
            }

            if (!role) {
                showAlert('error', 'Please select a role');
                document.getElementById('editRole').focus();
                return false;
            }

            if (!content) {
                showAlert('error', 'Please enter some content');
                tinymce.get('editContent').focus();
                return false;
            }

            return true;
        }

        // Get edit form data
        function getEditFormData() {
            return {
                title: document.getElementById('editTitle').value.trim(),
                category: document.getElementById('editCategory').value,
                author: document.getElementById('editAuthor').value.trim(),
                role: document.getElementById('editRole').value,
                rolePerson: document.getElementById('editAdditionalField').value.trim(),
                content: tinymce.get('editContent').getContent(),
                imageFile: document.getElementById('editImageUpload').files[0]
            };
        }

        // Open delete modal
        function openDeleteModal(postId) {
            document.getElementById('deletePostId').value = postId;
            openModal('deleteModal');
            updateStatus('Confirming deletion');
        }

        // Handle delete
        async function handleDelete() {
            const deleteBtn = document.getElementById('confirmDeleteBtn');
            const originalText = deleteBtn.innerHTML;

            deleteBtn.disabled = true;
            deleteBtn.innerHTML = '<span class="material-icons md-18">hourglass_empty</span> Deleting...';
            updateStatus('Deleting post...');

            try {
                const postId = document.getElementById('deletePostId').value;
                const { error } = await supabase
                    .from("posts")
                    .delete()
                    .eq('id', postId);

                if (error) throw new Error(error.message);

                showAlert('success', 'Post deleted successfully!');
                closeModal('deleteModal');
                loadPosts();
                updateStatus('Post deleted');

            } catch (error) {
                console.error('Error deleting post:', error);
                showAlert('error', error.message || 'Error deleting post');
                updateStatus('Error deleting post');
            } finally {
                deleteBtn.disabled = false;
                deleteBtn.innerHTML = originalText;
            }
        }

        // Modal utilities
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            modal.style.display = 'flex';
            
            // Focus management for accessibility
            setTimeout(() => {
                const firstFocusable = modal.querySelector('input, button, select, textarea');
                if (firstFocusable) firstFocusable.focus();
            }, 100);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            updateStatus('Ready');
        }

        // Alert system
        function showAlert(type, message) {
            const alertSuccess = document.getElementById('alertSuccess');
            const alertError = document.getElementById('alertError');
            const errorMessage = document.getElementById('errorMessage');

            // Hide any existing alerts
            alertSuccess.style.display = 'none';
            alertError.style.display = 'none';

            if (type === 'success') {
                alertSuccess.querySelector('span:nth-child(2)').textContent = message;
                alertSuccess.style.display = 'flex';
                setTimeout(() => {
                    alertSuccess.style.display = 'none';
                }, 5000);
            } else {
                errorMessage.textContent = message;
                alertError.style.display = 'flex';
                setTimeout(() => {
                    alertError.style.display = 'none';
                }, 5000);
            }

            // Scroll to top to show alert
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Status updates
        function updateStatus(message) {
            const statusElement = document.getElementById('sidebarStatus');
            statusElement.textContent = message;
        }

        // Keyboard shortcuts
        function handleKeyboardShortcuts(e) {
            // Ctrl/Cmd + S to save
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (currentTab === 'create') {
                    handleSubmit();
                } else if (document.getElementById('editModal').style.display === 'flex') {
                    handleEditSave();
                }
            }

            // Escape to close modals
            if (e.key === 'Escape') {
                const activeModal = document.querySelector('.modal-overlay[style*="flex"]');
                if (activeModal) {
                    closeModal(activeModal.id);
                }
                closeMobileSidebar();
            }

            // Ctrl/Cmd + N for new post
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                switchTab('create');
            }

            // Ctrl/Cmd + M for manage posts
            if ((e.ctrlKey || e.metaKey) && e.key === 'm') {
                e.preventDefault();
                switchTab('manage');
            }

            // Ctrl/Cmd + B to toggle sidebar
            if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                e.preventDefault();
                toggleSidebar();
            }
        }

        // Auto-save functionality
        let autoSaveTimer;
        function setupAutoSave() {
            const autoSave = () => {
                if (currentTab === 'create') {
                    const formData = getFormData();
                    if (formData.title || formData.content) {
                        localStorage.setItem('angSilakboDraft', JSON.stringify({
                            ...formData,
                            timestamp: new Date().toISOString()
                        }));
                        updateStatus('Draft saved');
                    }
                }
            };

            // Auto-save every 30 seconds
            autoSaveTimer = setInterval(autoSave, 30000);

            // Save on form changes
            ['title', 'category', 'author', 'role', 'additionalField'].forEach(id => {
                document.getElementById(id).addEventListener('input', () => {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(autoSave, 5000);
                });
            });
        }

        // Load draft on page load
        function loadDraft() {
            const draft = localStorage.getItem('angSilakboDraft');
            if (draft) {
                try {
                    const draftData = JSON.parse(draft);
                    const draftAge = new Date() - new Date(draftData.timestamp);
                    
                    // Only load drafts less than 24 hours old
                    if (draftAge < 24 * 60 * 60 * 1000) {
                        showDraftModal(draftData);
                    } else {
                        localStorage.removeItem('angSilakboDraft');
                    }
                } catch (error) {
                    console.error('Error loading draft:', error);
                    localStorage.removeItem('angSilakboDraft');
                }
            }
        }

        // Initialize auto-save and load draft
        setTimeout(() => {
            setupAutoSave();
            loadDraft();
        }, 1000);

        // Performance optimization: Lazy load images
        function lazyLoadImages() {
            const images = document.querySelectorAll('img[data-src]');
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        imageObserver.unobserve(img);
                    }
                });
            });

            images.forEach(img => imageObserver.observe(img));
        }

        // Error handling
        window.addEventListener('error', (e) => {
            console.error('Global error:', e.error);
            updateStatus('An error occurred');
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
            updateStatus('An error occurred');
        });

        // Initialize lazy loading
        setTimeout(lazyLoadImages, 1000);

        // Final initialization
        console.log('ANG SILAKBO WORKSTATION initialized successfully');
        updateStatus('Application ready');
    </script>
</body>
</html>
